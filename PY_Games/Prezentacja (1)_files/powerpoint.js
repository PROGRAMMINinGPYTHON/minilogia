window.Microsoft||(window.Microsoft = {});Microsoft.Office=Microsoft.Office||{},Microsoft.Office.PowerPoint=function(t){var i={};function n(e){if(i[e])return i[e].exports;var o=i[e]={i:e,l:!1,exports:{}};return t[e].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=i,n.d=function(t,i,e){n.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:e})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,i){if(1&i&&(t=n(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(n.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var o in t)n.d(e,o,function(i){return t[i]}.bind(null,o));return e},n.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(i,"a",i),i},n.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},n.p="",n(n.s=5)}({5:function(t,i,n){"use strict";n.r(i);var e=function(){return(e=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var o in i=arguments[n])Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o]);return t}).apply(this,arguments)};var o,r,s=[[/!/g,"%21"],[/'/g,"%27"],[/\(/g,"%28"],[/\)/g,"%29"],[/\*/g,"%2A"]];function a(t){var i=t.match(/^(.*?\/\/[^\/]+)(.*)$/);if(!i)throw new Error("Invalid URL");return i[1]}function c(t,i){var n=t.toLowerCase(),e=i.toLowerCase(),o=n.indexOf("&"+e+"=");if(-1===o&&(o=n.indexOf("?"+e+"=")),-1===o)return"";var r=o+(i.length+2),s=t.indexOf("&",r);return t.substring(r,-1===s?void 0:s)}function u(t,i){if(!t)return t;var n=t,e=n.indexOf("?"),o=i.toLowerCase()+"=",r=n.toLowerCase().indexOf(o,e);if(r>=0){var s=n.indexOf("&",r);return"&"===(n=n.substring(0,r)+(-1===s?"":n.substring(s+1))).slice(-1)&&(n=n.slice(0,-1)),n}return t}function h(t,i){var n=c(t,i);return n?decodeURI(n):n}function f(t){return c(window.location.href,t)}function d(t){var i=encodeURIComponent(t);return s.forEach((function(t){i=i.replace(t[0],t[1])})),i}function l(t,i,n,e){var o=t.map((function(t){return function(t,i){var n={};n.G=t.tag,n.T=t.timestamp-i,n.M=t.message,n.C=t.category;var e=1e3*t.type+t.level;return n.D=e,n}(t,e)})),r=function(t,i,n,e){var o={};return o.T=t,o.L=i,o.S=n,o.I=e,o.V=1,o}(e,o,i,n);return JSON.stringify(r)}!function(t){t[t.Trace=0]="Trace",t[t.Assert=1]="Assert"}(o||(o={})),function(t){t[t.Error=10]="Error",t[t.Warning=15]="Warning",t[t.Info=50]="Info",t[t.Verbose=100]="Verbose",t[t.Spam=200]="Spam"}(r||(r={}));var p,w=function(){try{var t=window.performance;return t&&t.now&&t.now()!==1/0}catch(t){return!1}}();function v(){return w?window.performance.now():Date.now()}function m(){if(!p){var t=window.performance;p=w&&t.timing&&t.timing.navigationStart?function(){return Math.round(t.now()+t.timing.navigationStart)}:Date.now?Date.now:function(){return(new Date).getTime()}}return p()}var g,S,P=function(){function t(t){var i=this;this.u=3e4,this.h=30,this.v=0,this.g=[],this.P=m(),this._="",this.U=0,this.flushOnClose=function(){i.O(!1,!1)},this.flush=function(){i.A()},this.A=function(){window.setTimeout((function(){return i.O(!0,!0)}),0)},this.O=function(t,n){var e=v();if(window.clearTimeout(i.N),i.R){if(i.g.length>0)i.v+=1,!function(t,i,n){if(""!==i)if(navigator&&navigator.sendBeacon)navigator.sendBeacon(i,t);else{var e=new XMLHttpRequest;e.readyState!==XMLHttpRequest.UNSENT&&e.readyState!==XMLHttpRequest.DONE||(e.open("POST",i,n),e.send(t))}}(l(i.g.splice(0,t?i.h:i.g.length),i._,i.v,i.P),i.R,n),i.P=m();t&&(i.N=window.setTimeout(i.A,i.g.length>i.h?1e3:i.u)),i.U+=v()-e}},t&&this.configure(t)}return t.prototype.getTimeSpentLogging=function(){return this.U},t.prototype.addLoggingTime=function(t){this.U+=t},t.prototype.configure=function(t){var i=this,n=v();if(t.uploadCadenceInMs&&(this.u=t.uploadCadenceInMs),t.uploadTriggerSize&&(this.h=t.uploadTriggerSize),t.sessionId&&(this._=t.sessionId),t.remoteUlsEndpoint){if(!t.sessionId&&this.R)throw new Error("Remote ULS endpoint is already set");this.R=t.remoteUlsEndpoint+"?usid="+this._,this.P=m(),window.setTimeout((function(){return i.O(!0,!0)}),0)}this.U+=v()-n},t.prototype.handleTrace=function(t){var i=v();t.message.length>3072&&(t.message=t.message.substring(0,3072-"... [Trimmed]".length)+"... [Trimmed]"),this.g.push(t),(this.g.length>this.h||t.level===r.Error)&&this.A(),this.U+=v()-i},t}(),b=[];!function(t){t.W="BootstrapperMaxUlsHeartbeatTime",t.F="BootstrapperNoCompleteWarning1Time",t.B="BootstrapperNoCompleteWarning2Time",t.H="RemoteUlsETag",t.k="RemoteUlsSuppressions",t.J="BootstrapperSettingsFetchPeriod",t.j="timestamp",t.q="BootstrapperUlsHeartbeatIntervalMs",t.K="BootstrapperUlsHeartBeatIsEnabled",t.X="BootstrapperUlsUploadCadenceMs",t.Z="WordConsumptionViewToEditRedirectIsEnabled"}(S||(S={}));var I;function _(t){var i=new P(t);function n(t,n,e,r){var s=v();if(!function(t){return 1===b[t]}(t)){var a={timestamp:m(),category:n,tag:t,level:e,type:o.Trace,message:r};i.addLoggingTime(v()-s),i.handleTrace(a)}}return{ULS:{$:function(t,i,e,o){n(t,i,e,o)},shipAssertTag:function(t,i,e,o){e&&n(t,i,r.Error,o)},debugAssertTag:function(t,i,n,e){throw new Error("Debug Asserts not Implemented in the TypeScript bULS module")},flush:i.flush,flushOnClose:i.flushOnClose},configure:function(t){i.configure(t)},settingsChangeHandler:function(t){var n,e;n=t.Y.getValue(S.k,""),e=t.Y.getValue(S.H,""),g&&e===g||(b=[],g=e,n&&n.split(",").forEach((function(t){var i=parseInt(t,10);i&&(b[i]=1)}))),i.configure({uploadCadenceInMs:t.Y.getValue(S.X,6e4)})},getTimeSpentLogging:function(){return i.getTimeSpentLogging()}}}!function(t){t[t.tt=0]="msoulscat_ES_EWAJS",t[t.it=1]="msoulscat_ES_EWAJSGrid",t[t.nt=6]="msoulscat_ES_EWAJSChart",t[t.et=202]="msoulscat_MSOSP_FileMenuCommands",t[t.ot=301]="msoulscat_Wac_WordViewer",t[t.rt=306]="msoulscat_Wac_BrowserGeneral",t[t.st=320]="msoulscat_Wac_TaskPane",t[t.at=339]="msoulscat_Wac_OneNoteGeneral",t[t.ct=340]="msoulscat_Wac_Ribbon",t[t.ut=379]="msoulscat_Wac_WopiPendingApplication",t[t.ht=383]="msoulscat_Wac_Telemetry",t[t.ft=391]="msoulscat_Wac_WacCatchUpActivities",t[t.dt=394]="msoulscat_Wac_Dictation",t[t.lt=395]="msoulscat_Wac_OneNoteSync",t[t.pt=700]="msoulscat_Wac_VisioApp",t[t.wt=1601]="msoulscat_OneNoteOnline_EditableCache",t[t.vt=800]="msoulscat_Wac_PptAnimation",t[t.gt=833]="msoulscat_Wac_PptLive",t[t.St=834]="msoulscat_Wac_PptMWeb",t[t.Pt=815]="msoulscat_Wac_PptShape",t[t.bt=817]="msoulscat_Wac_PptSession",t[t.It=830]="msoulscat_Wac_PptSlideshow",t[t._t=2300]="msoulscat_Wac_VersionHistory",t[t.Ct=302]="msoulscat_Wac_WordPresence",t[t.Et=3005]="msoulscat_Wac_WordVersionHistory",t[t.Ut=3006]="msoulscat_Wac_LivePersonaCard",t[t.Tt=3012]="msoulscat_Wac_CatchUpFlyout",t[t.Ot=3021]="msoulscat_Wac_ModernFontPicker"}(I||(I={}));var C="16.0.13811.40508",E="161381140508";function U(){return C}function T(){return 1381140508}var O;!function(t){t[t.Firefox=0]="Firefox",t[t.Opera=1]="Opera",t[t.IE=2]="IE",t[t.Edge=3]="Edge",t[t.Chrome=4]="Chrome",t[t.Safari=5]="Safari",t[t.Unknown=6]="Unknown"}(O||(O={}));var x=window.navigator,y=x?x.userAgent:void 0;function A(){if(y){if(y.indexOf("Firefox")>-1)return O.Firefox;if(y.indexOf("Opera")>-1||y.indexOf("OPR")>-1)return O.Opera;if(y.indexOf("Trident")>-1)return O.IE;if(y.indexOf("Edg")>-1)return O.Edge;if(y.indexOf("Chrome")>-1)return O.Chrome;if(y.indexOf("Safari")>-1)return O.Safari}return O.Unknown}function M(){try{return!!y&&y.indexOf("iPad")>=0||!!y&&y.indexOf("Macintosh")>=0&&R()&&!N()||!!y&&y.indexOf("Android")>=0||R()}catch(t){return!1}}function N(){return!!y&&y.indexOf("iPhone")>=0}function R(){return!!x&&(x.maxTouchPoints>0||x.msMaxTouchPoints>0)}function D(t){return JSON.stringify(t,Object.getOwnPropertyNames(t))}var W,F;function B(t,i){return{isFeatureEnabled:function(n){return function(t,i,n){if(!i)return;try{return i(t)}catch(t){n&&n.ULS.$(594883024,I.ut,r.Error,"IsFeatureEnabled callback error: "+D(t))}return}(n,t,i)}}}function H(t){return isNaN(t)?"":t.toString()+"px"}function L(t){return(100*t).toString()+"%"}!function(t){t.xt="EnterpriseTemplates",t.yt="ExcelAdaptiveLayoutDownload",t.At="ExcelJsApiV2",t.Mt="ExcelJsApiV2NoWrapper",t.Nt="ExcelLandingPageOfflineTelemetry",t.Rt="ExcelLandingPageObserverRetry",t.Dt="H2StaticContent",t.Wt="HashedUrl",t.Ft="ODCShareLinkPreload",t.Bt="OfficeComExcelJsApiV2",t.Ht="OfficeComUiHost",t.Lt="OfficeComWordJsApiV2",t.kt="OfficeHwaUiHost",t.Jt="WordJsApiV2",t.Vt="WordJsApiV2NoWrapper",t.jt="WordViewToUnifiedRead"}(W||(W={})),function(t){t[t.UnifiedCreateNew=1]="UnifiedCreateNew",t[t.LegacyCreateNew=2]="LegacyCreateNew",t[t.NotCreateNew=3]="NotCreateNew"}(F||(F={}));var k=function(){function t(){}return t.getFeatureGates=function(t,i){try{var n="{}";return t&&t.SessionInformation&&t.SessionInformation.PptFeatureGates&&(n=decodeURIComponent(t.SessionInformation.PptFeatureGates).replace(/\u200B/g,"")),JSON.parse(n)}catch(t){return i&&i.ULS.$(578933140,I.ut,r.Warning,"Exception parsing ppt feature gates: "+JSON.stringify(t)),{}}},t}();function J(t,i,n,e){return void 0===i&&(i=1),void 0===n&&(n="https://c1-powerpoint-15.cdn.office.net/pods/s/"),void 0===e&&(e="5"),{PodsURL:t,WacCdnStaticServer:n,RolloutPercentage:i,PreviewerRolloutRing:e}}var V=function(){function t(){}return t.getWacToPodsUnifiedMap=function(){var t={};return t[this.ffcUrl]=J(this.ffcUrl+this.pods,1,"https://c5-powerpoint-15.cdn.office.net/pods/s/"),t[this.ppcUrl]=J(this.ppcUrl+this.pods,1,"https://c4-powerpoint-15.cdn.office.net/pods/s/"),t[this.prodUrl]=J(this.prodUrl+this.pods),t[this.uscUrl]=J(this.uscUrl+this.pods),t[this.eucUrl]=J(this.eucUrl+this.pods),t[this.cacUrl]=J(this.cacUrl+this.pods),t[this.ukcUrl]=J(this.ukcUrl+this.pods),t[this.aucUrl]=J(this.aucUrl+this.pods),t[this.jpcUrl]=J(this.jpcUrl+this.pods),t[this.incUrl]=J(this.incUrl+this.pods),t[this.krcUrl]=J(this.krcUrl+this.pods),t[this.frcUrl]=J(this.frcUrl+this.pods),t[this.sgcUrl]=J(this.sgcUrl+this.pods),t[this.zacUrl]=J(this.zacUrl+this.pods),t[this.aecUrl]=J(this.aecUrl+this.pods),t[this.decUrl]=J(this.decUrl+this.pods),t[this.chcUrl]=J(this.chcUrl+this.pods),t[this.nocUrl]=J(this.nocUrl+this.pods),t[this.brcUrl]=J(this.brcUrl+this.pods),t[this.blackforestUrl]=J(this.blackforestUrl+this.pods,1,"https://powerpoint.cdn.office.de/pods/s/"),t[this.gallatinUrl]=J(this.gallatinUrl+this.pods,1,"https://cdn.partner.officewebapps.cn/pods/s/"),t[this.usGovUrl]=J(this.usGovUrl+this.pods,1,"https://powerpoint.cdn.office365.us/pods/s/"),t[this.gbcUrl]=J(this.gbcUrl+this.pods,1,"https://powerpoint.cdn.office365.us/pods/s/"),t[this.usDoDUrl]=J(this.usDoDUrl+this.pods,1,"https://powerpoint.dod.cdn.office365.us/pods/s/"),t},t.getWacToPodsPreviewerMap=function(){var i={};return this.ShouldRerouteEdogToProd?i[this.ffcUrl]=J(this.https+"usc"+t.hostOSIPodsService,1,"https://c4-powerpoint-15.cdn.office.net/pods/s/"):i[this.ffcUrl]=J(this.https+"pods.edog.officeapps.live.com/",1,"https://c5-powerpoint-15.cdn.office.net/pods/s/","1"),i[this.ppcUrl]=J(this.https+"usc"+t.hostOSIPodsService,1,"https://c4-powerpoint-15.cdn.office.net/pods/s/","2"),i[this.prodUrl]=J(this.https+t.hostOSIPodsService.substring(1)),i[this.uscUrl]=J(this.https+"usc"+t.hostOSIPodsService),i[this.eucUrl]=J(this.https+"euc"+t.hostOSIPodsService),i[this.cacUrl]=J(this.https+"canc"+t.hostOSIPodsService),i[this.ukcUrl]=J(this.https+"ukc"+t.hostOSIPodsService),i[this.aucUrl]=J(this.https+"ausc"+t.hostOSIPodsService),i[this.jpcUrl]=J(this.https+"jpc"+t.hostOSIPodsService),i[this.incUrl]=J(this.https+"inc"+t.hostOSIPodsService),i[this.krcUrl]=J(this.https+"krc"+t.hostOSIPodsService),i[this.frcUrl]=J(this.https+"frc"+t.hostOSIPodsService),i[this.sgcUrl]=J(this.https+"sea-000"+t.hostOSIPodsService),i[this.usGovUrl]=J(this.https+"pods.osi.office365.us/",1,"https://powerpoint.cdn.office365.us/pods/s/","6"),i[this.gbcUrl]=J(this.https+"pods.osi.office365.us/",1,"https://powerpoint.cdn.office365.us/pods/s/","6"),i[this.usDoDUrl]=J(this.https+"pods.osi.apps.mil/",1,"https://powerpoint.dod.cdn.office365.us/pods/s/","6"),i.edog=J(this.https+"pods.edog.officeapps.live.com/",1,"https://c5-powerpoint-15.cdn.office.net/pods/s/","1"),i},t.getWacToSlideShowMap=function(){var i={};return this.ShouldRerouteEdogToProd?i[this.ffcUrl]=J(this.https+"usc"+t.hostOSISlideShowService,1,"https://c4-powerpoint-15.cdn.office.net/pods/s/"):i[this.ffcUrl]=J(this.https+"edog-slideshow.officeapps.live.com/",1,"https://c5-powerpoint-15.cdn.office.net/pods/s/","1"),i[this.ppcUrl]=J(this.https+"usc"+t.hostOSISlideShowService,1,"https://c4-powerpoint-15.cdn.office.net/pods/s/","2"),i[this.prodUrl]=J(this.https+t.hostOSISlideShowService.substring(1)),i[this.uscUrl]=J(this.https+"usc"+t.hostOSISlideShowService),i[this.eucUrl]=J(this.https+"euc"+t.hostOSISlideShowService),i[this.cacUrl]=J(this.https+"canc"+t.hostOSISlideShowService),i[this.ukcUrl]=J(this.https+"ukc"+t.hostOSISlideShowService),i[this.aucUrl]=J(this.https+"ausc"+t.hostOSISlideShowService),i[this.jpcUrl]=J(this.https+"jpc"+t.hostOSISlideShowService),i[this.incUrl]=J(this.https+"inc"+t.hostOSISlideShowService),i[this.krcUrl]=J(this.https+"krc"+t.hostOSISlideShowService),i[this.frcUrl]=J(this.https+"frc"+t.hostOSISlideShowService),i[this.sgcUrl]=J(this.https+"sea-000"+t.hostOSISlideShowService),i[this.usGovUrl]=J(this.https+"pods.osi.office365.us/",1,"https://powerpoint.cdn.office365.us/pods/s/","6"),i[this.gbcUrl]=J(this.https+"pods.osi.office365.us/",1,"https://powerpoint.cdn.office365.us/pods/s/","6"),i[this.usDoDUrl]=J(this.https+"pods.osi.apps.mil/",1,"https://powerpoint.dod.cdn.office365.us/pods/s/","6"),i.edog=J(this.https+"edog-slideshow.officeapps.live.com/",1,"https://c5-powerpoint-15.cdn.office.net/pods/s/","1"),i},t.shouldRouteToEdog=function(t,i){return!(!i||!i.SessionInformation)&&(!!(i.SessionInformation.UiHostRing&&this.TeamsRingsInEdog.indexOf(i.SessionInformation.UiHostRing.toLowerCase())>=0)||this.HostsWithFFInEdog.indexOf(i.SessionInformation.HostName)>=0&&t===this.ffcUrl)},t.tryGetPodsRegion=function(t,i,n){var e=t.substring(0,t.indexOf("/p/"));if(n)return this.WacToPodsUnifiedMap[e.toLowerCase()];if(this.shouldRouteToSlideShowService(i)){var o=this.WacToSlideShowMap[e.toLowerCase()];if(this.shouldRouteToEdog(e.toLowerCase(),i)&&(o=this.WacToSlideShowMap.edog),o)return o}else{var r=this.WacToPodsPreviewerMap[e.toLowerCase()];if(this.shouldRouteToEdog(e.toLowerCase(),i)&&(r=this.WacToPodsPreviewerMap.edog),r)return r}return this.IsRedirectedToWAC=!0,this.WacToPodsUnifiedMap[e.toLowerCase()]},t.shouldRouteToSlideShowService=function(t){if(window.location.search.indexOf("wdUseSlideShowService")>=0)return!0;if(t){var i=k.getFeatureGates(t);if(i&&i.UseSlideShowService)return!0}return!1},t.getPodsRing=function(t){var i=this.tryGetPodsRegion(t.ApplicationUrl,t,!1);return i&&i.PreviewerRolloutRing?i.PreviewerRolloutRing:"-4"},t.getWACRegion=function(t){return t?t.substring(0,t.indexOf("/p/")).toLowerCase():""},t.getFileHost=function(t){if(!t)return"";if(t.Diagnostics&&t.Diagnostics.fileHost)return t.Diagnostics.fileHost;if(t.SessionInformation&&t.SessionInformation.HostName){var i=t.SessionInformation.HostName;switch(i){case"MSTeams":case"TeamsAndroid":case"TeamsiOS":case"OneDrive":case"ParticipantApp":case"DragonGate":return"SharePoint Online";default:return i}}return""},t.getUiHost=function(t){if(!t)return"";switch(t){case"MSTeams":case"TeamsAndroid":case"TeamsiOS":return"teams";case"ParticipantApp":case"DragonGate":return t;default:return""}},t.ShouldRerouteEdogToProd=!(window.location.search.indexOf("wdTestPreviewerInEdog")>=0),t.HostsWithFFInEdog=["TeamsiOS"],t.TeamsRingsInEdog=["ring0","ring1"],t.IsRedirectedToWAC=!1,t.https="https://",t.pods="/pods/",t.hostWAC="-powerpoint.officeapps.live.com",t.hostOSIPodsService=".pods.officeapps.live.com/",t.hostOSISlideShowService="-slideshow.officeapps.live.com/",t.ffcUrl=t.https+"ffc"+t.hostWAC,t.ppcUrl=t.https+"ppc"+t.hostWAC,t.uscUrl=t.https+"usc"+t.hostWAC,t.eucUrl=t.https+"euc"+t.hostWAC,t.cacUrl=t.https+"cac"+t.hostWAC,t.ukcUrl=t.https+"ukc"+t.hostWAC,t.aucUrl=t.https+"auc"+t.hostWAC,t.jpcUrl=t.https+"jpc"+t.hostWAC,t.incUrl=t.https+"inc"+t.hostWAC,t.krcUrl=t.https+"krc"+t.hostWAC,t.frcUrl=t.https+"frc"+t.hostWAC,t.sgcUrl=t.https+"sgc"+t.hostWAC,t.zacUrl=t.https+"zac"+t.hostWAC,t.aecUrl=t.https+"aec"+t.hostWAC,t.gbcUrl=t.https+"gbc"+t.hostWAC,t.decUrl=t.https+"dec"+t.hostWAC,t.chcUrl=t.https+"chc"+t.hostWAC,t.nocUrl=t.https+"noc"+t.hostWAC,t.brcUrl=t.https+"brc"+t.hostWAC,t.blackforestUrl=t.https+"powerpoint.online.office.de",t.gallatinUrl=t.https+"cnc-powerpoint.partner.officewebapps.cn",t.usGovUrl=t.https+"powerpoint.gov.online.office365.us",t.usDoDUrl=t.https+"powerpoint.dod.online.office365.us",t.prodUrl=t.https+t.hostWAC.substring(1),t.WacToPodsUnifiedMap=t.getWacToPodsUnifiedMap(),t.WacToPodsPreviewerMap=t.getWacToPodsPreviewerMap(),t.WacToSlideShowMap=t.getWacToSlideShowMap(),t}();var j={AppVersionMajor:1,AppVersionMinor:T(),ContentVersionMajor:1,ContentVersionMinor:T(),WacCdnVersion:E,Environment:"wac"},z=function(){function t(t){this.m_sessionId=t}return t.prototype.GetApplicationType=function(){return"PowerPoint"},t.prototype.GetVersion=function(){return U()},t.prototype.GetSessionId=function(){return this.m_sessionId},t.prototype.RegisterEventHandler=function(){},t.prototype.RemoveEventHandler=function(){},t.prototype.RegisterErrorHandler=function(){},t.prototype.RemoveErrorHandler=function(){},t.prototype.AddEventHandler=function(){},t.prototype.dispose=function(){},t.prototype.Dispose=function(){},t.prototype.GetIsDisabled=function(){return!0},t.prototype.GetPercievedBoot=function(){return null},t.prototype.UsingCached=function(){return!1},t.prototype.GetCurrentSlideDimensions=function(){},t.prototype.GetSlidesInShowCount=function(){},t.prototype.GetTimeLineInfos=function(){},t.prototype.GetCurrentPosition=function(){},t.prototype.GetId=function(){},t.prototype.Next=function(){},t.prototype.PausePresentation=function(){},t.prototype.PlayPresentation=function(){},t.prototype.GetPresentationPlaybackState=function(){},t.prototype.NextSlide=function(){},t.prototype.Prev=function(){},t.prototype.PrevSlide=function(){},t.prototype.GoToNextSlide=function(){},t.prototype.GoToPrevSlide=function(){},t.prototype.GoToSlide=function(){},t.prototype.GoToSlideId=function(){},t.prototype.DisplayBlackSlide=function(){},t.prototype.DisplayWhiteSlide=function(){},t.prototype.Popout=function(){},t.prototype.PlayMedia=function(){},t.prototype.PauseMedia=function(){},t.prototype.RestoreFocus=function(){},t.prototype.StopMedia=function(){},t.prototype.SeekMedia=function(){},t.prototype.GetCurrentMediaStates=function(){},t.prototype.SetNavigationOptions=function(){},t}(),G=["wdPodsUrl","wdPopsUrl","wdNewPodsFrame","wdNewEnabled","wdfs","wdfsection","wdIncludeHostUrl","wdoverrides"];function q(t,i){return!t||"wd"!==t.substr(0,2)||G.indexOf(t)>=0?null:t+"="+i}function K(t,i,n){if(!i)return t;var e=t,o=null==n,r=e.indexOf("?");if(-1===r)return o?t:e+"?"+i+"="+n;for(var s=e.substr(r+1),a=s.split("&"),c=i+"=",u=!1,h=0;h<a.length;h+=1)if(0===a[h].indexOf(c)){e=e.replace(a[h],o?"":c+n),u=!0;break}return u||o||(s.length>0&&(e+="&"),e+=c+n),e}function X(t,i,n,e){return{ShouldUsePODS:t,CanUsePODS:i,Reason:n,CreateNewScenario:e}}var Z=function(){function t(){}return t.ensureInitializeParametersAreTheRightType=function(t){!t.WopiPrecheckInfo.PreseededSessionKey||"_._._."===t.WopiPrecheckInfo.PreseededSessionKey.slice(0,6)&&"-.-.-."===t.WopiPrecheckInfo.PreseededSessionKey.slice(-6)||(t.WopiPrecheckInfo.PreseededSessionKey="_._._."+t.WopiPrecheckInfo.PreseededSessionKey+"-.-.-."),t.ApplicationCustomSettings&&null==t.ApplicationCustomSettings.EnableWacFallback&&(t.ApplicationCustomSettings.EnableWacFallback=!0)},t.getOnDemandServer=function(t,i){if(void 0===i&&(i=!1),t&&t.ApplicationCustomSettings&&t.ApplicationCustomSettings.OnDemandServer)return t.ApplicationCustomSettings.OnDemandServer;if(t&&t.ApplicationUrl){var n=V.tryGetPodsRegion(t.ApplicationUrl,t,i);if(n)return n.PodsURL}return t&&t.ApplicationUrl?t.ApplicationUrl.substring(0,t.ApplicationUrl.indexOf("PowerPointFrame.aspx")).replace("/p/","/pods/"):""},t.getWacStaticResourcesServer=function(t,i,n,e){if(t&&t.WacStaticResourcesServer)return t.WacStaticResourcesServer;if(n){return n.split("pods/s/")[0]+"pods/s/"}if(i){var o=V.tryGetPodsRegion(i,e,!1);if(o)return o.WacCdnStaticServer;throw Error("Application url provided but region not in region allowlist")}return"https://c1-powerpoint-15.cdn.office.net/pods/s/"},t.generateRandomHexChar=function(){var t=new Uint8Array(1);return window.self.crypto&&window.self.crypto.getRandomValues?(window.self.crypto.getRandomValues(t),Math.floor(t[0]/16).toString(16)):window.msCrypto&&window.msCrypto.getRandomValues?(window.msCrypto.getRandomValues(t),Math.floor(t[0]/16).toString(16)):Math.floor(16*Math.random()).toString(16)},t.generateRandomUUID=function(){return"xxxxxxxx-xxxx-4xxx-xxxx-xxxxxxxxxxxx".replace(/[x]/g,this.generateRandomHexChar)},t.getSlideShowKind=function(t){return window.location.search.indexOf("wdForceModernSlideShowInTeams")>=0||t.SessionInformation&&t.SessionInformation.WdParams&&t.SessionInformation.WdParams.wdForceModernSlideShowInTeams||null!=t.ApplicationUrl&&t.SessionInformation&&t.SessionInformation.WdParams&&t.SessionInformation.WdParams.wdModernSlideShowInTeams&&t.SessionInformation.WdParams.wdBrowserShapeBuilderCompatible&&t.SessionInformation.WdParams.wdIsFileTypeSupportedForModernSlideShow&&!V.IsRedirectedToWAC?"Modern":this.shouldUseLegacySlideShowAspx(t)?"Legacy":"StaticHtml"},t.getFileExtension=function(t,i){if(t){var n=t.split(".");if(n&&n.length>1){var e=n[n.length-1].toLowerCase();return i.ULS.$(578930325,I.ut,r.Info,"getFileExtension fileExtension: "+e),e}}return""},t.shouldUseLegacySlideShowAspx=function(t){return null!==t.ApplicationUrl&&(window.location.search.indexOf("wdLegacySlideShowAspx")>=0||!(window.location.search.indexOf("wdUseStaticHtmlLegacySlideShow")>=0))},t.sendInitialLog=function(t,i,n,e){""===this.s_bootstrapperInstanceIdentifier&&(this.s_bootstrapperInstanceIdentifier=this.generateRandomUUID());var o={BootstrapperType:"TypeScript"};o.Preview="Previewer"===i,o.Scenario=i,o.ApplicationUrl=this.extractHostname(t.ApplicationUrl),o.IsDeepLink=!!f("nav"),o.BootstrapperInstanceId=this.s_bootstrapperInstanceIdentifier,o.UseSlideShowService=V.shouldRouteToSlideShowService(t);var s={};o.ApplicationCustomSettings=s,t.ApplicationCustomSettings&&(s.OnDemandServer=this.extractHostname(t.ApplicationCustomSettings.OnDemandServer),s.EnableWacFallback=t.ApplicationCustomSettings.EnableWacFallback);var a={};o.SessionInformation=a,a.HostName=t.SessionInformation.HostName,a.HostSessionId=t.SessionInformation.HostSessionId,a.UiLocale=t.SessionInformation.UiLocale,a.DataLocale=t.SessionInformation.DataLocale,t.Diagnostics&&t.Diagnostics.userClickTime?a.DocumentClickTime=t.Diagnostics.userClickTime:t.SessionInformation&&t.SessionInformation.DocumentClickTime&&(a.DocumentClickTime=t.SessionInformation.DocumentClickTime.getTime()),a.HostInitTime=t.SessionInformation.HostInitTime,a.CurrentTime=(new Date).getTime(),a.ParticipantId=t.SessionInformation.ParticipantId,a.CallId=t.SessionInformation.CallId,a.TenantId=t.SessionInformation.TenantId,a.ContentId=t.SessionInformation.ContentId,a.EndpointId=t.SessionInformation.EndpointId,a.IsPresenter=t.SessionInformation.IsPresenter,a.UiHost=V.getUiHost(t.SessionInformation.HostName),a.UiHostRing=t.SessionInformation.UiHostRing,a.UiHostIsHighContrast=t.SessionInformation.UiHostIsHighContrast,a.UiHostHighContrastColorSettings=t.SessionInformation.UiHostHighContrastColorSettings,a.PreviewerPosition=t.SessionInformation.Position,a.WdParams=t.SessionInformation.WdParams,a.HostExperience=t.SessionInformation.HostExperience,a.SlideShowKind=this.getSlideShowKind(t),a.ForceModernSlideShowInTeamsQueryParam=window.location.search.indexOf("wdForceModernSlideShowInTeams")>=0,a.UseAspx=this.shouldUseLegacySlideShowAspx(t),a.IsRetry=!(!t.SessionInformation||!t.SessionInformation.IsRetry)&&t.SessionInformation.IsRetry,a.PreviousHostSessionId=t.SessionInformation&&t.SessionInformation.PreviousHostSessionId?t.SessionInformation.PreviousHostSessionId:"";var c={};o.Diagnostics=c;var u=this.getEntryPoint(t);c.EntryPoint=u,c.FileHost=V.getFileHost(t),c.PodsRing=t.ApplicationUrl?V.getPodsRing(t):"";var h={};o.WopiPrecheckInfo=h,h.FileSize=t.WopiPrecheckInfo.FileSize,h.FileGetUrlBool=!!t.WopiPrecheckInfo.FileGetUrl,h.FileNameBool=!!t.WopiPrecheckInfo.FileName,h.ReadOnly=t.WopiPrecheckInfo.ReadOnly,h.IrmEnabled=t.WopiPrecheckInfo.IrmEnabled,h.SupportsDecryptedContentDownload=t.WopiPrecheckInfo.SupportsDecryptedContentDownload,h.ViewOnly=t.WopiPrecheckInfo.ViewOnly,h.PreseededSessionKey=!!t.WopiPrecheckInfo.PreseededSessionKey,t.WopiPrecheckInfo.FileName&&(h.FileExtension=this.getFileExtension(t.WopiPrecheckInfo.FileName,e));var d={};if(t.WopiPrecheckInfo.BundleInfo){var l=t.WopiPrecheckInfo.BundleInfo;d.MajorVersion=l.MajorVersion,d.URLBool=!!l.Url,d.CrossOrigin=l.CrossOrigin}h.BundleInfo=d;var p={};o.AppInfo=p,p.AppVersionMajor=j.AppVersionMajor,p.AppVersionMinor=j.AppVersionMinor,p.Environment=j.Environment,p.UserAgent=window.navigator.userAgent,n&&(o.AdditionalTelemetry=n),e.ULS.$(22357763,I.ut,r.Info,JSON.stringify(o,this.undefinedReplacer))},t.undefinedReplacer=function(t,i){return void 0===i?null:i},t.inferFileNewFromWopiPrecheckInfo=function(t,i,n,e){var o,s;t.CreateNewInfo?(s=F.UnifiedCreateNew,o="CreateNewInfo"):t.IsNewFile?(s=F.UnifiedCreateNew,o="CreateNewInfoIsNewFile"):t.IsNewFileFromHostTemplate?(s=F.UnifiedCreateNew,o="CreateNewInfoFromHostTemplate"):n&&n.FileGetUrl?(s=F.UnifiedCreateNew,o="CreateNewInfoFromTemplateSourceUrl"):i.toLowerCase().indexOf("new=1")>=0&&0!==t.FileSize?(s=F.LegacyCreateNew,o="ApplicationUrlContainsNewAndNonZeroByteFile"):i.toLowerCase().indexOf("new=1")>=0?(s=F.UnifiedCreateNew,o="ApplicationUrlContainsNew"):(s=F.NotCreateNew,o="NotCreateNew");var a={};return a.CreateNewScenario=F[s],a.reason=o,e.ULS.$(34932951,I.ut,r.Info,JSON.stringify(a)),s},t.podsFlighting=function(t,i,n){var e=this.inferFileNewFromWopiPrecheckInfo(t.WopiPrecheckInfo,t.ApplicationUrl,t.NewFileTemplateSource,n),o=V.tryGetPodsRegion(t.ApplicationUrl,t,i);if(o){if(i&&e===F.LegacyCreateNew)return X(!1,!1,"Legacy Create New Scenario because application url contains new, but non-zero file size",e);if(window.location.search.indexOf("wdTestPreviewer=1")>=0||window.location.hash.indexOf("wdTestPreviewer=1")>=0)return X(!0,!0,"Supported Region and wdTestPreviewer/wdTestUnified set to true in Host Page URL",e);if(i&&-1!==t.ApplicationUrl.indexOf("&Embed=1"))return X(!1,!1,"Embed View fallback to WAC",e);if(o.RolloutPercentage<=0)return X(!1,!1,"PODS region Disabled",e);var s=this.getFlightingNumber(t);return n.ULS.$(38147723,I.ut,r.Info,"RolloutPercentage - "+o.RolloutPercentage+"; RolloutNumber - "+s),o.RolloutPercentage<s?X(!1,!0,"Could use PODS but this session was not selected as part of the rollout",e):X(!0,!0,"Supported Region",e)}return n.ULS.$(589168768,I.ut,r.Info,"Wac region not currently supported by PODS"),X(!1,!1,"Wac region not currently supported by PODS",e)},t.getFlightingNumber=function(t){return t.SessionInformation.UserId?Math.abs(function(t){for(var i=0,n=0;n<t.length;n+=1)i=(i<<5)-i+t.charCodeAt(n),i&=i;return i}(t.SessionInformation.UserId))/100%1:Math.random()},t.launchWacFallback=function(t,i,n,e,o,s,a){o.ULS.$(38147724,I.ut,r.Info,"Launching Wac Fallback");var c=document.createElement("iframe");c.frameBorder="0",c.style.top=H(0),c.style.bottom=H(0),c.style.left=H(0),c.style.right=H(0),c.style.height=L(1),c.style.width=L(1),c.style.minWidth=H(300),c.style.minHeight=H(200),c.style.position="absolute",c.setAttribute("allowfullscreen",(!0).toString()),c.setAttribute("allowTransparency",(!0).toString()),c.id="WebApplicationFrame",c.title="Office Online Frame",c.name="wac_frame";var u=L(1);i.Container.style.width=u,i.Container.style.height=u,i.Container.style.minHeight=H(150),i.Container.style.left=H(0),i.Container.style.right=H(0),i.Container.style.bottom=H(0),i.Container.style.top=H(0);var h=document.createElement("div");h.style.backgroundColor="#393a3d",h.style.backfaceVisibility="hidden",h.style.width=u,h.style.height=u,h.style.minHeight=H(150),h.style.left=H(0),h.style.right=H(0),h.style.bottom=H(0),h.style.top=H(0),c.style.width=u,c.style.minHeight=H(150),c.style.height=u;var f=document.createElement("form");f.name="wac_form",f.id="wac_form",f.target="wac_frame",f.action=n(t,i),f.method="post";var d=document.createElement("input");d.type="hidden",d.name="access_token",d.value=t.AccessToken,f.appendChild(d);var l=document.createElement("input");l.type="hidden",l.name="access_token_ttl",l.value=t.AccessTokenExpiry?t.AccessTokenExpiry.getTime().toString():"0",f.appendChild(l),i.Container.appendChild(f),i.Container.appendChild(h),h.appendChild(c),f.submit();var p={errorObject:{errorType:e&&5308440===e.Code?"CannotLoadBundleItem":"FatalError",errorObject:e}};s.stop();var w=s.getVisibilityChangeEvents();w&&w.length>0&&(p.documentLoadedWithTabSwitch=!0,o.ULS.$(38147725,I.ut,r.Info,"Visibility Change Events:"+JSON.stringify(w))),i.FnOnInitializeSuccess(new z(a),p)},t.extractHostname=function(t){return t?t.indexOf("://")>-1?t.split("/")[2]:t.split("/")[0]:null},t.getEntryPoint=function(t){if(!t.ApplicationUrl)return null;var i=h(t.ApplicationUrl,"wdOrigin");return i||(t.Diagnostics&&t.Diagnostics.entryPoint?t.Diagnostics.entryPoint:null)},t.findBootstrapperPerfEntry=function(t,i,n){if(t)for(var e=0;e<t.length;e+=1){var o=t[e];if(o.name.indexOf(i)>=0)return o.name.toLowerCase()!==i.toLowerCase()&&n.ULS.$(38147726,I.ut,r.Info,"Found partial match for bootstrapper URL perf entry"),o}return null},t.logBootstrapperPerformanceInfo=function(t,i,n){if(n)try{var e="https://contentstorage.osi.office.net/boot/ppt.boot.js",o=t||e;if(t||n.ULS.$(38147727,I.ut,r.Info,"Missing BootstrapperUrl, defaulting to "+e),!window.performance)return void n.ULS.$(38147728,I.ut,r.Info,"Performance API not found on browser");var s=void 0;if(window.performance.getEntriesByName&&(s=this.findBootstrapperPerfEntry(window.performance.getEntriesByName(o),o,n)),!s&&window.performance.getEntries&&(n.ULS.$(38147729,I.ut,r.Info,"Searching all entries for bootstrapper timing entry."),s=this.findBootstrapperPerfEntry(window.performance.getEntries(),o,n)),!s)return void n.ULS.$(38147730,I.ut,r.Info,"Unable to extract Bootstrapper perf info.");var a={};a.name=o,a.logReason=i,a.nameMatchesExpected=s.name===o,a.connectEnd=s.connectEnd,a.connectStart=s.connectStart,a.domainLookupEnd=s.domainLookupEnd,a.domainLookupStart=s.domainLookupStart,a.fetchStart=s.fetchStart,a.initiatorType=s.initiatorType,a.redirectEnd=s.redirectEnd,a.redirectStart=s.redirectStart,a.requestStart=s.requestStart,a.responseEnd=s.responseEnd,a.responseStart=s.responseStart,a.duration=s.duration,a.entryType=s.entryType,a.startTime=s.startTime,a.nextHopProtocol=s.nextHopProtocol,a.workerStart=s.workerStart,a.secureConnectionStart=s.secureConnectionStart,a.transferSize=s.transferSize,a.encodedBodySize=s.encodedBodySize,a.decodedBodySize=s.decodedBodySize,n.ULS.$(34928845,I.ut,r.Info,JSON.stringify(a))}catch(t){n.ULS.$(38147731,I.bt,r.Warning,"Exception extracting Bootstrapper perf info. "+t)}},t.getPostMessageToken=function(t){return!t||t.toLowerCase().indexOf("#")>-1?Math.random().toString(36).substring(2,25):t},t.appendCommonFrameUrlQueryParams=function(t,i){var n=t,e=this.getUI(i);e&&(n=K(n,"ui",e));var o=this.getDataLocale(i);o&&(n=K(n,"rs",o));var r=c(i.ApplicationUrl,"mscc");r&&(n=K(n,"mscc",r));var s=c(i.ApplicationUrl,"wdFR");s&&(n=K(n,"wdFR",s));var a=this.getEntryPoint(i);a&&(n=K(n,"wdOrigin",d(a)));var u=this.getPostMessageToken(i.PostMessageToken);return i.PostMessageToken&&(n+="&postMessageToken="+u),(i.SessionInformation.DisableChat||i.ApplicationUrl.toLowerCase().indexOf("dchat=1")>-1)&&(n=K(n,"dchat","1")),n=function(t,i){var n=i.indexOf("?");if(-1===n)return t;for(var e=t,o=0,r=i.substr(n+1).split("&");o<r.length;o++){var s=r[o].split("=");if(""===c(t,s[0])){var a=q(s[0],s[1]);a&&(e+="&"+a)}}return e}(n,i.ApplicationUrl)},t.getUI=function(t){return t.SessionInformation.UiLocale?t.SessionInformation.UiLocale:h(t.ApplicationUrl,"ui")},t.getDataLocale=function(t){return t.SessionInformation.DataLocale?t.SessionInformation.DataLocale:h(t.ApplicationUrl,"rs")},t.s_bootstrapperInstanceIdentifier="",t}(),$=function(){function t(){this.m_apiRegistry={},window.addEventListener("message",this.onMessage)}return t.getInstance=function(){return this.s_singleton||(this.s_singleton=new t),this.s_singleton},t.prototype.add=function(t,i,n,e){void 0===e&&(e=""),this.m_apiRegistry[t]=i,n&&this.sendLogToAllListeners("Add to Message Registry: "+t+", Reason: "+e,this.getLoggableDataFromMessageListenerRegistry())},t.prototype.get=function(t){return this.m_apiRegistry[t]},t.prototype.remove=function(t,i,n){void 0===n&&(n=""),this.m_apiRegistry[t]=null,i&&this.sendLogToAllListeners("Remove from Message Registry: "+t+", Reason: "+n,this.getLoggableDataFromMessageListenerRegistry())},t.prototype.sendLogToAllListeners=function(t,i){for(var n in this.m_apiRegistry){var e=this.m_apiRegistry[n];e&&e.log(t,i)}},t.prototype.getLoggableDataFromMessageListenerRegistry=function(){var t={};for(var i in this.m_apiRegistry){var n=this.m_apiRegistry[i];t[i]=n?n.hasOwnProperty("c_activated")?"PreviewSessionLoader":"PreviewSessionManagerV0":"API is Null"}return JSON.stringify(t)},t.prototype.onMessage=function(i){var n;try{n=JSON.parse(i.data)}catch(t){n=null}if(n){var e=n.m_id||n.Token;if(e){var o=t.getInstance(),r=o.get(e);r?r.onMessage(n,i.source):o.sendLogToAllListeners("Message received with no targetApi. Id: "+e.toString(),i.data)}}},t}(),Q=function(){function t(){}return t.recordBootstrapperTimeoutFailure=function(t,i,n,e,o,s,a){if(!this.isBootSuccess(i,n,e)){var c={AppMetadata:this.getAppMetadata(t),BootInfo:this.getBootInfo(t,s,!1),BundleMetadata:"[]",FatalErrors:this.getFatalErrorInfo(i,n,e),NonFatalErrors:a,WopiPrecheckInfo:this.getWopiPrecheckInfo(t)};o.ULS.$(592007955,I.ut,r.Error,JSON.stringify(c))}},t.recordBootCompleted=function(t,i,n,e,o,s,a,c){var u={AppMetadata:this.getAppMetadata(t),BootInfo:this.getBootInfo(t,s,this.isBootSuccess(i,n,e)),BundleMetadata:"[]",FatalErrors:this.getFatalErrorInfo(i,n,e),NonFatalErrors:a,WopiPrecheckInfo:this.getWopiPrecheckInfo(t),AppBootTimings:c?c.appBootTimingDict:""};o.ULS.$(587843200,I.ut,r.Info,JSON.stringify(u))},t.getWopiPrecheckInfo=function(t){return t&&t.WopiPrecheckInfo?{FileGetUrlBool:!!t.WopiPrecheckInfo.FileGetUrl,FileNameBool:!!t.WopiPrecheckInfo.FileName,ReadOnly:t.WopiPrecheckInfo.ReadOnly,SupportsDecryptedContentDownload:t.WopiPrecheckInfo.SupportsDecryptedContentDownload,ViewOnly:t.WopiPrecheckInfo.ViewOnly,PreseededSessionKey:t.WopiPrecheckInfo.PreseededSessionKey,BundleInfo:this.getBundleInfo(t.WopiPrecheckInfo.BundleInfo)}:""},t.getBundleInfo=function(t){if(t){var i=t;return{MajorVersion:i.MajorVersion,URLBool:i.Url,CrossOrigin:i.CrossOrigin}}return""},t.getAppMetadata=function(t){return t?{BrowserTechnology:"",Browser:"",FileSizeHint:t.WopiPrecheckInfo.FileSize,ApiStartTime:0,HostInitTime:t.SessionInformation.HostInitTime,AppVersion:j.AppVersionMajor+"."+j.AppVersionMinor,UseBabylon:"",EntryPoint:Z.getEntryPoint(t),SessionId:t.SessionInformation.HostSessionId,UserAgent:window.navigator.userAgent,ApplicationUrl:t.ApplicationUrl,WACRegion:V.getWACRegion(t.ApplicationUrl),FileHost:V.getFileHost(t),Host:t.SessionInformation.HostName,PodsRing:t.ApplicationUrl?V.getPodsRing(t):"",UiHost:V.getUiHost(t.SessionInformation.HostName),UiHostRing:t.SessionInformation.UiHostRing,UiHostIsHighContrast:t.SessionInformation.UiHostIsHighContrast,UiHostHighContrastColorSettings:t.SessionInformation.UiHostHighContrastColorSettings,CallId:t.SessionInformation.CallId,ContentId:t.SessionInformation.ContentId,SlideShowKind:Z.getSlideShowKind(t),UseAspx:Z.shouldUseLegacySlideShowAspx(t),HostExperience:t.SessionInformation.HostExperience,ParticipantId:t.SessionInformation.ParticipantId,EndpointId:t.SessionInformation.EndpointId,HostSessionId:t.HostSessionId,isRetry:t.SessionInformation.IsRetry,PreviousHostSessionId:t.SessionInformation.PreviousHostSessionId?t.SessionInformation.PreviousHostSessionId:"",IsPresenter:t.SessionInformation.IsPresenter}:""},t.getFatalErrorInfo=function(t,i,n){return this.isBootSuccess(t,i,n)?"":{ErrorCategory:"fatal",ExtraInfo:"",CorrelationId:"",ErrorCode:t,ErrorName:i,Message:n}},t.getBootInfo=function(t,i,n){var e=0;return null!=t.SessionInformation.DocumentClickTime&&t.SessionInformation.DocumentClickTime.getTime&&(e=t.SessionInformation.DocumentClickTime.getTime()),{PreloadCompleteTime:0,DocumentClickTime:e,BootSuccess:n,BootTime:i,BootMode:""}},t.isBootSuccess=function(t,i,n){return null==t&&null==i&&null==n},t}(),Y=function(){function t(t,i,n,e){var o=this;if(this.m_initialTicks=0,this.m_onSuccessTicks=0,this.m_onFailureTicks=0,this.m_onTimeoutTicks=0,this.m_fCallbackCalled=!1,this.m_scenario="",this.m_hostSessionId="",this.m_host="",this.errorCode=5,this.errorName="TimeoutInitialize",this.m_aborted=!1,this.m_callbackTimeoutError={errorType:"AppInitError",errorObject:"Timed out waiting for FnOnInitializeSuccess",Category:0,Code:this.errorCode,ErrorName:this.errorName,EventType:13,ExtraInfo:"Initialization timeout"},this.m_scenario=n,this.m_appErrors=e,t){if(t.FnOnInitializeSuccess){var s=t.FnOnInitializeSuccess;t.FnOnInitializeSuccess=function(n,e){o.m_onSuccessTicks=Date.now(),o.m_fCallbackCalled||(o.m_fCallbackCalled=!0,o.m_onTimeoutTicks?o.logCallbackArrivedAfterTimeout("success",e,i):(i&&(i.ULS.$(38836226,I.ut,r.Info,"TimeoutWrapper: Calling fnOnInitializeSuccess"),Q.recordBootCompleted(t,null,null,null,i,Date.now(),o.m_appErrors,e)),s(n,e)))}}if(t.FnOnInitializeFailure){var a=t.FnOnInitializeFailure;t.FnOnInitializeFailure=function(n,e){if(o.m_onFailureTicks=Date.now(),!o.m_fCallbackCalled)if(o.m_fCallbackCalled=!0,o.m_onTimeoutTicks&&n!==o.m_callbackTimeoutError)o.logCallbackArrivedAfterTimeout("failure",e,i,n);else{if(i){var s=n;Q.recordBootCompleted(t,s.Code,s.ErrorName,s.errorObject,i,Date.now(),o.m_appErrors,e),i.ULS.$(38836227,I.ut,r.Info,"TimeoutWrapper: Calling fnOnInitializeFailure")}a(n,e)}}}t.SessionInformation&&(this.m_hostSessionId=t.SessionInformation.HostSessionId,this.m_host=t.SessionInformation.HostName)}this.tryStartTimeout(t,i)}return t.addTimeoutWrappersToHostCallbacks=function(i,n,e,o){return new t(i,n,e,o)},t.prototype.tryStartTimeout=function(t,i){var n=this;this.m_initialTicks=Date.now();var e=6e4,o=f("wdOnSuccessTimeout");o&&parseInt(o,10).toString()===o&&(e=parseInt(o,10)),e&&window.setTimeout((function(){return n.timeoutIfSuccessNotCalled(t,i)}),e)},t.prototype.logCallbackArrivedAfterTimeout=function(t,i,n,e){var o={};o.Message="Received "+t+" callback after timeout had elapsed",o.timeoutTimeMs=this.m_onTimeoutTicks,o.successTimeMs=this.m_onSuccessTicks,o.startTimeMs=this.m_initialTicks,o.appInitDiagnostics=i,e&&(o.error=e),n&&n.ULS.$(38589660,I.ut,r.Info,JSON.stringify(o))},t.prototype.timeoutIfSuccessNotCalled=function(t,i){if(!(this.m_onFailureTicks||this.m_onSuccessTicks||this.m_onTimeoutTicks||this.m_aborted)){this.m_onTimeoutTicks=Date.now();try{var n=t.Container;if(!((o=n)&&o.parentNode&&(o.id?document.getElementById(o.id):void 0!==o.isConnected?o.isConnected:document.body.contains(o))))i&&(i.ULS.$(579604899,I.ut,r.Warning,"App container is unloaded. Scenario: "+this.m_scenario),Q.recordBootCompleted(t,7,"AppContainerUnloadedTimeout","App container is unloaded",i,this.m_onTimeoutTicks,this.m_appErrors));else{if(i){var e="Timed out waiting for FnOnInitializeSuccess to be called. startMs:"+this.m_initialTicks+", timeoutMs:"+this.m_onTimeoutTicks+", scenario:"+this.m_scenario+", hostSessionId:"+this.m_hostSessionId+", host: "+this.m_host;i.ULS.$(38589661,I.ut,r.Error,e),Q.recordBootstrapperTimeoutFailure(t,this.errorCode,this.errorName,e,i,this.m_onTimeoutTicks,this.m_appErrors)}t.FnOnInitializeFailure&&t.FnOnInitializeFailure(this.m_callbackTimeoutError)}}catch(t){i&&i.ULS.$(579604898,I.ut,r.Error,"timeoutIfSuccessNotCalled exception: "+t)}var o}},t}(),tt=function(){function t(t,i,n,e,o,r,s){this.BootFailed=!1,this.InitializeWopiPendingParameters=t,this.m_forceWacFallback=i,this.GetFallbackUrl=n,this.OnSuccessWopiInfoCallback=e,this.logger=o,this.windowVisibilityMetrics=r,this.m_postMessageToken=s}return t.prototype.wopiPendingApplicationComplete=function(t,i){this.m_forceWacFallback||this.BootFailed?Z.launchWacFallback(t,this.InitializeWopiPendingParameters,this.GetFallbackUrl,this.BootFailureInfo,this.logger,this.windowVisibilityMetrics,this.m_postMessageToken):(this.ReturnedWopiInfo=t,this.OnSuccessWopiInfoCallback&&this.OnSuccessWopiInfoCallback(this.ReturnedWopiInfo,i))},t.prototype.wopiPendingApplicationFail=function(t){this.logger.ULS.$(38293905,I.ut,r.Info,"Host failed to give us WopiInfo")},t}(),it=function(){function t(){var t=this;if(this.visibilityChangeEvents=[],this.handleVisibilityChange=function(){var i={visibility:document.visibilityState,time:Date.now(),initialState:!1};t.visibilityChangeEvents.push(i)},"hidden"===document.visibilityState){var i={visibility:document.visibilityState,time:Date.now(),initialState:!0};this.visibilityChangeEvents.push(i)}document.addEventListener("visibilitychange",this.handleVisibilityChange)}return t.prototype.stop=function(){document.removeEventListener("visibilitychange",this.handleVisibilityChange)},t.prototype.getVisibilityChangeEvents=function(){return this.visibilityChangeEvents},t}();function nt(){return N()||/android.+mobile/i.test(x.userAgent)}var et=function(){function t(){}return t.validateParametersWopiPending=function(t){if(void 0===t)throw new TypeError("initParams");var i=t.Container;if(void 0===i||void 0===i.appendChild)throw new TypeError("Container");var n=t.SessionInformation;if(void 0===n||void 0===n.HostName||void 0===n.HostSessionId||void 0===n.UserId)throw new TypeError("SessionInformation");var e=t.ApplicationUrl;if(void 0===e||"string"!=typeof e)throw new TypeError("ApplicationUrl");var o=t.WopiPrecheckInfo;if(void 0===o||void 0===o.FileName)throw new TypeError("WopiPrecheckInfo");if(void 0===t.FnOnInitializeSuccess)throw new TypeError("FnOnInitializeSuccess");if(void 0===t.FnOnInitializeFailure)throw new TypeError("FnOnInitializeFailure")},t.createNewGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var i=16*Math.random()|0;return("x"===t?i:3&i|8).toString(16)}))},t}();function ot(t){for(var i=t,n="",e=0,o=window.location.search.substring(1,window.location.search.length).split("&");e<o.length;e++){"wdoverrides"===(u=o[e].split("="))[0]&&(n=u[1]);var r=q(u[0],u[1]);r&&(i+="&"+r)}for(var s=[],a=0,c=(n=n||"").split(",");a<c.length;a++){var u;2===(u=c[a].split(":")).length&&"devicepixelratio"!==u[0].toLowerCase()&&s.push(u[0]+":"+u[1])}return s.push("devicepixelratio:"+(window.devicePixelRatio||(window.screen?window.screen.deviceXDPI/window.screen.logicalXDPI:1)||1)),s.push("RenderGifSlideShow:true"),i=K(i,"wdoverrides",s.join(","))}var rt,st=function(){function t(t,i,n){var e=this;if(this.messageListener=function(t){return e.handleWacFramePostMessage(t)},this.eventHandlers={},!t)throw new Error("Missing origin for PostMessageHandler");this.innerApplicationFrame=n,this.logger=i,this.origin=t.toLowerCase(),window.addEventListener("message",this.messageListener,!1)}return t.prototype.registerMessagePayloadHandler=function(t,i){if(this.eventHandlers[t])throw new Error("Duplicate registration!");this.eventHandlers[t]=i},t.prototype.removeMessageHandler=function(t){delete this.eventHandlers[t]},t.prototype.sendPostMessage=function(t,i,n){this.logger.ULS.$(594121927,I.ut,r.Info,"PostMessageHandler - Sending message: "+i);var e={MessageId:i,SendTime:Date.now(),Values:n};this.sendPostMessageInternal(t,JSON.stringify(e),this.origin)},t.prototype.dispose=function(){window.removeEventListener("message",this.messageListener,!1),delete this.eventHandlers},t.prototype.handleWacFramePostMessage=function(t){if(t.origin&&t.origin.toLowerCase()===this.origin){if(this.innerApplicationFrame){if(t.source!==this.innerApplicationFrame.contentWindow){var i="ev.source.location = "+t.source.location+" doesnt match innerApplicationFrame.contentwindow";this.innerApplicationFrame.contentWindow&&(i+=" = "+this.innerApplicationFrame.contentWindow.location),this.logger.ULS.$(593884162,I.ut,r.Error,i)}}else this.logger.ULS.$(593884163,I.ut,r.Error,"inner application frame is null");var n;try{n=JSON.parse(t.data)}catch(t){return void this.logger.ULS.$(594121926,I.ut,r.Error,"PostMessageHandler - failed to parse event data: "+JSON.stringify(t))}var e=n.MessageId;if(e){if("App_RefreshSessionInfo"===e){var o=n.CorrelationId;this.logger.ULS.$(594121925,I.ut,r.Info,"Got App_RefreshSessionInfo message from app. CorrelationId: "+o)}var s=this.eventHandlers[e];s?(this.logger.ULS.$(594121923,I.ut,r.Info,"PostMessageHandler - processing message: "+e),s(n.Values||{})):this.logger.ULS.$(594121924,I.ut,r.Info,"PostMessageHandler - no handler found for message id: "+e)}}},t.prototype.sendPostMessageInternal=function(t,i,n){t.postMessage(i,n)},t}(),at=function(){function t(t,i,n,e,o,r){this.eventHandlers={},this.m_disposeTelemetry={},this.c_wacFrameUnloadTimeoutInMs=1e3,this.m_unloading=!1,this.m_disposed=!1,this.m_sessionId=t,this.m_disposeCallback=i,this.m_frame=n,this.m_logger=e,this.m_postMessenger=r,this.m_postMessenger.registerMessagePayloadHandler("App_Unloaded",this.handleAppUnloaded.bind(this)),this.m_postMessenger.registerMessagePayloadHandler("App_DocReboot",this.handleAppDocReboot.bind(this)),this.m_postMessenger.registerMessagePayloadHandler("App_CreateNewDocument",this.handleAppCreateNewDocument.bind(this)),o&&this.m_postMessenger.registerMessagePayloadHandler("App_AccessibilityLoopComplete",this.handleAccessibilityLoopComplete.bind(this))}return t.prototype.GetApplicationType=function(){return"PowerPoint"},t.prototype.GetVersion=function(){return U()},t.prototype.GetSessionId=function(){return this.m_sessionId},t.prototype.RegisterEventHandler=function(t,i){if(void 0!==t){if(this.eventHandlers[t])throw new Error("Duplicate registration");this.eventHandlers[t]=i}},t.prototype.RemoveEventHandler=function(t,i){this.eventHandlers[t]!==i&&delete this.eventHandlers[t]},t.prototype.RegisterErrorHandler=function(t){throw void 0!==t&&(this.errorHandler=t),Error("Not Implemented")},t.prototype.RemoveErrorHandler=function(t){throw void 0!==t&&delete this.errorHandler,Error("Not Implemented")},t.prototype.triggerDocReboot=function(t){this.raiseEvent("DocReboot",t)},t.prototype.Dispose=function(t){if(!(this.m_disposed||this.m_unloading&&t))if(this.m_disposeTelemetry.DisposeStart=Date.now(),t){if(this.m_unloading=!0,this.m_disposeTelemetry.HostUnloadSent=Date.now(),!this.m_frame||!this.m_frame.contentWindow)throw Error("null frame or window");this.m_postMessenger.sendPostMessage(this.m_frame.contentWindow,"Host_Unload",{}),window.setTimeout(this.handleApplicationUnloadTimeout.bind(this),this.c_wacFrameUnloadTimeoutInMs),this.m_postMessenger&&this.m_postMessenger.dispose()}else this.disposeInternal()},t.prototype.disposeInternal=function(){this.m_disposed||(this.m_disposed=!0,this.m_unloading=!1,this.m_disposeCallback&&this.m_disposeCallback(this.m_sessionId),this.raiseEvent("Unloaded",{}),this.m_disposeTelemetry.DisposeDone=Date.now(),this.m_disposeTelemetry.SessionId=this.m_sessionId,this.m_logger.ULS.$(41710159,I.ut,r.Info,JSON.stringify(this.m_disposeTelemetry)),delete this.eventHandlers,delete this.errorHandler)},t.prototype.handleAppUnloaded=function(t){this.m_disposeTelemetry.AppUnloadedReceived=Date.now(),t&&(this.m_disposeTelemetry.WacDisposeTelemetry=t),this.disposeInternal()},t.prototype.handleApplicationUnloadTimeout=function(){!this.m_unloading&&this.m_disposed||(this.m_logger.ULS.$(41710160,I.ut,r.Warning,"Unload timed out"),this.m_disposeTelemetry.AppUnloadTimedout=Date.now()),this.disposeInternal()},t.prototype.handleAccessibilityLoopComplete=function(t){window.parent!==window&&this.m_postMessenger.sendPostMessage(window.parent,"App_AccessibilityLoopComplete",t),this.raiseEvent("App_AccessibilityLoopComplete",t)},t.prototype.handleAppDocReboot=function(t){this.triggerDocReboot(t)},t.prototype.handleAppCreateNewDocument=function(t){this.raiseEvent("App_CreateNewDocument",t)},t.prototype.raiseEvent=function(t,i){var n=this.eventHandlers[t];n&&n(i||{})},t}(),ct=function(t,i){this.Width=t,this.Height=i},ut=function(){function t(){}return t.adjustDimensionsForScrollbars=function(t,i,n,e){var o=new ct(t.Width,t.Height),r=o.Width<i;return r&&(o.Height-=e),o.Height<n&&(o.Width-=e),!r&&o.Width<i&&(r=!0,o.Height-=e),o.Width=Math.max(o.Width,i),o.Height=Math.max(o.Height,n),o},t.getAdjustedSlideDimensions=function(i,n){var e=n.Width,o=n.Height;return o-=t.EditNotesHeightPeek+1,e-=t.AreaWidth+1+t.DefaultScrollbarSize,t.calculateAvailableSlideDimensions(new ct(e,o),i)},t.calculateAvailableSlideDimensions=function(i,n){var e=new ct(i.Width-2*t.SlidePadding,i.Height-2*t.SlidePadding),o=new ct(n.Width/2,n.Height/2),r=new ct(2*n.Width,2*n.Height);return e.Width<o.Width?e.Width=o.Width:e.Width>r.Width&&(e.Width=r.Width),e.Height<o.Height?e.Height=o.Height:e.Height>r.Height&&(e.Height=r.Height),e},t.calculateEditingAreaDimensions=function(){var i=t.adjustDimensionsForScrollbars(new ct(window.document.documentElement.clientWidth,window.document.documentElement.clientHeight-t.UnifiedHeaderHeight),t.EditAreaMinimumWidth,t.EditAreaMinimumHeight,t.DefaultScrollbarSize);return(""+document.cookie).indexOf("WACRibbonMinimizedPPT=true")>=0&&(i.Height-=M()?t.EditLowerRibbonHeightTouchPx:t.EditLowerRibbonHeightMousePx),i.Height-=t.EditDefaultRibbonHeight,i.Height-=t.StatusBarHeight,i},t.UnifiedHeaderHeight=50,t.EditAreaMinimumWidth=320,t.EditAreaMinimumHeight=256,t.DefaultScrollbarSize=17,t.EditDefaultRibbonHeight=30,t.EditLowerRibbonHeightMousePx=94,t.EditLowerRibbonHeightTouchPx=108,t.StatusBarHeight=23,t.EditNotesHeightPeek=32,t.AreaWidth=238,t.SlidePadding=10,t}();!function(t){t[t.AppPageLoading=0]="AppPageLoading",t[t.AppReadyForPostMessage=1]="AppReadyForPostMessage",t[t.AppBootComplete=2]="AppBootComplete",t[t.DEPRECATED=3]="DEPRECATED",t[t.RefreshPage=4]="RefreshPage",t[t.UpdateInitializationComplete=6]="UpdateInitializationComplete",t[t.AppError=7]="AppError"}(rt||(rt={}));var ht=function(){function t(){this.m_hasAppBooted=!1}return t.prototype.getIfAllFieldsSet=function(){if(this.m_wopiInfo&&this.m_hasAppBooted&&this.m_iframe&&this.m_podsUrl)return{m_wopiInfo:this.m_wopiInfo,m_iframe:this.m_iframe,m_podsUrl:this.m_podsUrl,m_readonly:this.m_readonly,m_hasAppBooted:this.m_hasAppBooted,m_irmEnabled:this.m_irmEnabled,m_supportsDecryptedContentDownload:this.m_supportsDecryptedContentDownload,m_fileName:this.m_fileName}},t}(),ft=function(){function t(i,n){var o=this;this.m_wopiBootParams=new ht,this.m_bootCompleted=!1,this.m_appErrors=[],this.c_appErrorThrottleCount=5,this.windowVisibilityMetrics=new it;var s=void 0;try{et.validateParametersWopiPending(i),Z.ensureInitializeParametersAreTheRightType(i),i.ApplicationUrl=function(t,i){if(!i)return t;var n=t.match(/(^http[s]:\/\/)((?!word)\w*[-])?(.*)/i);return n?""+n[1]+i+"-"+n[3]:t}(i.ApplicationUrl,c(i.ApplicationUrl,"region")),i.ApplicationUrl=u(i.ApplicationUrl,"region");var h=i.SessionInformation.HostSessionId;i.ApplicationCustomSettings||(i.ApplicationCustomSettings={}),i.ApplicationCustomSettings.OnDemandServer=Z.getOnDemandServer(i,!0);var f=n||et.createNewGuid(),d=!1;i.WopiPrecheckInfo&&i.WopiPrecheckInfo.PreseededWacSessionId&&(f=i.WopiPrecheckInfo.PreseededWacSessionId,d=!0),s=_({remoteUlsEndpoint:i.ApplicationCustomSettings.OnDemandServer+"RemoteUls.ashx",sessionId:f}),this.logger=s,Y.addTimeoutWrappersToHostCallbacks(i,s,"Unified",this.m_appErrors),s.ULS.$(38580693,I.ut,r.Warning,"PPTBootstrapper - initializing session. Build version: "+U()+"; UserSessionId: "+f+"; IsSessionIdPreseeded: "+d+"; IsSessionIdToUseProvided: "+!!n),s.ULS.$(38580694,I.ut,r.Info,"Bootstrapper Init Time: "+(new Date).getTime()),s.ULS.$(573122008,I.ut,r.Info,"WacStaticResourcesServer :"+!!i.ApplicationCustomSettings.WacStaticResourcesServer),this.m_featureManager=B(i.FnIsFeatureEnabled,s),window.addEventListener("unload",(function(){s.ULS.$(41157219,I.ut,r.Warning,"Unloading bootstrapper window."),o.m_appErrors.length>0&&s.ULS.$(588044118,I.ut,r.Warning,JSON.stringify(o.m_appErrors)),s.ULS.flushOnClose()})),this.logBeforeUnload=function(){return o.logPageState(s,"OnBeforeUnload",!0)},this.logPageHide=function(){return o.logPageState(s,"OnPageHide",!0)},this.logVisibilityChange=function(){return o.logPageState(s,"VisibilityChange_"+document.visibilityState,!0)},window.addEventListener("beforeunload",this.logBeforeUnload,{capture:!0,once:!0}),window.addEventListener("pagehide",this.logPageHide,{capture:!0}),window.addEventListener("visibilitychange",this.logVisibilityChange,{capture:!0}),s.ULS.$(38580695,I.ut,r.Info,"Application.InitializeWopiPending"),i.WopiPrecheckInfo.BundleInfo||(i.WopiPrecheckInfo.BundleInfo={MajorVersion:0});var l=Z.getPostMessageToken(h),p={};p.PostMessageToken=l,Z.sendInitialLog(i,"Unified App",p,s);var w=this.shouldUseUnifiedApp(i);this.logShouldUsePods(w,i.ApplicationUrl);var v=w.ShouldUsePODS;if(v){try{var m=i.Diagnostics&&i.Diagnostics.userClickTime;if(m){var g=parseInt(m,10);if(g<=(new Date).getTime()-6e4)s.ULS.$(588804127,I.ut,r.Warning,"Bad userClickTime or Host took 60+s to kick off the InitializeWopiPending from click");else if(this.isLocalStorageSupported()){var S=localStorage.getItem("lastUserClickTime");if(S){var P=parseInt(S,10);P&&g<=P?s.ULS.$(588804126,I.ut,r.Warning,"Bad userClickTime: it's less than or equal to lastUserClickTime; delta: "+(P-g)):localStorage.setItem("lastUserClickTime",g.toString())}else localStorage.setItem("lastUserClickTime",g.toString())}}}catch(t){s.ULS.$(588804125,I.ut,r.Error,"Error when detecting bad userClickTime: "+t)}i.IsFileNew=w.CreateNewScenario!==F.NotCreateNew,i.PostMessageToken=l,i.WopiPrecheckInfo.ReadOnly=i.WopiPrecheckInfo.ReadOnly||!1;var b=this.createFrame(i.Container,i,f);if(null===b){var C={Message:"Error creating IFrame",HostSessionId:i.SessionInformation.HostSessionId};throw s.ULS.$(38580696,I.ut,r.Error,JSON.stringify(C)),Error("Error Creating IFrame")}if(s.ULS.$(50376725,I.ut,r.Warning,"Assigning wopiBootParams"),this.m_iframe=b.IFrameElement,this.m_wopiBootParams&&(this.m_wopiBootParams.m_iframe=b.IFrameElement,this.m_wopiBootParams.m_podsUrl=this.getPodsUrl(i),this.m_wopiBootParams.m_readonly=i.WopiPrecheckInfo.ReadOnly,this.m_wopiBootParams.m_irmEnabled=i.WopiPrecheckInfo.IrmEnabled,this.m_wopiBootParams.m_supportsDecryptedContentDownload=i.WopiPrecheckInfo.SupportsDecryptedContentDownload,this.m_wopiBootParams.m_fileName=i.WopiPrecheckInfo.FileName),this.m_postMessageHandler=new st(a(i.ApplicationUrl),s,b?b.IFrameElement:null),this.m_postMessageHandler.registerMessagePayloadHandler("App_IsFrameTrusted",this.handleTrustFrameRequest.bind(this)),s.ULS.$(50376726,I.ut,r.Warning,"Assigning SessionInformation.WdParams"),this.m_sessionContext=i.SessionInformation.SessionContext?i.SessionInformation.SessionContext:"",this.m_wdParams="",i.SessionInformation.WdParams)for(var E in i.SessionInformation.WdParams)this.isWdPopOrWdPodParam(E)||(this.m_wdParams=this.m_wdParams+"&"+E+"="+i.SessionInformation.WdParams[E]);var T=e(e({},i.Diagnostics),{hostName:i.SessionInformation.HostName});T.officeFrameCreateTime=b.FrameCreateTime,T.cacheHit=!1,this.m_appData={AppInitDiagnostics:T,InitParams:i};var O=$.getInstance();O&&O.add(l,this,!1)}s.ULS.$(50376727,I.ut,r.Warning,"Creating WacFallbackController");var x=new tt(i,!v,(function(i,n){return t.getWacFallbackUrl(i,n)}),(function(t,i){o.onWopiInfoReceived(t,w.CreateNewScenario,i)}),s,this.windowVisibilityMetrics,l);this.m_wopiPendingApplication={Complete:function(t,i){x.wopiPendingApplicationComplete(t,i)},Fail:function(t){x.wopiPendingApplicationFail(t)}},Z.logBootstrapperPerformanceInfo(i.BootstrapperUrl,"UnifiedTSBoot",s),window.setTimeout((function(){s&&s.ULS.flush()}),1e4)}catch(t){s&&(s.ULS.$(38580697,I.ut,r.Error,"AppInitError: "+JSON.stringify(t,Object.getOwnPropertyNames(t))),s.ULS.flushOnClose()),i.FnOnInitializeFailure({errorType:"AppInitError",errorObject:t})}}return t.prototype.shouldUseUnifiedApp=function(i){var n=f("wdPodsEnabled");if(n){var e=Z.inferFileNewFromWopiPrecheckInfo(i.WopiPrecheckInfo,i.ApplicationUrl,i.NewFileTemplateSource,this.logger);return t.hasFileGetUrlForEdit(i,X("false"!==n,!0,"wdPodsEnabled is available",e))}return t.hasFileGetUrlForEdit(i,Z.podsFlighting(i,!0,this.logger))},t.hasFileGetUrlForEdit=function(t,i){return t.WopiPrecheckInfo.FileGetUrl||i.CreateNewScenario!==F.NotCreateNew?i:X(!1,!1,i.Reason+"| FileGetUrl is empty",i.CreateNewScenario)},t.prototype.logShouldUsePods=function(t,i){var n={ShouldUsePodsOrCached:t.ShouldUsePODS,ShouldUsePods:t.ShouldUsePODS,CanUsePods:t.CanUsePODS,ApplicationUrl:Z.extractHostname(i),Reason:t.Reason,CreateNewScenario:F[t.CreateNewScenario]};this.logger.ULS.$(38580687,I.ut,r.Info,JSON.stringify(n))},t.getHostSessionId=function(t){return!t||t.toLowerCase().indexOf("#")>-1?Math.random().toString(36).substring(2,25):t},t.prototype.createFrame=function(i,n,e){if(!n.IsFileNew){if(!n.WopiPrecheckInfo.FileGetUrl)throw Error("Missing FileGetUrl from contentParams");if(!n.WopiPrecheckInfo.FileName)throw Error("Null or Empty Filename")}var o=this.getPodsUrl(n);if(!o)throw Error("Invalid Pods URL");var s=this.getPopsUrl(n);if(!s)throw Error("Invalid Pops URL");var a=ut.calculateEditingAreaDimensions(),u=ut.getAdjustedSlideDimensions(new ct(848,477),a),l="true"===f("wdEmbedView")||-1!==n.ApplicationUrl.indexOf("&Embed=1"),p=l?"pptEmbed.aspx":"ppt.aspx",w=nt();this.logger.ULS.$(51380293,I.ut,r.Info,"IsRequestForMobileView:"+w);var v=o+(p=w?"pptMobileApp.aspx":p)+"?wdPodsUrl="+d(o)+"&wdPopsUrl="+d(s)+"&fastBoot=true&sw="+u.Width+"&sh="+u.Height+"&thPanel="+a.Height+"&ro="+n.WopiPrecheckInfo.ReadOnly+"&sftc=1&NoAuth=1&jsApi=1&jsapiver=v1";n.WopiPrecheckInfo.FileName&&(v+="&fileName="+d(n.WopiPrecheckInfo.FileName));var m=f("wdfs");m&&(v+="&fslide="+m);var g=f("wdfsection");g&&(v+="&fsection="+g);var S=f("wdIncludeHostUrl");(m||g||S&&"false"!==S)&&(v=K(v,"frameURL",d(window.location.href))),v=ot(v),v=Z.appendCommonFrameUrlQueryParams(v,n),n.IsFileNew&&(v+="&new=1"),n.NewFileTemplateSource&&n.NewFileTemplateSource.FileSize?v+="&fs="+n.NewFileTemplateSource.FileSize:n.WopiPrecheckInfo.FileSize&&(v+="&fs="+n.WopiPrecheckInfo.FileSize);var P=t.getHostSessionId(n.SessionInformation.HostSessionId);n.SessionInformation.HostSessionId&&(v+="&hid="+P);var b=f("Automation");b&&(v+="&Automation="+b);var _=f("StartRehearsal");_&&(v+="&StartRehearsal="+_),e&&!l&&(v+="&usid="+e),n.ApplicationUrl.toLowerCase().indexOf("uiembed=1")>-1&&(v+="&uiEmbed=1"),n.SessionInformation.SupportsAccessibilityLoop&&(v+="&accloop=1");var C=h(n.ApplicationUrl,"uih");C&&(v+="&uih="+C),n.SessionInformation.UiHostIntegrationType&&(v+="&uihit="+d(n.SessionInformation.UiHostIntegrationType)),n.SessionInformation.HighContrastMode&&(v+="&hcm="+d(n.SessionInformation.HighContrastMode));var E=f("nav");if(null!==E&&""!==E||(E=c(n.ApplicationUrl,"actNavId")),E)try{var U=function(t){var i=(t+"===").substring(0,t.length+(4-t.length%4)%4);return i=(i=i.replace(/-/g,"+")).replace(/_/g,"/"),atob(i)}(E),T=JSON.parse(U),x=T.sId;x&&(v=K(v,"wdSlideId",x),v=K(v,"DC","1"));var y=T.commentId;y&&"null"!==y&&(v=K(v,"wdCommentId",y));var N=T.openMode;N&&"null"!==N&&(v=K(v,"wdOpenMode",N))}catch(t){this.logger.ULS.$(38580688,I.ut,r.Error,"Failed to parse navigation ID: "+E)}if(i){var R=document.createElement("iframe");R.frameBorder="0",R.style.top=H(0),R.style.bottom=H(0),R.style.left=H(0),R.style.right=H(0),R.style.height=L(1),R.style.width=L(1),R.style.minWidth=H(300),R.style.minHeight=H(200),R.style.position="absolute",R.setAttribute("allowfullscreen",(!0).toString()),R.setAttribute("allowTransparency",(!0).toString());var D="autoplay;";if(A()===O.Safari)D+="microphone;",D+="camera;";else{var F=o+" "+Z.getWacStaticResourcesServer(n.ApplicationCustomSettings,n.ApplicationUrl,n.BootstrapperUrl,n)+";";D+="microphone "+F,D+="camera "+F}R.setAttribute("allow",D),R.id="WebApplicationFrame",R.name="wac_frame",R.title="Office Online Frame",i.style.top=H(0),i.style.bottom=H(0),i.style.left=H(0),i.style.right=H(0),i.style.height=L(1),i.style.width=L(1),i.style.minWidth=H(300),i.style.minHeight=H(200),i.appendChild(R);var B=Date.now(),k=void 0,J=void 0;n.NewFileTemplateSource&&n.NewFileTemplateSource.FileGetUrl&&(J=n.NewFileTemplateSource.FileGetUrl),k=n.WopiPrecheckInfo.FileGetUrl,this.logger.ULS.$(38580689,I.ut,r.Info,k?k.toString().length.toString():"null"),v+="&fileGetUrlBool="+!!k;var V=document.createElement("form");if(V.name="frameForm",V.id="frameForm",V.target="wac_frame",V.action=v,V.method="post",i.appendChild(V),n.WopiInfo){var j=n.WopiInfo.WopiSrc;j&&V.appendChild(t.createHiddenInputElement("WOPISrc",j));var z=n.WopiInfo.AccessToken;z&&V.appendChild(t.createHiddenInputElement("access_token",d(z)));var G=n.WopiInfo.AccessTokenExpiry;G&&V.appendChild(t.createHiddenInputElement("access_token_ttl",G.getTime().toString()))}k&&V.appendChild(t.createHiddenInputElement("fileUrl",k)),J&&V.appendChild(t.createHiddenInputElement("templateUrl",J)),n.SessionInformation.UserId&&(V.appendChild(t.createHiddenInputElement("UserID",n.SessionInformation.UserId)),V.appendChild(t.createHiddenInputElement("user_id",n.SessionInformation.UserId))),n.WopiPrecheckInfo.IrmEnabled&&V.appendChild(t.createHiddenInputElement("irmEnabled",n.WopiPrecheckInfo.IrmEnabled.toString())),n.WopiPrecheckInfo.SupportsDecryptedContentDownload&&V.appendChild(t.createHiddenInputElement("SupportsDecryptedContentDownload",n.WopiPrecheckInfo.SupportsDecryptedContentDownload.toString())),n.WopiPrecheckInfo.ViewOnly&&V.appendChild(t.createHiddenInputElement("ViewOnly",n.WopiPrecheckInfo.ViewOnly.toString())),n.NewFileTemplateSource&&n.NewFileTemplateSource.ETag?V.appendChild(t.createHiddenInputElement("ETag",n.NewFileTemplateSource.ETag)):n.WopiPrecheckInfo.ETag&&V.appendChild(t.createHiddenInputElement("ETag",n.WopiPrecheckInfo.ETag)),n.WopiPrecheckInfo.CTag&&V.appendChild(t.createHiddenInputElement("RevID",n.WopiPrecheckInfo.CTag)),n.NewFileTemplateSource&&n.NewFileTemplateSource.DocUniqueId?V.appendChild(t.createHiddenInputElement("DocID",n.NewFileTemplateSource.DocUniqueId)):n.WopiPrecheckInfo.DocUniqueId&&V.appendChild(t.createHiddenInputElement("DocID",n.WopiPrecheckInfo.DocUniqueId)),n.WopiPrecheckInfo.BundleInfo.Url&&V.appendChild(t.createHiddenInputElement("bundleUrl",n.WopiPrecheckInfo.BundleInfo.Url)),n.WopiPrecheckInfo.PreseededSessionKey&&!l&&V.appendChild(t.createHiddenInputElement("PreseededSessionKey",n.WopiPrecheckInfo.PreseededSessionKey)),n.SessionInformation.HostName&&V.appendChild(t.createHiddenInputElement("fileSrc",n.SessionInformation.HostName)),n.ApplicationCustomSettings&&n.ApplicationCustomSettings.HostUIControls&&V.appendChild(t.createHiddenInputElement("huictrls",JSON.stringify(n.ApplicationCustomSettings.HostUIControls))),this.m_featureManager&&V.appendChild(t.createHiddenInputElement("feature_status",function(t,i){var n={};if(Object.keys(W).forEach((function(i){var e=t.isFeatureEnabled(W[i]);void 0!==e&&(n[W[i]]=e?"1":"0")})),i&&i.wdFlights)for(var e=0,o=i.wdFlights.toLowerCase().split(",");e<o.length;e++){var r=o[e];"et-treatment"!==r&&"et-control"!==r||(n[W.xt]="et-treatment"===r?"1":"0")}return JSON.stringify(n)}(this.m_featureManager))),M()&&V.appendChild(t.createHiddenInputElement("touchDevice","1")),window.document.documentElement&&(void 0!==window.document.documentElement.clientWidth&&V.appendChild(t.createHiddenInputElement("windowWidth",window.document.documentElement.clientWidth.toString())),void 0!==window.document.documentElement.clientHeight&&V.appendChild(t.createHiddenInputElement("windowHeight",window.document.documentElement.clientHeight.toString())));var q=f("PreviousSessionID");if(q&&V.appendChild(t.createHiddenInputElement("PreviousSessionID",q)),this.isLocalStorageSupported()&&V.appendChild(t.createHiddenInputElement("LSSupported","1")),V.appendChild(t.createHiddenInputElement("postMessageToken",n.PostMessageToken)),(n.SessionInformation.HideHeader||"teams"===C||"owa"===C)&&V.appendChild(t.createHiddenInputElement("hhdr","1")),n.SessionInformation.SupportsAuthToken&&V.appendChild(t.createHiddenInputElement("sat","1")),n.SessionInformation.SupportsCreateNewDocument&&V.appendChild(t.createHiddenInputElement("scnd","1")),n.ApplicationUrl.toLowerCase().indexOf("uiembed=1")>-1&&n.SessionInformation.SupportsDocReboot&&V.appendChild(t.createHiddenInputElement("sdr",!0===n.SessionInformation.SupportsDocReboot?"1":n.SessionInformation.SupportsDocReboot.toString())),n.SessionInformation.HideWACOneDriveFileLocationPicker&&V.appendChild(t.createHiddenInputElement("hodflp","1")),n.SessionInformation.SupportsAtMentions&&V.appendChild(t.createHiddenInputElement("sams","1")),n.WopiPrecheckInfo.RequestedCallThrottling){var X=n.WopiPrecheckInfo.RequestedCallThrottling;V.appendChild(t.createHiddenInputElement("rct",X))}if(n.WopiPrecheckInfo.ClientThrottlingProtection){var $=n.WopiPrecheckInfo.ClientThrottlingProtection;V.appendChild(t.createHiddenInputElement("ctp",$))}return n.WopiPrecheckInfo.OpenViewByDefault&&V.appendChild(t.createHiddenInputElement("ovbd",n.WopiPrecheckInfo.OpenViewByDefault.toString())),n.SessionInformation.SupportsMoveToFolder&&V.appendChild(t.createHiddenInputElement("mtf","1")),n.SessionInformation.NoBrowserModalDialogs&&V.appendChild(t.createHiddenInputElement("nbmd","1")),V.submit(),{IFrameElement:R,FrameCreateTime:B}}return null},t.createHiddenInputElement=function(t,i){var n=document.createElement("input");return n.type="hidden",n.name=t,n.value=i,n},t.prototype.validateUrlHostMatchesWindowHost=function(t){var i=document.createElement("a");i.href=t;var n=i.port||80,e=window.location.port||80;return i.hostname===window.location.hostname&&n===e},t.prototype.getPodsUrl=function(t){var i=f("wdPodsUrl");return i&&!this.validateUrlHostMatchesWindowHost(i)&&(i=""),i||(i=Z.getOnDemandServer(t,!0)),"/"!==i.substr(i.length-1)&&(i+="/"),i},t.prototype.getPopsUrl=function(t){var i=f("wdPopsUrl");return i&&!this.validateUrlHostMatchesWindowHost(i)&&(i=""),i||(i=(i=this.getPodsUrl(t)).substr(0,i.indexOf("/pods/"))),"/"!==i.substr(i.length-1)&&(i+="/"),i},t.prototype.isLocalStorageSupported=function(){try{return localStorage.setItem("Test","Test"),localStorage.removeItem("Test"),!0}catch(t){return!1}},t.prototype.log=function(t){this.logger.ULS.$(39978262,I.ut,r.Info,t)},t.getUnifiedAppSessionInfo=function(t){var i={};return i.HostName=t.SessionInformation.HostName,i.HostSessionId=t.SessionInformation.HostSessionId,i.UiLocale=t.SessionInformation.UiLocale,i.DataLocale=t.SessionInformation.DataLocale,t.Diagnostics&&t.Diagnostics.userClickTime?i.DocumentClickTime=t.Diagnostics.userClickTime:t.SessionInformation&&t.SessionInformation.DocumentClickTime&&(i.DocumentClickTime=t.SessionInformation.DocumentClickTime.getTime()),i.HostInitTime=t.SessionInformation.HostInitTime,i.TenantId=t.SessionInformation.TenantId,i.UiHost=V.getUiHost(t.SessionInformation.HostName),i.UiHostRing=t.SessionInformation.UiHostRing,i.WdParams=t.SessionInformation.WdParams,i.PreviousHostSessionId=t.SessionInformation&&t.SessionInformation.PreviousHostSessionId?t.SessionInformation.PreviousHostSessionId:"",i},t.prototype.onMessage=function(i,n){var e=this,o=i;try{if(!o||!this.m_appData)return void this.logger.ULS.$(39978263,I.ut,r.Error,"Missing message data: "+!o+" or appData: "+!this.m_appData);switch(this.m_iframe&&this.m_iframe.contentWindow===n||this.logger.ULS.$(39978264,I.ut,r.Error,"Message with the right postMessageToken came from an unexpected iframe"),!o.Data.officeSessionId&&this.m_appData.AppInitDiagnostics.officeSessionId&&(o.Data.officeSessionId=this.m_appData.AppInitDiagnostics.officeSessionId),o.Data.messageType||(o.Data.messageType=o.Type),this.logger.ULS.$(38580691,I.ut,r.Warning,JSON.stringify(o.Data)),o.Type){case rt.AppPageLoading:break;case rt.AppReadyForPostMessage:this.m_wopiBootParams&&(this.m_wopiBootParams.m_hasAppBooted=!0),o.Data.officeSessionId&&(this.m_appData.AppInitDiagnostics.officeSessionId=o.Data.officeSessionId),window.setTimeout((function(){return e.tryPostWopiInfo()}),1);break;case rt.AppBootComplete:if(this.m_bootCompleted=!0,this.m_appData.InitParams.FnOnInitializeSuccess){this.m_appData.AppInitDiagnostics.officeBootstrapperVersion=U(),o.Data.officeAppEndpoint&&(this.m_appData.AppInitDiagnostics.officeAppEndpoint=o.Data.officeAppEndpoint),o.Data.officeServerVersion&&(this.m_appData.AppInitDiagnostics.officeServerVersion=o.Data.officeServerVersion),o.Data.documentLoadedTime&&(this.m_appData.AppInitDiagnostics.documentLoadedTime=o.Data.documentLoadedTime,this.m_appData.AppInitDiagnostics.appCompletedTime=o.Data.documentLoadedTime),o.Data.officeFrameFirstFlushTime&&(this.m_appData.AppInitDiagnostics.officeFrameFirstFlushTime=o.Data.officeFrameFirstFlushTime),o.Data.officeFrameDocumentFlushTime&&(this.m_appData.AppInitDiagnostics.officeFrameDocumentFlushTime=o.Data.officeFrameDocumentFlushTime),o.Data.documentFlushTime&&(this.m_appData.AppInitDiagnostics.officeFrameServerDocumentFlushTime=o.Data.documentFlushTime),o.Data.serverFirstFlushTime&&(this.m_appData.AppInitDiagnostics.officeFrameServerFirstFlushTime=o.Data.serverFirstFlushTime),o.Data.serverStartTime&&(this.m_appData.AppInitDiagnostics.officeFrameServerStartTime=o.Data.serverStartTime),o.Data.bootStartMs&&(this.m_appData.AppInitDiagnostics.officeServerDocumentProcessStartTime=o.Data.bootStartMs),o.Data.bootEndMs&&(this.m_appData.AppInitDiagnostics.officeServerDocumentProcessEndTime=o.Data.bootEndMs),o.Data.cacheHit&&(this.m_appData.AppInitDiagnostics.cacheHit=o.Data.cacheHit);var s={browserRequest:!1,status:200,isAppCompleteCritical:!0,isDocumentLoadCritical:!0,name:"BootRequest"};o.Data.downloadCorrelation&&(s.correlationId=o.Data.downloadCorrelation),o.Data.downloadStartMs&&(s.startTime=o.Data.downloadStartMs),o.Data.downloadEndMs&&(s.endTime=o.Data.downloadEndMs),o.Data.downloadSize&&(s.size=o.Data.downloadSize),o.Data.incDownload&&(s.incremental=o.Data.incDownload),this.m_appData.AppInitDiagnostics.fileRequestsData=[],this.m_appData.AppInitDiagnostics.fileRequestsData.push(s),this.windowVisibilityMetrics.stop();var c=this.windowVisibilityMetrics.getVisibilityChangeEvents();if(c&&c.length>0&&(this.m_appData.AppInitDiagnostics.documentLoadedWithTabSwitch=!0,this.logger.ULS.$(38580692,I.ut,r.Info,"Visibility Change Events:"+JSON.stringify(c))),this.logger.ULS.$(34932955,I.ut,r.Warning,JSON.stringify(this.m_appData.AppInitDiagnostics)),!this.m_postMessageHandler)throw this.logger.ULS.$(51448022,I.ut,r.Warning,"PPTUnifiedSessionLoader::onMessage::AppBootComplete null m_postMessageHandler"),Error("m_postMessageHandler");var h=function(){e.dispose()};this.m_app=new at(this.m_appData.InitParams.PostMessageToken,h,this.m_iframe||null,this.logger,!!this.m_appData.InitParams.SessionInformation.SupportsAccessibilityLoop,this.m_postMessageHandler),this.m_appData.InitParams.FnOnInitializeSuccess(this.m_app,this.m_appData.AppInitDiagnostics)}break;case rt.RefreshPage:if(this.m_appData.InitParams.ApplicationUrl.toLowerCase().indexOf("uiembed=1")>-1&&this.m_appData.InitParams.SessionInformation.SupportsDocReboot){if(!this.m_app)throw this.logger.ULS.$(51448023,I.ut,r.Info,"PPTUnifiedSessionLoader::onMessage::RefreshPage null m_app"),Error("m_app");this.m_app.triggerDocReboot(o.Data);break}var f=window.location.href;-1!==f.indexOf("&wdccsoff=1")&&(f=u(f,"wdccsoff")),o.Data.officeSessionId&&(f=K(f,"PreviousSessionID",o.Data.officeSessionId)),o.Data.ControllerServicesParam&&(f=K(f,o.Data.ControllerServicesParamName,o.Data.ControllerServicesParam)),this.logger.ULS.$(594068673,I.ut,r.Info,"PPTUnifiedSessionLoader::onMessage::RefreshPage Updating window.location.href"),window.location.href=f;break;case rt.UpdateInitializationComplete:try{if("FatalError"===o.Data.Reason){var d=t.getUnifiedAppSessionInfo(this.m_appData.InitParams),l={ErrorName:o.Data.ErrorName,BootCompleted:this.m_bootCompleted,SessionInfo:d};this.logger.ULS.$(587236555,I.ut,r.Error,JSON.stringify(l))}else this.logger.ULS.$(576583120,I.ut,r.Info,"PPTUnifiedSessionLoader::onMessage::UpdateInitializationComplete - Reason: "+o.Data.Reason)}catch(t){this.logger.ULS.$(576582732,I.ut,r.Error,"PPTUnifiedSessionLoader::onMessage::UpdateInitializationComplete Caught exception: "+t)}this.m_postMessageHandler||(this.logger.ULS.$(51448024,I.ut,r.Info,"PPTUnifiedSessionLoader::onMessage::AppBootComplete null m_postMessageHandler"),this.m_postMessageHandler=new st(a(this.m_appData.InitParams.ApplicationUrl),this.logger,this.m_iframe||null));h=function(){e.dispose()};this.m_app=new at(this.m_appData.InitParams.PostMessageToken,h,this.m_iframe||null,this.logger,!!this.m_appData.InitParams.SessionInformation.SupportsAccessibilityLoop,this.m_postMessageHandler),this.m_appData.InitParams.FnOnInitializeSuccess(this.m_app,this.m_appData.AppInitDiagnostics);break;case rt.AppError:if(this.m_appErrors.length>=this.c_appErrorThrottleCount)break;o.Data.ErrorName?this.m_appErrors.push({DuringBoot:!this.m_bootCompleted,ErrorName:o.Data.ErrorName,Tag:o.Data.Tag}):this.logger.ULS.$(574634180,I.ut,r.Warning,"PPTUnifiedSessionLoader::onMessage::AppError message data is missing required field")}}catch(t){this.logger.ULS.$(594121922,I.ut,r.Error,"PPTUnifiedSessionLoader::onMessage Caught exception: "+t)}},t.prototype.dispose=function(){var t=$.getInstance();t&&this.m_appData&&t.remove(this.m_appData.InitParams.PostMessageToken,!1),this.m_postMessageHandler&&this.m_postMessageHandler.dispose(),this.m_iframe&&this.m_iframe.parentElement&&this.m_iframe.parentElement.removeChild(this.m_iframe),this.m_iframe&&delete this.m_iframe,this.m_iframe=null,this.removePageStateLogging(),this.logger.ULS.$(587552790,I.ut,r.Warning,"PPTUnifiedSessionLoader::dispose:: App dispose"),this.windowVisibilityMetrics.stop()},t.prototype.tryPostWopiInfo=function(){var t=this.m_wopiBootParams&&this.m_wopiBootParams.getIfAllFieldsSet();if(!this.m_wopiPostMessageCalled&&t&&t.m_iframe.contentWindow){var i={};i.WopiSrc=t.m_wopiInfo.WopiSrc,i.AccessToken=t.m_wopiInfo.AccessToken,i.AccessTokenTTL=t.m_wopiInfo.AccessTokenExpiry?t.m_wopiInfo.AccessTokenExpiry.getTime():0,i.ReadOnly=t.m_readonly,i.IrmEnabled=t.m_irmEnabled,i.SupportsDecryptedContentDownload=t.m_supportsDecryptedContentDownload,i.FileName=t.m_fileName,i.SessionContext=this.m_sessionContext,i.WdParams=this.m_wdParams,i.DocumentURL=window.location.href;var n=f("PreviousSessionID");n&&(i.PreviousSessionID=n),this.setHostPerfData(i),t.m_iframe.contentWindow.postMessage(JSON.stringify(i),t.m_podsUrl),this.m_wopiPostMessageCalled=!0}},t.prototype.setHostPerfData=function(t){var i=window.self.WOPIPerf_FirstPageFlush;i&&(t.FirstPageFlushTime=i);var n=window.self.WOPIPerf_BootJsStartTime;n&&(t.BootJsStartTime=n);var e=window.self.WOPIPerf_BootJsEndTime;e&&(t.BootJsEndTime=e);var o=window.self.WOPIPerf_InitializeWac;o&&(t.InitializeWacTime=o);var r=window.self.WOPIPerf_UserClick,s=this.m_appData&&this.m_appData.AppInitDiagnostics&&this.m_appData.AppInitDiagnostics.userClickTime;if(r?t.UserClickTime=r:s&&(t.UserClickTime=s),window.performance){var a=window.performance.timing;a&&(t.NavigationStart=a.navigationStart,t.FetchStart=a.fetchStart,t.RequestStart=a.requestStart,t.ResponseStart=a.responseStart,t.ResponseEnd=a.responseEnd);var c=window.performance.navigation;c&&(t.NavigationType=c.type,t.NavigationRedirects=c.redirectCount)}},t.getWacFallbackUrl=function(t,i){if(t.WopiSrc.indexOf("PowerPointFrame.aspx")>=0){var n=t.WopiSrc.substr(t.WopiSrc.indexOf("WOPISrc=")+8),e=n.indexOf("&");t.WopiSrc=e<0?decodeURIComponent(decodeURI(n)):decodeURIComponent(n.substring(0,e))}var o=i.ApplicationUrl.indexOf("?"),r=i.ApplicationUrl.substring(0,o);return r=K(r+="?wdEnableRoaming=1&wdo=1","PowerPointView",c(i.ApplicationUrl,"PowerPointView")),i.ApplicationUrl.toLowerCase().indexOf("new=1")>=0&&(r=K(r,"New","1")),i.ApplicationUrl.indexOf("Embed=1")>=0&&(r=K(r,"Embed","1")),i.ApplicationCustomSettings&&""===i.ApplicationCustomSettings.OnDemandServer&&(r=K(r,"noLog","True")),t.WopiSrc&&(r=K(r,"WOPISrc",d(t.WopiSrc))),r=ot(r)},t.prototype.updateBrowserHistoryForCreateNew=function(t){if(t&&t.NewFilePath)window.history.replaceState(null,"",t.NewFilePath),t.UpdatedPageTitle&&(window.document.title=t.UpdatedPageTitle);else if(window.location.href.indexOf("action=editnew")>=0){var i=window.location.href.replace("action=editnew","action=edit");window.history.replaceState(null,window.document.title||"",i)}},t.prototype.onWopiInfoReceived=function(t,i,n){var e=this;this.m_wopiBootParams&&(this.m_wopiBootParams.m_wopiInfo=t),i===F.UnifiedCreateNew&&(n?this.updateBrowserHistoryForCreateNew(n):this.updateBrowserHistoryForCreateNew()),window.setTimeout((function(){return e.tryPostWopiInfo()}),1)},t.prototype.isWdPopOrWdPodParam=function(t){return t.toLocaleLowerCase().indexOf("pod")>=0||t.toLocaleLowerCase().indexOf("pop")>=0},t.prototype.logPageState=function(t,i,n){if(t){var e="Page lifecycle: "+i+" fired.";n&&(e+="Flushing ULS logger",t.ULS.flushOnClose()),t.ULS.$(579384268,I.ut,r.Warning,e)}},t.prototype.removePageStateLogging=function(){window.removeEventListener("beforeunload",this.logBeforeUnload,{capture:!0}),window.removeEventListener("pagehide",this.logPageHide,{capture:!0}),window.removeEventListener("visibilitychange",this.logVisibilityChange,{capture:!0})},t.prototype.handleTrustFrameRequest=function(){var t=window===window.top||window.parent===window.top&&window.location.origin===window.top.location.origin;this.m_iframe&&this.m_iframe.contentWindow&&this.m_postMessageHandler?this.m_postMessageHandler.sendPostMessage(this.m_iframe.contentWindow,"Host_IsFrameTrusted",{isTopFrameTrusted:t}):this.logger.ULS.$(51237655,I.ut,r.Error,"Trust frame request received but the wac frame is null")},t.prototype.getWopiPendingApplication=function(){return this.m_wopiPendingApplication},t}(),dt=function(){function t(){}return t.prototype.GetVersion=function(){return U()},t.prototype.GetMinContentVersion=function(){return 1},t.prototype.Prefetch=function(){},t.prototype.InitializeWopiPending=function(t,i,n){return new ft(t,n).getWopiPendingApplication()},t}();n.d(i,"Application",(function(){return lt}));var lt=new dt}});

"use strict";function getLogger(n,t){var i=new bUlsCache(n,t);return{ULS:{trace:function(n,t,r){return traceTagImpl(i,0,n,t,r)},traceTag:function(n,t,r,u){return traceTagImpl(i,n,t,r,u)},flush:i.flush,flushOnClose:i.flushOnClose}}}function traceTagImpl(n,t,i,r,u){if(!(r>currentLevel)){var f={timestamp:Date.now(),category:i,tag:t,level:r,type:logType.Trace,message:u};n.handleTrace(f)}}function formatForUpload(n,t,i,r){var u=n.map(function(n){return getLogEntryInWireFormat(n,r)}),f=getLogBatchInWireFormat(r,u,t,i);return JSON.stringify(f)}function getLogEntryInWireFormat(n,t){var i={},r;return i.G=n.tag,i.T=n.timestamp-t,i.M=n.message,i.C=n.category,r=n.type*shiftFactory+n.level,i.D=r,i}function getLogBatchInWireFormat(n,t,i,r){var u={};return u.T=n,u.L=t,u.S=i,u.I=r,u.V=1,u}function uploadLogs(n,t,i){if(t!==""){var r=new XMLHttpRequest;(r.readyState===XMLHttpRequest.UNSENT||r.readyState===XMLHttpRequest.DONE)&&(r.open("POST",t,i),r.send(n))}}var logLevel,ULS,currentLevel,bUlsCache,shiftFactory,logCategory,logType,PowerPointOnline;(function(n){n[n.Spam=200]="Spam";n[n.Verbose=100]="Verbose";n[n.Info=50]="Info";n[n.Warning=15]="Warning";n[n.Error=10]="Error"})(logLevel||(logLevel={}));ULS={getLogger:getLogger};currentLevel=logLevel.Info;bUlsCache=function(){function n(t,i){var r=this;this.uploadId=0;this.logCache=[];this.timestampBase=Date.now();this.userSessionId="00000000-0000-0000-0000-000000000000";this.flushOnClose=function(){r.triggerUpload(!1,!1)};this.flush=function(){r.triggerUploadAsync()};this.triggerUploadAsync=function(){window.setTimeout(function(){return r.triggerUpload(!0,!0)},0)};this.triggerUpload=function(t,i){if(window.clearTimeout(r.timeoutId),r.logCache.length>0){r.uploadId+=1;var u=formatForUpload(r.logCache,r.userSessionId,r.uploadId,r.timestampBase);uploadLogs(u,r.remoteUrlEndpoint,i);r.logCache=[];r.timestampBase=Date.now()}t&&(r.timeoutId=window.setTimeout(r.triggerUploadAsync,n.uploadCadenceInMsSec))};this.userSessionId=t;this.remoteUrlEndpoint=i+"?usid="+t;window.setTimeout(function(){return r.triggerUpload(!0,!0)},0)}return n.prototype.handleTrace=function(t){t.message.length>n.messageMaxChars&&(t.message=t.message.substr(0,n.messageMaxChars-n.trimedMessage.length)+n.trimedMessage);this.logCache.push(t);(this.logCache.length>n.uploadTriggerSize||t.level===logLevel.Error)&&this.triggerUploadAsync()},n.messageMaxChars=3072,n.uploadCadenceInMsSec=3e4,n.uploadTriggerSize=30,n.trimedMessage="... [Trimmed]",n}();shiftFactory=1e3,function(n){n[n.WordViewer=301]="WordViewer";n[n.WopiPendingApplication=379]="WopiPendingApplication";n[n.VisioApp=700]="VisioApp";n[n.PptNavigation=810]="PptNavigation";n[n.PptSession=817]="PptSession";n[n.PptVersionHistory=832]="PptVersionHistory";n[n.PptLive=833]="PptLive"}(logCategory||(logCategory={})),function(n){n[n.Trace=0]="Trace";n[n.Assert=1]="Assert"}(logType||(logType={})),function(n){var t;(function(n){var r=function(){function n(){}return n.prototype.trace=function(n,t,i){this.traceTag(0,n,t,i)},n.prototype.traceTag=function(n,t,i,r){var u=null;switch(i){case logLevel.Verbose:u=console.debug;break;case logLevel.Info:u=console.log;break;case logLevel.Warning:case logLevel.Error:u=console.error;break;default:u=console.error}u(r)},n}(),t,i;n.ConsoleSessionLogger=r;t=function(){function n(n,t){try{this.logger=ULS.getLogger(n,t+"RemoteUls.ashx")}catch(i){}}return n.prototype.trace=function(n,t,i){this.logger!=null&&this.logger.ULS.trace(n,t,i)},n.prototype.traceTag=function(n,t,i,r){this.logger!=null&&this.logger.ULS.traceTag(n,t,i,r)},n.prototype.flush=function(){this.logger!=null&&this.logger.ULS.flush()},n.prototype.flushOnClose=function(){this.logger!=null&&this.logger.ULS.flushOnClose()},n}();n.UlsSessionLogger=t;i=function(){function n(){}return n.init=function(n){this.logger=n},n.trace=function(n,t,i){this.logger!=null&&this.logger.trace(n,t,i)},n.traceTag=function(n,t,i,r){this.logger!=null&&this.logger.traceTag(n,t,i,r)},n}();n.SessionLogger=i})(t=n.Telemetry||(n.Telemetry={}))}(PowerPointOnline||(PowerPointOnline={}));"use strict";function createPODSRegion(n,t,i,r,u){return t===void 0&&(t=1),i===void 0&&(i="https://c1-powerpoint-15.cdn.office.net/pods/s/"),r===void 0&&(r="5"),u===void 0&&(u=!1),{PodsURL:n,WacCdnStaticServer:i,RolloutPercentage:t,PreviewerRolloutRing:r,IsGoLocalRoutedToPublic:u}}function createUsePODSDetails(n,t,i,r){return{ShouldUsePODS:n,CanUsePODS:t,Reason:i,CreateNewScenario:r}}var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)},Configuration=function(){function n(){}return n.HostCallbackTimeout=6e4,n}(),BuildVersionConfig=function(){function n(){}return Object.defineProperty(n,"BUILD_NUMBER",{get:function(){return"16.0.13811.40508"},enumerable:!0,configurable:!0}),Object.defineProperty(n,"BUILD_NUMBER_MINOR",{get:function(){return 1381140508},enumerable:!0,configurable:!0}),Object.defineProperty(n,"BUILD_CDN_NUMBER",{get:function(){return"161381140508"},enumerable:!0,configurable:!0}),n}(),BrowserUtils=function(){function n(){}return n.devicePixelRatio=function(){return window.devicePixelRatio||(window.screen?window.screen.deviceXDPI/window.screen.logicalXDPI:1)||1},n.isSafari=function(){var n=window.navigator.userAgent.toLowerCase();return n.indexOf(" applewebkit/")>-1&&n.indexOf("version/")>-1&&n.indexOf("edge/")<0},n}(),CreateNewScenario,HTMLHelper,DocRebootSupportMode,MathHelper,PPTBootstrapSettings;(function(n){n[n.UnifiedCreateNew=1]="UnifiedCreateNew";n[n.LegacyCreateNew=2]="LegacyCreateNew";n[n.NotCreateNew=3]="NotCreateNew"})(CreateNewScenario||(CreateNewScenario={}));HTMLHelper=function(){function n(){}return n.toPx=function(n){return isNaN(n)?"":n.toString()+"px"},n.floatToPercent=function(n){return(n*100).toString()+"%"},n.isInDomTree=function(n){return!n||!n.parentNode?!1:n.id?!!document.getElementById(n.id):n.isConnected!==undefined?n.isConnected:document.body.contains(n)},n}(),function(n){n[n.NotSupported=0]="NotSupported";n[n.SameDocOnly=1]="SameDocOnly";n[n.AnyDoc=2]="AnyDoc"}(DocRebootSupportMode||(DocRebootSupportMode={}));MathHelper=function(){function n(){}return n.hash=function(n){for(var t=0,i=0;i<n.length;i+=1)t=(t<<5)-t+n.charCodeAt(i),t=t&t;return t},n}();var PodsRegionInfo=function(){function n(){}return n.getWacToPodsUnifiedMap=function(){var n={};return n[this.ffcUrl]=createPODSRegion(this.ffcUrl+this.pods,1,"https://c5-powerpoint-15.cdn.office.net/pods/s/"),n[this.ppcUrl]=createPODSRegion(this.ppcUrl+this.pods,1,"https://c4-powerpoint-15.cdn.office.net/pods/s/"),n[this.prodUrl]=createPODSRegion(this.prodUrl+this.pods),n[this.uscUrl]=createPODSRegion(this.uscUrl+this.pods),n[this.eucUrl]=createPODSRegion(this.eucUrl+this.pods),n[this.cacUrl]=createPODSRegion(this.cacUrl+this.pods),n[this.ukcUrl]=createPODSRegion(this.ukcUrl+this.pods),n[this.aucUrl]=createPODSRegion(this.aucUrl+this.pods),n[this.jpcUrl]=createPODSRegion(this.jpcUrl+this.pods),n[this.incUrl]=createPODSRegion(this.incUrl+this.pods),n[this.krcUrl]=createPODSRegion(this.krcUrl+this.pods),n[this.frcUrl]=createPODSRegion(this.frcUrl+this.pods),n[this.sgcUrl]=createPODSRegion(this.sgcUrl+this.pods),n[this.zacUrl]=createPODSRegion(this.zacUrl+this.pods),n[this.aecUrl]=createPODSRegion(this.aecUrl+this.pods),n[this.decUrl]=createPODSRegion(this.decUrl+this.pods),n[this.chcUrl]=createPODSRegion(this.chcUrl+this.pods),n[this.nocUrl]=createPODSRegion(this.nocUrl+this.pods),n[this.brcUrl]=createPODSRegion(this.brcUrl+this.pods),n[this.blackforestUrl]=createPODSRegion(this.blackforestUrl+this.pods,1,"https://powerpoint.cdn.office.de/pods/s/"),n[this.gallatinUrl]=createPODSRegion(this.gallatinUrl+this.pods,1,"https://cdn.partner.officewebapps.cn/pods/s/"),n[this.usGovUrl]=createPODSRegion(this.usGovUrl+this.pods,1,"https://powerpoint.cdn.office365.us/pods/s/"),n[this.gbcUrl]=createPODSRegion(this.gbcUrl+this.pods,1,"https://powerpoint.cdn.office365.us/pods/s/"),n[this.usDoDUrl]=createPODSRegion(this.usDoDUrl+this.pods,1,"https://powerpoint.dod.cdn.office365.us/pods/s/"),n},n.getWacToPodsPreviewerMap=function(){var t={};return t[this.ffcUrl]=this.ShouldRerouteEdogToProd?createPODSRegion(this.https+"usc"+n.hostOSIPodsService,1,"https://c4-powerpoint-15.cdn.office.net/pods/s/"):createPODSRegion(this.https+"pods.edog.officeapps.live.com/",1,"https://c5-powerpoint-15.cdn.office.net/pods/s/","1"),t[this.ppcUrl]=createPODSRegion(this.https+"usc"+n.hostOSIPodsService,1,"https://c4-powerpoint-15.cdn.office.net/pods/s/","2"),t[this.prodUrl]=createPODSRegion(this.https+n.hostOSIPodsService.substring(1)),t[this.uscUrl]=createPODSRegion(this.https+"usc"+n.hostOSIPodsService),t[this.eucUrl]=createPODSRegion(this.https+"euc"+n.hostOSIPodsService),t[this.cacUrl]=createPODSRegion(this.https+"canc"+n.hostOSIPodsService),t[this.ukcUrl]=createPODSRegion(this.https+"ukc"+n.hostOSIPodsService),t[this.aucUrl]=createPODSRegion(this.https+"ausc"+n.hostOSIPodsService),t[this.jpcUrl]=createPODSRegion(this.https+"jpc"+n.hostOSIPodsService),t[this.incUrl]=createPODSRegion(this.https+"inc"+n.hostOSIPodsService),t[this.krcUrl]=createPODSRegion(this.https+"krc"+n.hostOSIPodsService),t[this.frcUrl]=createPODSRegion(this.https+"frc"+n.hostOSIPodsService),t[this.sgcUrl]=createPODSRegion(this.https+"sea-000"+n.hostOSIPodsService),t[this.usGovUrl]=createPODSRegion(this.https+"pods.osi.office365.us/",1,"https://powerpoint.cdn.office365.us/pods/s/","6"),t[this.gbcUrl]=createPODSRegion(this.https+"pods.osi.office365.us/",1,"https://powerpoint.cdn.office365.us/pods/s/","6"),t[this.usDoDUrl]=createPODSRegion(this.https+"pods.osi.apps.mil/",1,"https://powerpoint.dod.cdn.office365.us/pods/s/","6"),t.edog=createPODSRegion(this.https+"pods.edog.officeapps.live.com/",1,"https://c5-powerpoint-15.cdn.office.net/pods/s/","1"),t[this.zacUrl]=createPODSRegion(this.https+n.hostOSIPodsService.substring(1)),t[this.zacUrl].IsGoLocalRoutedToPublic=!0,t[this.aecUrl]=createPODSRegion(this.https+n.hostOSIPodsService.substring(1)),t[this.aecUrl].IsGoLocalRoutedToPublic=!0,t[this.decUrl]=createPODSRegion(this.https+"euc"+n.hostOSIPodsService),t[this.decUrl].IsGoLocalRoutedToPublic=!0,t[this.chcUrl]=createPODSRegion(this.https+"euc"+n.hostOSIPodsService),t[this.chcUrl].IsGoLocalRoutedToPublic=!0,t[this.nocUrl]=createPODSRegion(this.https+"euc"+n.hostOSIPodsService),t[this.nocUrl].IsGoLocalRoutedToPublic=!0,t[this.brcUrl]=createPODSRegion(this.https+n.hostOSIPodsService.substring(1)),t[this.brcUrl].IsGoLocalRoutedToPublic=!0,t},n.getWacToSlideShowMap=function(){var t={};return t[this.ffcUrl]=this.ShouldRerouteEdogToProd?createPODSRegion(this.https+"usc"+n.hostOSISlideShowService,1,"https://c4-powerpoint-15.cdn.office.net/pods/s/"):createPODSRegion(this.https+"edog-slideshow.officeapps.live.com/",1,"https://c5-powerpoint-15.cdn.office.net/pods/s/","1"),t[this.ppcUrl]=createPODSRegion(this.https+"usc"+n.hostOSISlideShowService,1,"https://c4-powerpoint-15.cdn.office.net/pods/s/","2"),t[this.prodUrl]=createPODSRegion(this.https+n.hostOSISlideShowService.substring(1)),t[this.uscUrl]=createPODSRegion(this.https+"usc"+n.hostOSISlideShowService),t[this.eucUrl]=createPODSRegion(this.https+"euc"+n.hostOSISlideShowService),t[this.cacUrl]=createPODSRegion(this.https+"canc"+n.hostOSISlideShowService),t[this.ukcUrl]=createPODSRegion(this.https+"ukc"+n.hostOSISlideShowService),t[this.aucUrl]=createPODSRegion(this.https+"ausc"+n.hostOSISlideShowService),t[this.jpcUrl]=createPODSRegion(this.https+"jpc"+n.hostOSISlideShowService),t[this.incUrl]=createPODSRegion(this.https+"inc"+n.hostOSISlideShowService),t[this.krcUrl]=createPODSRegion(this.https+"krc"+n.hostOSISlideShowService),t[this.frcUrl]=createPODSRegion(this.https+"frc"+n.hostOSISlideShowService),t[this.sgcUrl]=createPODSRegion(this.https+"sea-000"+n.hostOSISlideShowService),t[this.usGovUrl]=createPODSRegion(this.https+"pods.osi.office365.us/",1,"https://powerpoint.cdn.office365.us/pods/s/","6"),t[this.gbcUrl]=createPODSRegion(this.https+"pods.osi.office365.us/",1,"https://powerpoint.cdn.office365.us/pods/s/","6"),t[this.usDoDUrl]=createPODSRegion(this.https+"pods.osi.apps.mil/",1,"https://powerpoint.dod.cdn.office365.us/pods/s/","6"),t.edog=createPODSRegion(this.https+"edog-slideshow.officeapps.live.com/",1,"https://c5-powerpoint-15.cdn.office.net/pods/s/","1"),t[this.zacUrl]=createPODSRegion(this.https+n.hostOSISlideShowService.substring(1)),t[this.zacUrl].IsGoLocalRoutedToPublic=!0,t[this.aecUrl]=createPODSRegion(this.https+n.hostOSISlideShowService.substring(1)),t[this.aecUrl].IsGoLocalRoutedToPublic=!0,t[this.decUrl]=createPODSRegion(this.https+"euc"+n.hostOSISlideShowService),t[this.decUrl].IsGoLocalRoutedToPublic=!0,t[this.chcUrl]=createPODSRegion(this.https+"euc"+n.hostOSISlideShowService),t[this.chcUrl].IsGoLocalRoutedToPublic=!0,t[this.nocUrl]=createPODSRegion(this.https+"euc"+n.hostOSISlideShowService),t[this.nocUrl].IsGoLocalRoutedToPublic=!0,t[this.brcUrl]=createPODSRegion(this.https+n.hostOSISlideShowService.substring(1)),t[this.brcUrl].IsGoLocalRoutedToPublic=!0,t},n.shouldRouteToEdog=function(n,t){return!t||!t.SessionInformation?!1:t.SessionInformation.UiHostRing&&this.TeamsRingsInEdog.indexOf(t.SessionInformation.UiHostRing.toLowerCase())>=0?!0:this.HostsWithFFInEdog.indexOf(t.SessionInformation.HostName)>=0&&n===this.ffcUrl?!0:!1},n.tryGetPodsRegion=function(n,t,i){var r=n.substring(0,n.indexOf("/p/")),u,f;if(i)return this.WacToPodsUnifiedMap[r.toLowerCase()];if(this.shouldRouteToSlideShowService(t)){if(u=this.WacToSlideShowMap[r.toLowerCase()],this.shouldRouteToEdog(r.toLowerCase(),t)&&(u=this.WacToSlideShowMap.edog),u)return u.IsGoLocalRoutedToPublic&&this.ShouldRouteGoLocalPreviewerToWac(t)?this.RouteToWacPodsRegion(r):u}else if(f=this.WacToPodsPreviewerMap[r.toLowerCase()],this.shouldRouteToEdog(r.toLowerCase(),t)&&(f=this.WacToPodsPreviewerMap.edog),f)return f.IsGoLocalRoutedToPublic&&this.ShouldRouteGoLocalPreviewerToWac(t)?this.RouteToWacPodsRegion(r):f;return this.RouteToWacPodsRegion(r)},n.RouteToWacPodsRegion=function(n){return this.IsRedirectedToWAC=!0,this.WacToPodsUnifiedMap[n.toLowerCase()]},n.ShouldRouteGoLocalPreviewerToWac=function(n){var t=PPTBootstrapperFeatureGatesHelper.getFeatureGates(n,null);return t&&t.RoutePreviewerToWac?!0:!1},n.shouldRouteToSlideShowService=function(n){if(window.location.search.indexOf("wdUseSlideShowService")>=0)return!0;if(n){var t=PPTBootstrapperFeatureGatesHelper.getFeatureGates(n,null);if(t&&t.UseSlideShowService)return!0}return!1},n.getPodsRing=function(n){var t=this.tryGetPodsRegion(n.ApplicationUrl,n,!1);return t&&t.PreviewerRolloutRing?t.PreviewerRolloutRing:"-4"},n.getWACRegion=function(n){return n?n.substring(0,n.indexOf("/p/")).toLowerCase():""},n.getFileHost=function(n){if(!n)return"";if(n.Diagnostics&&n.Diagnostics.fileHost)return n.Diagnostics.fileHost;if(n.SessionInformation&&n.SessionInformation.HostName){var t=n.SessionInformation.HostName;switch(t){case"MSTeams":case"TeamsAndroid":case"TeamsiOS":case"OneDrive":case"ParticipantApp":case"DragonGate":return"SharePoint Online";default:return t}}return""},n.getUiHost=function(n){if(!n)return"";switch(n){case"MSTeams":case"TeamsAndroid":case"TeamsiOS":return"teams";case"ParticipantApp":case"DragonGate":return n;default:return""}},n.ShouldRerouteEdogToProd=window.location.search.indexOf("wdTestPreviewerInEdog")>=0?!1:!0,n.HostsWithFFInEdog=["TeamsiOS"],n.TeamsRingsInEdog=["ring0","ring1"],n.IsRedirectedToWAC=!1,n.https="https://",n.pods="/pods/",n.hostWAC="-powerpoint.officeapps.live.com",n.hostOSIPodsService=".pods.officeapps.live.com/",n.hostOSISlideShowService="-slideshow.officeapps.live.com/",n.ffcUrl=n.https+"ffc"+n.hostWAC,n.ppcUrl=n.https+"ppc"+n.hostWAC,n.uscUrl=n.https+"usc"+n.hostWAC,n.eucUrl=n.https+"euc"+n.hostWAC,n.cacUrl=n.https+"cac"+n.hostWAC,n.ukcUrl=n.https+"ukc"+n.hostWAC,n.aucUrl=n.https+"auc"+n.hostWAC,n.jpcUrl=n.https+"jpc"+n.hostWAC,n.incUrl=n.https+"inc"+n.hostWAC,n.krcUrl=n.https+"krc"+n.hostWAC,n.frcUrl=n.https+"frc"+n.hostWAC,n.sgcUrl=n.https+"sgc"+n.hostWAC,n.zacUrl=n.https+"zac"+n.hostWAC,n.aecUrl=n.https+"aec"+n.hostWAC,n.gbcUrl=n.https+"gbc"+n.hostWAC,n.decUrl=n.https+"dec"+n.hostWAC,n.chcUrl=n.https+"chc"+n.hostWAC,n.nocUrl=n.https+"noc"+n.hostWAC,n.brcUrl=n.https+"brc"+n.hostWAC,n.blackforestUrl=n.https+"powerpoint.online.office.de",n.gallatinUrl=n.https+"cnc-powerpoint.partner.officewebapps.cn",n.usGovUrl=n.https+"powerpoint.gov.online.office365.us",n.usDoDUrl=n.https+"powerpoint.dod.online.office365.us",n.prodUrl=n.https+n.hostWAC.substring(1),n.WacToPodsUnifiedMap=n.getWacToPodsUnifiedMap(),n.WacToPodsPreviewerMap=n.getWacToPodsPreviewerMap(),n.WacToSlideShowMap=n.getWacToSlideShowMap(),n}(),PPTBootstrapper=function(){function n(){}return n.ensureInitializeParametersAreTheRightType=function(n){n.WopiPrecheckInfo.PreseededSessionKey&&(n.WopiPrecheckInfo.PreseededSessionKey.slice(0,6)!=="_._._."||n.WopiPrecheckInfo.PreseededSessionKey.slice(-6)!=="-.-.-.")&&(n.WopiPrecheckInfo.PreseededSessionKey="_._._."+n.WopiPrecheckInfo.PreseededSessionKey+"-.-.-.");n.ApplicationCustomSettings&&n.ApplicationCustomSettings.EnableWacFallback==null&&(n.ApplicationCustomSettings.EnableWacFallback=!0)},n.getOnDemandServer=function(n,t){var i;if(t===void 0&&(t=!1),n&&n.ApplicationCustomSettings&&n.ApplicationCustomSettings.OnDemandServer)return n.ApplicationCustomSettings.OnDemandServer;if(n&&n.ApplicationUrl&&(i=PodsRegionInfo.tryGetPodsRegion(n.ApplicationUrl,n,t),i))return i.PodsURL;var u=PPTBootstrapSettings.getAppMetadata(),f=u?u.Environment:"",r=PodsRegionInfo.shouldRouteToSlideShowService(n);switch(f){case"int":return r?"https://int-slideshow.officeapps.live.com/":"https://PODS.officeapps.live-int.com/";case"edog":return r?"https://edog-slideshow.officeapps.live.com/":"https://PODS.edog.officeapps.live.com/";case"prod":return r?"https://prod-slideshow.officeapps.live.com/":"https://PODS.officeapps.live.com/";case"wac":return n&&n.ApplicationUrl?n.ApplicationUrl.substring(0,n.ApplicationUrl.indexOf("PowerPointFrame.aspx")).replace("/p/","/pods/"):"";default:return"https://localhost:8080/"}},n.getWacStaticResourcesServer=function(n,t,i,r){var u,f;if(n&&n.WacStaticResourcesServer)return n.WacStaticResourcesServer;if(i)return u="pods/s/",i.split(u)[0]+u;if(t){if(f=PodsRegionInfo.tryGetPodsRegion(t,r,!1),f)return f.WacCdnStaticServer;throw Error("Application url provided but region not in region allowlist");}return"https://c1-powerpoint-15.cdn.office.net/pods/s/"},n.generateRandomHexChar=function(){var n=new Uint8Array(1);return window.self.crypto&&window.self.crypto.getRandomValues?(window.self.crypto.getRandomValues(n),Math.floor(n[0]/16).toString(16)):window.msCrypto&&window.msCrypto.getRandomValues?(window.msCrypto.getRandomValues(n),Math.floor(n[0]/16).toString(16)):Math.floor(Math.random()*16).toString(16)},n.generateRandomUUID=function(){return"xxxxxxxx-xxxx-4xxx-xxxx-xxxxxxxxxxxx".replace(/[x]/g,this.generateRandomHexChar)},n.getSlideShowKind=function(t,i){var u="Modern",o="Legacy",s,h,f,c;try{if(s=window.location.search.indexOf("wdForceModernSlideShowInTeams")>=0||t.SessionInformation&&t.SessionInformation.WdParams&&t.SessionInformation.WdParams.wdForceModernSlideShowInTeams,s)return u;if(PodsRegionInfo.IsRedirectedToWAC&&this.shouldUseLegacySlideShowAspx(t))return o;var r=PPTBootstrapperFeatureGatesHelper.getFeatureGates(t,{}),e=t.SessionInformation.WdParams&&t.SessionInformation.WdParams.wdBrowserShapeBuilderCompatible&&t.SessionInformation.WdParams.wdIsFileTypeSupportedForModernSlideShow,l=t.SessionInformation&&t.SessionInformation.IsPresenter&&r.EnableModernSlideShowForPresenter,a=t.SessionInformation&&t.SessionInformation.UiHostIsHighContrast&&r.EnableModernSlideShowForHighContrast;if(e&&l)return i.ULS.traceTag(573862238,logCategory.PptSession,logLevel.Info,"Always use Modern for Presenter"),u;if(e&&a)return i.ULS.traceTag(573698710,logCategory.PptSession,logLevel.Info,"Always use Modern for HighContrast"),u;if(h=t.SessionInformation.WdParams&&t.SessionInformation.WdParams.wdModernSlideShowInTeams,e&&h&&(f=!0,r.ModernMeetingBasedRolloutEnabled&&r.ModernMeetingBasedRolloutPercentage&&t.SessionInformation&&t.SessionInformation.CallId&&t.SessionInformation.UserId&&(f=n.isEnabledForMeeting(r.ModernMeetingBasedRolloutPercentage,t.SessionInformation.CallId,t.SessionInformation.UserId),i.ULS.traceTag(573862239,logCategory.PptSession,logLevel.Info,"RolloutPercentage - "+r.ModernMeetingBasedRolloutPercentage+"; isModern - "+f+"; CallId - "+t.SessionInformation.CallId+";")),c=n.OverrideModernRegionRollout(t,i),f&&!c))return u}catch(v){i.ULS.traceTag(573862240,logCategory.PptSession,logLevel.Warning,"Exception in getSlideShowKind. "+v)}return this.shouldUseLegacySlideShowAspx(t)?o:"StaticHtml"},n.OverrideModernRegionRollout=function(t,i){var u,f,e,r;try{if(u=PPTBootstrapperFeatureGatesHelper.getFeatureGates(t,{}),u.ModernRegionBasedRolloutOverride){f=u.ModernRegionBasedRolloutOverride.split(";");for(e in f)if(r=f[e].split(":"),r&&r.length>1&&t.ApplicationUrl){var o=t.ApplicationUrl.toLowerCase().indexOf(r[0])>0,s=parseInt(r[1]),h=n.getFlightingNumber(t)*100;if(i.ULS.traceTag(573964447,logCategory.PptSession,logLevel.Info,"RolloutPercentage - "+s+"; RolloutNumber - "+h+"; OnDemandServer - "+t.ApplicationUrl+"; RegionRolloutDetails - "+r[0]+"; isOverriden - "+o+"; LegacyAspx - "+this.shouldUseLegacySlideShowAspx(t)),o&&h<s&&this.shouldUseLegacySlideShowAspx(t))return!0}}else i.ULS.traceTag(573695110,logCategory.PptSession,logLevel.Info,"pptFeatureGates.ModernRegionBasedRolloutOverride undefined or null")}catch(c){i.ULS.traceTag(573964448,logCategory.PptSession,logLevel.Warning,"Exception in OverrideModernRegionRollout. "+c)}return!1},n.getFileExtension=function(n,t){var i,r;return n&&(i=n.split("."),i&&i.length>1)?(r=i[i.length-1].toLowerCase(),t.ULS.traceTag(578930325,logCategory.PptSession,logLevel.Info,"getFileExtension fileExtension: "+r),r):""},n.shouldUseLegacySlideShowAspx=function(n){return n.ApplicationUrl===null?!1:window.location.search.indexOf("wdLegacySlideShowAspx")>=0?!0:window.location.search.indexOf("wdUseStaticHtmlLegacySlideShow")>=0?!1:!0},n.sendInitialLog=function(n,t,i,r){var f,l,u,s,v,e,h,a,o,c;this.s_bootstrapperInstanceIdentifier===""&&(this.s_bootstrapperInstanceIdentifier=this.generateRandomUUID());f={};f.BootstrapperType="TypeScript";f.Preview=t==="Previewer"?!0:!1;f.Scenario=t;f.ApplicationUrl=this.extractHostname(n.ApplicationUrl);f.IsDeepLink=!!UrlUtils.getQueryStringParam("nav");f.BootstrapperInstanceId=this.s_bootstrapperInstanceIdentifier;f.UseSlideShowService=PodsRegionInfo.shouldRouteToSlideShowService(n);l={};f.ApplicationCustomSettings=l;n.ApplicationCustomSettings&&(l.OnDemandServer=this.extractHostname(n.ApplicationCustomSettings.OnDemandServer),l.EnableWacFallback=n.ApplicationCustomSettings.EnableWacFallback);u={};f.SessionInformation=u;u.HostName=n.SessionInformation.HostName;u.HostSessionId=n.SessionInformation.HostSessionId;u.UiLocale=n.SessionInformation.UiLocale;u.DataLocale=n.SessionInformation.DataLocale;n.Diagnostics&&n.Diagnostics.userClickTime?u.DocumentClickTime=n.Diagnostics.userClickTime:n.SessionInformation&&n.SessionInformation.DocumentClickTime&&(u.DocumentClickTime=n.SessionInformation.DocumentClickTime.getTime());u.HostInitTime=n.SessionInformation.HostInitTime;u.CurrentTime=(new Date).getTime();u.ParticipantId=n.SessionInformation.ParticipantId;u.CallId=n.SessionInformation.CallId;u.TenantId=n.SessionInformation.TenantId;u.ContentId=n.SessionInformation.ContentId;u.EndpointId=n.SessionInformation.EndpointId;u.IsPresenter=n.SessionInformation.IsPresenter;u.UiHost=PodsRegionInfo.getUiHost(n.SessionInformation.HostName);u.UiHostRing=n.SessionInformation.UiHostRing;u.UiHostIsHighContrast=n.SessionInformation.UiHostIsHighContrast;u.UiHostHighContrastColorSettings=n.SessionInformation.UiHostHighContrastColorSettings;u.PreviewerPosition=n.SessionInformation.Position;u.WdParams=n.SessionInformation.WdParams;u.HostExperience=n.SessionInformation.HostExperience;u.SlideShowKind=this.getSlideShowKind(n,r);u.ForceModernSlideShowInTeamsQueryParam=window.location.search.indexOf("wdForceModernSlideShowInTeams")>=0;u.UseAspx=this.shouldUseLegacySlideShowAspx(n);u.IsRetry=n.SessionInformation&&n.SessionInformation.IsRetry?n.SessionInformation.IsRetry:!1;u.PreviousHostSessionId=n.SessionInformation&&n.SessionInformation.PreviousHostSessionId?n.SessionInformation.PreviousHostSessionId:"";s={};f.Diagnostics=s;v=this.getEntryPoint(n);s.EntryPoint=v;s.FileHost=PodsRegionInfo.getFileHost(n);s.PodsRing=n.ApplicationUrl?PodsRegionInfo.getPodsRing(n):"";e={};f.WopiPrecheckInfo=e;e.FileSize=n.WopiPrecheckInfo.FileSize;e.FileGetUrlBool=!!n.WopiPrecheckInfo.FileGetUrl;e.FileNameBool=!!n.WopiPrecheckInfo.FileName;e.ReadOnly=n.WopiPrecheckInfo.ReadOnly;e.IrmEnabled=n.WopiPrecheckInfo.IrmEnabled;e.SupportsDecryptedContentDownload=n.WopiPrecheckInfo.SupportsDecryptedContentDownload;e.ViewOnly=n.WopiPrecheckInfo.ViewOnly;e.PreseededSessionKey=!!n.WopiPrecheckInfo.PreseededSessionKey;!n.WopiPrecheckInfo.FileName||(e.FileExtension=this.getFileExtension(n.WopiPrecheckInfo.FileName,r));h={};n.WopiPrecheckInfo.BundleInfo&&(a=n.WopiPrecheckInfo.BundleInfo,h.MajorVersion=a.MajorVersion,h.URLBool=!!a.Url,h.CrossOrigin=a.CrossOrigin);e.BundleInfo=h;o={};f.AppInfo=o;c=PPTBootstrapSettings.getAppMetadata();c&&(o.AppVersionMajor=c.AppVersionMajor,o.AppVersionMinor=c.AppVersionMinor,o.Environment=c.Environment);o.UserAgent=window.navigator.userAgent;i&&(f.AdditionalTelemetry=i);r.ULS.traceTag(22357763,logCategory.PptSession,logLevel.Info,JSON.stringify(f,this.undefinedReplacer))},n.undefinedReplacer=function(n,t){return typeof t=="undefined"?null:t},n.inferFileNewFromWopiPrecheckInfo=function(n,t,i,r){var f,u,o=n,e;return o.CreateNewInfo?(u=CreateNewScenario.UnifiedCreateNew,f="CreateNewInfo"):n.IsNewFile?(u=CreateNewScenario.UnifiedCreateNew,f="CreateNewInfoIsNewFile"):n.IsNewFileFromHostTemplate?(u=CreateNewScenario.UnifiedCreateNew,f="CreateNewInfoFromHostTemplate"):i&&i.FileGetUrl?(u=CreateNewScenario.UnifiedCreateNew,f="CreateNewInfoFromTemplateSourceUrl"):t.toLowerCase().indexOf("new=1")>=0&&n.FileSize!==0?(u=CreateNewScenario.LegacyCreateNew,f="ApplicationUrlContainsNewAndNonZeroByteFile"):t.toLowerCase().indexOf("new=1")>=0?(u=CreateNewScenario.UnifiedCreateNew,f="ApplicationUrlContainsNew"):(u=CreateNewScenario.NotCreateNew,f="NotCreateNew"),e={},e.CreateNewScenario=CreateNewScenario[u],e.reason=f,r.ULS.traceTag(34932951,logCategory.PptSession,logLevel.Info,JSON.stringify(e)),u},n.podsFlighting=function(n,t,i){var r=this.inferFileNewFromWopiPrecheckInfo(n.WopiPrecheckInfo,n.ApplicationUrl,n.NewFileTemplateSource,i),u=PodsRegionInfo.tryGetPodsRegion(n.ApplicationUrl,n,t),f;return u?t&&r===CreateNewScenario.LegacyCreateNew?createUsePODSDetails(!1,!1,"Legacy Create New Scenario because application url contains new, but non-zero file size",r):window.location.search.indexOf("wdTestPreviewer=1")>=0||window.location.hash.indexOf("wdTestPreviewer=1")>=0?createUsePODSDetails(!0,!0,"Supported Region and wdTestPreviewer/wdTestUnified set to true in Host Page URL",r):t&&n.ApplicationUrl.indexOf("&Embed=1")!==-1?createUsePODSDetails(!1,!1,"Embed View fallback to WAC",r):u.RolloutPercentage<=0?createUsePODSDetails(!1,!1,"PODS region Disabled",r):(f=this.getFlightingNumber(n),i.ULS.traceTag(38147723,logCategory.PptSession,logLevel.Info,"RolloutPercentage - "+u.RolloutPercentage+"; RolloutNumber - "+f),u.RolloutPercentage<f)?createUsePODSDetails(!1,!0,"Could use PODS but this session was not selected as part of the rollout",r):createUsePODSDetails(!0,!0,"Supported Region",r):(i.ULS.traceTag(589168768,logCategory.PptSession,logLevel.Info,"Wac region not currently supported by PODS"),createUsePODSDetails(!1,!1,"Wac region not currently supported by PODS",r))},n.getFlightingNumber=function(n){return n.SessionInformation.UserId?Math.abs(MathHelper.hash(n.SessionInformation.UserId))/100%1:Math.random()},n.isEnabledForMeeting=function(n,t,i){var r=1;return r=t?Math.abs(MathHelper.hash(t))/100%1:i?Math.abs(MathHelper.hash(i))/100%1:Math.random(),r*100<n},n.launchWacFallback=function(n,t,i,r,u,f,e){var c,s,h,l,a,p,y,v;u.ULS.traceTag(38147724,logCategory.PptSession,logLevel.Info,"Launching Wac Fallback");var o=document.createElement("iframe");o.frameBorder="0";o.style.top=HTMLHelper.toPx(0);o.style.bottom=HTMLHelper.toPx(0);o.style.left=HTMLHelper.toPx(0);o.style.right=HTMLHelper.toPx(0);o.style.height=HTMLHelper.floatToPercent(1);o.style.width=HTMLHelper.floatToPercent(1);o.style.minWidth=HTMLHelper.toPx(300);o.style.minHeight=HTMLHelper.toPx(200);o.style.position="absolute";o.setAttribute("allowfullscreen",(!0).toString());o.setAttribute("allowTransparency",(!0).toString());o.id="WebApplicationFrame";o.title="Office Online Frame";o.name="wac_frame";c=HTMLHelper.floatToPercent(1);t.Container.style.width=c;t.Container.style.height=c;t.Container.style.minHeight=HTMLHelper.toPx(150);t.Container.style.left=HTMLHelper.toPx(0);t.Container.style.right=HTMLHelper.toPx(0);t.Container.style.bottom=HTMLHelper.toPx(0);t.Container.style.top=HTMLHelper.toPx(0);s=document.createElement("div");s.style.backgroundColor="#393a3d";s.style.backfaceVisibility="hidden";s.style.width=c;s.style.height=c;s.style.minHeight=HTMLHelper.toPx(150);s.style.left=HTMLHelper.toPx(0);s.style.right=HTMLHelper.toPx(0);s.style.bottom=HTMLHelper.toPx(0);s.style.top=HTMLHelper.toPx(0);o.style.width=c;o.style.minHeight=HTMLHelper.toPx(150);o.style.height=c;h=document.createElement("form");h.name="wac_form";h.id="wac_form";h.target="wac_frame";h.action=i(n,t);h.method="post";l=document.createElement("input");l.type="hidden";l.name="access_token";l.value=n.AccessToken;h.appendChild(l);a=document.createElement("input");a.type="hidden";a.name="access_token_ttl";a.value=!n.AccessTokenExpiry?"0":n.AccessTokenExpiry.getTime().toString();h.appendChild(a);t.Container.appendChild(h);t.Container.appendChild(s);s.appendChild(o);h.submit();p=r&&r.Code===5308440?"CannotLoadBundleItem":"FatalError";y={errorObject:{errorType:p,errorObject:r}};f.stop();v=f.getVisibilityChangeEvents();v&&v.length>0&&(y.documentLoadedWithTabSwitch=!0,u.ULS.traceTag(38147725,logCategory.PptSession,logLevel.Info,"Visibility Change Events:"+JSON.stringify(v)));t.FnOnInitializeSuccess(new PPTDisabledApplication(e),y)},n.extractHostname=function(n){return n?n.indexOf("://")>-1?n.split("/")[2]:n.split("/")[0]:null},n.getEntryPoint=function(n){if(!n.ApplicationUrl)return null;var t=UrlUtils.getParameterValueDecoded(n.ApplicationUrl,"wdOrigin");return t?t:n.Diagnostics&&n.Diagnostics.entryPoint?n.Diagnostics.entryPoint:null},n.findBootstrapperPerfEntry=function(n,t,i){var r,u;if(n)for(r=0;r<n.length;r+=1)if(u=n[r],u.name.indexOf(t)>=0)return u.name.toLowerCase()!==t.toLowerCase()&&i.ULS.traceTag(38147726,logCategory.PptSession,logLevel.Info,"Found partial match for bootstrapper URL perf entry"),u;return null},n.logBootstrapperPerformanceInfo=function(n,t,i){var e,f,r,u;if(i)try{if(e="https://contentstorage.osi.office.net/boot/ppt.boot.js",f=n||e,n||i.ULS.traceTag(38147727,logCategory.PptSession,logLevel.Info,"Missing BootstrapperUrl, defaulting to "+e),!window.performance){i.ULS.traceTag(38147728,logCategory.PptSession,logLevel.Info,"Performance API not found on browser");return}if(r=undefined,window.performance.getEntriesByName&&(r=this.findBootstrapperPerfEntry(window.performance.getEntriesByName(f),f,i)),!r&&window.performance.getEntries&&(i.ULS.traceTag(38147729,logCategory.PptSession,logLevel.Info,"Searching all entries for bootstrapper timing entry."),r=this.findBootstrapperPerfEntry(window.performance.getEntries(),f,i)),!r){i.ULS.traceTag(38147730,logCategory.PptSession,logLevel.Info,"Unable to extract Bootstrapper perf info.");return}u={};u.name=f;u.logReason=t;u.nameMatchesExpected=r.name===f;u.connectEnd=r.connectEnd;u.connectStart=r.connectStart;u.domainLookupEnd=r.domainLookupEnd;u.domainLookupStart=r.domainLookupStart;u.fetchStart=r.fetchStart;u.initiatorType=r.initiatorType;u.redirectEnd=r.redirectEnd;u.redirectStart=r.redirectStart;u.requestStart=r.requestStart;u.responseEnd=r.responseEnd;u.responseStart=r.responseStart;u.duration=r.duration;u.entryType=r.entryType;u.startTime=r.startTime;u.nextHopProtocol=r.nextHopProtocol;u.workerStart=r.workerStart;u.secureConnectionStart=r.secureConnectionStart;u.transferSize=r.transferSize;u.encodedBodySize=r.encodedBodySize;u.decodedBodySize=r.decodedBodySize;i.ULS.traceTag(34928845,logCategory.PptSession,logLevel.Info,JSON.stringify(u))}catch(o){i.ULS.traceTag(38147731,logCategory.PptSession,logLevel.Warning,"Exception extracting Bootstrapper perf info. "+o)}},n.getPostMessageToken=function(n){return!n||n.toLowerCase().indexOf("#")>-1?Math.random().toString(36).substring(2,25):n},n.appendCommonFrameUrlQueryParams=function(n,t){var i=n,o=this.getUI(t),r,u,f,e,s;return o&&(i=UrlUtils.addOrReplaceParameterValue(i,"ui",o)),r=this.getDataLocale(t),r&&(i=UrlUtils.addOrReplaceParameterValue(i,"rs",r)),u=UrlUtils.getParameterValue(t.ApplicationUrl,"mscc"),u&&(i=UrlUtils.addOrReplaceParameterValue(i,"mscc",u)),f=UrlUtils.getParameterValue(t.ApplicationUrl,"wdFR"),f&&(i=UrlUtils.addOrReplaceParameterValue(i,"wdFR",f)),e=this.getEntryPoint(t),e&&(i=UrlUtils.addOrReplaceParameterValue(i,"wdOrigin",UrlUtils.urlKeyValueEncode(e))),s=this.getPostMessageToken(t.PostMessageToken),t.PostMessageToken&&(i+="&postMessageToken="+s),(t.SessionInformation.DisableChat||t.ApplicationUrl.toLowerCase().indexOf("dchat=1")>-1)&&(i=UrlUtils.addOrReplaceParameterValue(i,"dchat","1")),UrlOverrideUtils.forwardMissingWdParamsFromApplicationUrl(i,t.ApplicationUrl)},n.getUI=function(n){return n.SessionInformation.UiLocale?n.SessionInformation.UiLocale:UrlUtils.getParameterValueDecoded(n.ApplicationUrl,"ui")},n.getDataLocale=function(n){return n.SessionInformation.DataLocale?n.SessionInformation.DataLocale:UrlUtils.getParameterValueDecoded(n.ApplicationUrl,"rs")},n.s_bootstrapperInstanceIdentifier="",n}(),PPTBootstrapperFeatureGatesHelper=function(){function n(){}return n.getFeatureGates=function(n,t){var i;try{return i="{}",n&&n.SessionInformation&&n.SessionInformation.PptFeatureGates&&(i=decodeURIComponent(n.SessionInformation.PptFeatureGates).replace(/\u200B/g,"")),JSON.parse(i)}catch(r){return t&&t.ULS.traceTag(578933140,logCategory.PptSession,logLevel.Warning,"Exception parsing ppt feature gates: "+JSON.stringify(r)),{}}},n}(),PPTBootstrapperLogger=function(){function n(){}return n.recordBootstrapperTimeoutFailure=function(n,t,i,r,u,f,e){if(!this.isBootSuccess(t,i,r)){var o={AppMetadata:this.getAppMetadata(n,PPTBootstrapSettings.getAppMetadata(),u),BootInfo:this.getBootInfo(n,f,!1),BundleMetadata:"[]",FatalErrors:this.getFatalErrorInfo(t,i,r),NonFatalErrors:e,WopiPrecheckInfo:this.getWopiPrecheckInfo(n)};u.ULS.traceTag(592007955,logCategory.PptSession,logLevel.Error,JSON.stringify(o))}},n.recordBootCompleted=function(n,t,i,r,u,f,e,o){var s={AppMetadata:this.getAppMetadata(n,PPTBootstrapSettings.getAppMetadata(),u),BootInfo:this.getBootInfo(n,f,this.isBootSuccess(t,i,r)),BundleMetadata:"[]",FatalErrors:this.getFatalErrorInfo(t,i,r),NonFatalErrors:e,WopiPrecheckInfo:this.getWopiPrecheckInfo(n),AppBootTimings:o?o.appBootTimingDict:""};u.ULS.traceTag(587843200,logCategory.PptSession,logLevel.Info,JSON.stringify(s))},n.getWopiPrecheckInfo=function(n){return n&&n.WopiPrecheckInfo?{FileGetUrlBool:n.WopiPrecheckInfo.FileGetUrl?!0:!1,FileNameBool:n.WopiPrecheckInfo.FileName?!0:!1,ReadOnly:n.WopiPrecheckInfo.ReadOnly,SupportsDecryptedContentDownload:n.WopiPrecheckInfo.SupportsDecryptedContentDownload,ViewOnly:n.WopiPrecheckInfo.ViewOnly,PreseededSessionKey:n.WopiPrecheckInfo.PreseededSessionKey,BundleInfo:this.getBundleInfo(n.WopiPrecheckInfo.BundleInfo)}:""},n.getBundleInfo=function(n){if(n){var t=n;return{MajorVersion:t.MajorVersion,URLBool:t.Url,CrossOrigin:t.CrossOrigin}}return""},n.getAppMetadata=function(n,t,i){return n?{BrowserTechnology:"",Browser:"",FileSizeHint:n.WopiPrecheckInfo.FileSize,ApiStartTime:0,HostInitTime:n.SessionInformation.HostInitTime,AppVersion:t.AppVersionMajor+"."+t.AppVersionMinor,ViewerMode:n.ApplicationCustomSettings&&n.ApplicationCustomSettings.ViewerMode?n.ApplicationCustomSettings.ViewerMode:0,UseBabylon:"",EntryPoint:PPTBootstrapper.getEntryPoint(n),SessionId:n.SessionInformation.HostSessionId,UserAgent:window.navigator.userAgent,ApplicationUrl:n.ApplicationUrl,WACRegion:PodsRegionInfo.getWACRegion(n.ApplicationUrl),FileHost:PodsRegionInfo.getFileHost(n),Host:n.SessionInformation.HostName,PodsRing:n.ApplicationUrl?PodsRegionInfo.getPodsRing(n):"",UiHost:PodsRegionInfo.getUiHost(n.SessionInformation.HostName),UiHostRing:n.SessionInformation.UiHostRing,UiHostIsHighContrast:n.SessionInformation.UiHostIsHighContrast,UiHostHighContrastColorSettings:n.SessionInformation.UiHostHighContrastColorSettings,CallId:n.SessionInformation.CallId,ContentId:n.SessionInformation.ContentId,SlideShowKind:PPTBootstrapper.getSlideShowKind(n,i),UseAspx:PPTBootstrapper.shouldUseLegacySlideShowAspx(n),HostExperience:n.SessionInformation.HostExperience,ParticipantId:n.SessionInformation.ParticipantId,EndpointId:n.SessionInformation.EndpointId,HostSessionId:n.HostSessionId,isRetry:n.SessionInformation.IsRetry,PreviousHostSessionId:n.SessionInformation.PreviousHostSessionId?n.SessionInformation.PreviousHostSessionId:"",IsPresenter:n.SessionInformation.IsPresenter}:""},n.getFatalErrorInfo=function(n,t,i){return this.isBootSuccess(n,t,i)?"":{ErrorCategory:"fatal",ExtraInfo:"",CorrelationId:"",ErrorCode:n,ErrorName:t,Message:i}},n.getBootInfo=function(n,t,i){var r=0;return n.SessionInformation.DocumentClickTime!=null&&n.SessionInformation.DocumentClickTime.getTime&&(r=n.SessionInformation.DocumentClickTime.getTime()),{PreloadCompleteTime:0,DocumentClickTime:r,BootSuccess:i,BootTime:t,BootMode:""}},n.isBootSuccess=function(n,t,i){return n==null&&t==null&&i==null},n}(),PPTDisabledApplication=function(){function n(n){this.m_sessionId=n}return n.prototype.GetApplicationType=function(){return"PowerPoint"},n.prototype.GetVersion=function(){return BuildVersionConfig.BUILD_NUMBER},n.prototype.GetSessionId=function(){return this.m_sessionId},n.prototype.RegisterEventHandler=function(){},n.prototype.RemoveEventHandler=function(){},n.prototype.RegisterErrorHandler=function(){},n.prototype.RemoveErrorHandler=function(){},n.prototype.AddEventHandler=function(){},n.prototype.dispose=function(){},n.prototype.Dispose=function(){},n.prototype.GetIsDisabled=function(){return!0},n.prototype.GetPercievedBoot=function(){return null},n.prototype.UsingCached=function(){return!1},n.prototype.GetCurrentSlideDimensions=function(){},n.prototype.GetSlidesInShowCount=function(){},n.prototype.GetTimeLineInfos=function(){},n.prototype.GetCurrentPosition=function(){},n.prototype.GetId=function(){},n.prototype.Next=function(){},n.prototype.PausePresentation=function(){},n.prototype.PlayPresentation=function(){},n.prototype.GetPresentationPlaybackState=function(){},n.prototype.NextSlide=function(){},n.prototype.Prev=function(){},n.prototype.PrevSlide=function(){},n.prototype.GoToNextSlide=function(){},n.prototype.GoToPrevSlide=function(){},n.prototype.GoToSlide=function(){},n.prototype.GoToSlideId=function(){},n.prototype.DisplayBlackSlide=function(){},n.prototype.DisplayWhiteSlide=function(){},n.prototype.Popout=function(){},n.prototype.PlayMedia=function(){},n.prototype.PauseMedia=function(){},n.prototype.RestoreFocus=function(){},n.prototype.StopMedia=function(){},n.prototype.SeekMedia=function(){},n.prototype.GetCurrentMediaStates=function(){},n.prototype.SetNavigationOptions=function(){},n}(),PPTMessageListenerRegistry=function(){function n(){this.m_apiRegistry={};window.addEventListener("message",this.onMessage)}return n.getInstance=function(){return this.s_singleton||(this.s_singleton=new n),this.s_singleton},n.prototype.add=function(n,t,i,r){r===void 0&&(r="");this.m_apiRegistry[n]=t;i&&this.sendLogToAllListeners("Add to Message Registry: "+n+", Reason: "+r,this.getLoggableDataFromMessageListenerRegistry())},n.prototype.get=function(n){return this.m_apiRegistry[n]},n.prototype.remove=function(n,t,i){i===void 0&&(i="");this.m_apiRegistry[n]=null;t&&this.sendLogToAllListeners("Remove from Message Registry: "+n+", Reason: "+i,this.getLoggableDataFromMessageListenerRegistry())},n.prototype.setSliceLoaded=function(){var t,n;for(t in this.m_apiRegistry)n=this.m_apiRegistry[t],n&&n.onSliceLoaded()},n.prototype.sendLogToAllListeners=function(n,t){var r,i;for(r in this.m_apiRegistry)i=this.m_apiRegistry[r],i&&i.log(n,t)},n.prototype.getLoggableDataFromMessageListenerRegistry=function(){var i={},n,t;for(n in this.m_apiRegistry)t=this.m_apiRegistry[n],i[n]=t?t.hasOwnProperty("c_activated")?"PreviewSessionLoader":"PreviewSessionManagerV0":"API is Null";return JSON.stringify(i)},n.prototype.onMessage=function(t){var i,r,u,f;try{i=JSON.parse(t.data)}catch(e){i=null}if(i&&(r=i.m_id||i.Token,r)){if(u=n.getInstance(),f=u.get(r),!f){u.sendLogToAllListeners("Message received with no targetApi. Id: "+r.toString(),t.data);return}f.onMessage(i,t.source)}},n}(),TimeoutWrapper=function(){function n(n,t,i,r){var u=this,f,e;this.m_initialTicks=0;this.m_onSuccessTicks=0;this.m_onFailureTicks=0;this.m_onTimeoutTicks=0;this.m_fCallbackCalled=!1;this.m_scenario="";this.m_hostSessionId="";this.m_host="";this.errorCode=5;this.errorName="TimeoutInitialize";this.m_aborted=!1;this.m_callbackTimeoutError={errorType:"AppInitError",errorObject:"Timed out waiting for FnOnInitializeSuccess",Category:0,Code:this.errorCode,ErrorName:this.errorName,EventType:13,ExtraInfo:"Initialization timeout"};this.m_scenario=i;this.m_appErrors=r;n&&(n.FnOnInitializeSuccess&&(f=n.FnOnInitializeSuccess,n.FnOnInitializeSuccess=function(i,r){u.m_onSuccessTicks=Date.now();u.m_fCallbackCalled||(u.m_fCallbackCalled=!0,u.m_onTimeoutTicks?u.logCallbackArrivedAfterTimeout("success",r,t):(t&&(t.ULS.traceTag(38836226,logCategory.PptSession,logLevel.Info,"TimeoutWrapper: Calling fnOnInitializeSuccess"),PPTBootstrapperLogger.recordBootCompleted(n,null,null,null,t,Date.now(),u.m_appErrors,r)),f(i,r)))}),n.FnOnInitializeFailure&&(e=n.FnOnInitializeFailure,n.FnOnInitializeFailure=function(i,r){if(u.m_onFailureTicks=Date.now(),!u.m_fCallbackCalled)if(u.m_fCallbackCalled=!0,u.m_onTimeoutTicks&&i!==u.m_callbackTimeoutError)u.logCallbackArrivedAfterTimeout("failure",r,t,i);else{if(t){var f=i;PPTBootstrapperLogger.recordBootCompleted(n,f.Code,f.ErrorName,f.errorObject,t,Date.now(),u.m_appErrors,r?r:u.m_appInitDiagnostics);t.ULS.traceTag(38836227,logCategory.PptSession,logLevel.Info,"TimeoutWrapper: Calling fnOnInitializeFailure")}e(i,r)}}),n.SessionInformation&&(this.m_hostSessionId=n.SessionInformation.HostSessionId,this.m_host=n.SessionInformation.HostName));this.tryStartTimeout(n,t)}return n.addTimeoutWrappersToHostCallbacks=function(t,i,r,u){return new n(t,i,r,u)},n.prototype.failByHost=function(n,t,i,r){if(!this.m_onFailureTicks&&!this.m_onSuccessTicks&&!this.m_onTimeoutTicks&&!this.m_aborted){this.m_aborted=!0;this.m_timeoutHandle&&(window.clearTimeout(this.m_timeoutHandle),this.m_timeoutHandle=undefined);var u=i,f=u==null?"":u.message;PPTBootstrapperLogger.recordBootCompleted(n,6,"AbortByHost",f,t,Date.now(),r)}},n.prototype.setAppInitDiagnostics=function(n){this.m_appInitDiagnostics=n},n.prototype.tryStartTimeout=function(n,t){var u=this,r,i;this.m_initialTicks=Date.now();r=Configuration.HostCallbackTimeout;i=UrlUtils.getQueryStringParam("wdOnSuccessTimeout");!i||parseInt(i,10).toString()!==i||(r=parseInt(i,10));r&&(this.m_timeoutHandle=window.setTimeout(function(){return u.timeoutIfSuccessNotCalled(n,t)},r))},n.prototype.logCallbackArrivedAfterTimeout=function(n,t,i,r){var u={};u.Message="Received "+n+" callback after timeout had elapsed";u.timeoutTimeMs=this.m_onTimeoutTicks;u.successTimeMs=this.m_onSuccessTicks;u.startTimeMs=this.m_initialTicks;u.appInitDiagnostics=t;r&&(u.error=r);i&&i.ULS.traceTag(38589660,logCategory.PptSession,logLevel.Info,JSON.stringify(u))},n.prototype.timeoutIfSuccessNotCalled=function(n,t){var r,u,i;if(!this.m_onFailureTicks&&!this.m_onSuccessTicks&&!this.m_onTimeoutTicks&&!this.m_aborted){this.m_onTimeoutTicks=Date.now();try{r=n.Container;u=!HTMLHelper.isInDomTree(r);u?t&&(t.ULS.traceTag(579604899,logCategory.PptSession,logLevel.Warning,"App container is unloaded. Scenario: "+this.m_scenario),PPTBootstrapperLogger.recordBootCompleted(n,7,"AppContainerUnloadedTimeout","App container is unloaded",t,this.m_onTimeoutTicks,this.m_appErrors)):(t&&(i="Timed out waiting for FnOnInitializeSuccess to be called. startMs:"+this.m_initialTicks+", timeoutMs:"+this.m_onTimeoutTicks+", scenario:"+this.m_scenario+", hostSessionId:"+this.m_hostSessionId+", host: "+this.m_host,t.ULS.traceTag(38589661,logCategory.PptSession,logLevel.Error,i),PPTBootstrapperLogger.recordBootstrapperTimeoutFailure(n,this.errorCode,this.errorName,i,t,this.m_onTimeoutTicks,this.m_appErrors)),n.FnOnInitializeFailure&&n.FnOnInitializeFailure(this.m_callbackTimeoutError,this.m_appInitDiagnostics))}catch(f){t&&t.ULS.traceTag(579604898,logCategory.PptSession,logLevel.Error,"timeoutIfSuccessNotCalled exception: "+f)}}},n}(),QueryStringParamForwarder=function(){function n(){}return n.forward=function(n,t){return!n||n.substr(0,2)!=="wd"||this.noForwardArray.indexOf(n)>=0?null:n+"="+t},n.noForwardArray=["wdPodsUrl","wdPopsUrl","wdNewPodsFrame","wdNewEnabled","wdfs","wdfsection","wdIncludeHostUrl","wdoverrides"],n}(),UrlOverrideUtils=function(){function n(){}return n.forwardMissingWdParamsFromApplicationUrl=function(n,t){var e=t.indexOf("?"),i,u,s,r,f;if(-1===e)return n;var h=t.substr(e+1),c=h.split("&"),o=n;for(i=0,u=c;i<u.length;i++)s=u[i],r=s.split("="),UrlUtils.getParameterValue(n,r[0])===""&&(f=QueryStringParamForwarder.forward(r[0],r[1]),f&&(o+="&"+f));return o},n}(),UrlUtils=function(){function n(){}return n.getParameterValue=function(n,t){var i=n.indexOf("&"+t+"="),r,u;return(i===-1&&(i=n.indexOf("?"+t+"=")),i===-1)?"":(r=i+(t.length+2),u=n.indexOf("&",r),u===-1)?n.substr(r):n.substring(r,u)},n.getParameterValueDecoded=function(n,t){var i=this.getParameterValue(n,t);return i?decodeURI(i):i},n.addOrReplaceParameterValue=function(n,t,i){var u;if(!t)return n;var r=n,f=i==null,s=r.indexOf("?");if(-1===s)return f?n:r+"?"+t+"="+i;var h=r.substr(s+1),e=h.split("&"),o=t+"=",c=!1;for(u=0;u<e.length;u=u+1)if(0===e[u].indexOf(o)){r=r.replace(e[u],f?"":o+i);c=!0;break}return c||f||(h.length>0&&(r+="&"),r+=o+i),r},n.getQueryStringParam=function(n){return this.getParameterValue(window.location.href,n)},n.urlKeyValueEncode=function(n){var t=encodeURIComponent(n);return this.encodeString(t,this.urlKeyValueEncodeReplacements)},n.encodeString=function(n,t){for(var r=n,u=t.length,i=0;i<u;i=i+1)r=r.replace(t[i].FindExpression,t[i].ReplaceValue);return r},n.urlKeyValueEncodeReplacements=[{FindExpression:new RegExp("!","g"),ReplaceValue:"%21"},{FindExpression:new RegExp("'","g"),ReplaceValue:"%27"},{FindExpression:new RegExp("\\(","g"),ReplaceValue:"%28"},{FindExpression:new RegExp("\\)","g"),ReplaceValue:"%29"},{FindExpression:new RegExp("\\*","g"),ReplaceValue:"%2A"}],n}();var WacFallbackController=function(){function n(n,t,i,r,u,f,e){this.BootFailed=!1;this.InitializeWopiPendingParameters=n;this.m_forceWacFallback=t;this.GetFallbackUrl=i;this.OnSuccessWopiInfoCallback=r;this.logger=u;this.windowVisibilityMetrics=f;this.m_postMessageToken=e}return n.prototype.wopiPendingApplicationComplete=function(n,t){this.m_forceWacFallback||this.BootFailed?PPTBootstrapper.launchWacFallback(n,this.InitializeWopiPendingParameters,this.GetFallbackUrl,this.BootFailureInfo,this.logger,this.windowVisibilityMetrics,this.m_postMessageToken):(this.ReturnedWopiInfo=n,this.OnSuccessWopiInfoCallback&&this.OnSuccessWopiInfoCallback(this.ReturnedWopiInfo,t))},n.prototype.wopiPendingApplicationFail=function(){this.logger.ULS.traceTag(38293905,logCategory.PptSession,logLevel.Info,"Host failed to give us WopiInfo")},n}(),WindowVisibilityMetrics=function(){function n(){var t=this,n;this.visibilityChangeEvents=[];this.handleVisibilityChange=function(){var n={visibility:document.visibilityState,time:Date.now(),initialState:!1};t.visibilityChangeEvents.push(n)};document.visibilityState==="hidden"&&(n={visibility:document.visibilityState,time:Date.now(),initialState:!0},this.visibilityChangeEvents.push(n));document.addEventListener("visibilitychange",this.handleVisibilityChange)}return n.prototype.stop=function(){document.removeEventListener("visibilitychange",this.handleVisibilityChange)},n.prototype.getVisibilityChangeEvents=function(){return this.visibilityChangeEvents},n}(),ConditionalAction=function(){function n(n,t){var i=this;if(this.m_conditions={},t.length==0)throw Error("conditions");this.m_action=n;t.forEach(function(n){i.m_conditions[n]=!1})}return n.prototype.SetCondition=function(n){if(this.m_conditions[n]==null)throw Error("condition");this.m_conditions[n]=!0;this.CheckConditions()},n.prototype.AddNewCondition=function(n){if(n in this.m_conditions)throw Error("condition");this.m_conditions[n]=!1},n.prototype.GetCondition=function(n){if(this.m_conditions[n]==null)throw Error("condition");return this.m_conditions[n]},n.prototype.CheckConditions=function(){var n,t;if(this.m_action!=null){n=!0;for(t in this.m_conditions)n=n&&this.m_conditions[t];n&&(this.m_action(),this.m_action=null)}},n}(),PodsSessionFactory=function(){function n(){}return n.CreateSession=function(t,i,r){var o,e,u,f;if(t.FileName==null)throw Error("FileName");if(t.FileUrl==null)throw Error("FileUrl");if(t.AvailableWidth==null)throw Error("AvailableWidth");if(t.AvailableHeight==null)throw Error("AvailableHeight");return o=MathHelper.hash(t.FileUrl),e=t.SessionId,e==undefined&&(e=n.GenerateSessionId(t.FileUrl)),u=t.OnDemandServer+"PodHandler.ashx?action=CreateSession&PodSID="+encodeURIComponent(e)+"&fn="+encodeURIComponent(t.FileName)+"&fileLengthHint="+t.FileSize+"&sw="+t.AvailableWidth+"&sh="+t.AvailableHeight+"&frss="+(t.FRenderSlideShow!=null?t.FRenderSlideShow.toString():"True")+"&fu="+encodeURIComponent(t.FileUrl)+"&usid="+encodeURIComponent(t.UserSessionId)+"&fuLength="+t.FileUrl.length.toString()+"&fuHash="+o.toString(),t.wrsBundleUrl!=undefined&&(u=u+"&wrsBundleUrl="+encodeURIComponent(t.wrsBundleUrl.toString())),t.WdOverrides!=undefined&&(u=u+"&wdoverrides="+encodeURIComponent(t.WdOverrides.toString())),t.DocId!=undefined&&(u=u+"&DocID="+encodeURIComponent(t.DocId)),t.ETag!=undefined&&(u=u+"&ETag="+encodeURIComponent(t.ETag)),t.UserId!=undefined&&(u=u+"&user_id="+encodeURIComponent(t.UserId)),t.Scenario!=undefined&&(u=u+"&scenario="+encodeURIComponent(t.Scenario)),t.supportsDecryptedContentDownload!=undefined&&(u=u+"&supportsDecryptedContentDownload="+t.supportsDecryptedContentDownload.toString()),t.WdParams!=""&&(u=u+t.WdParams),f=new XMLHttpRequest,f.open("GET",u,!0),f.setRequestHeader("X-SupportSVGInWebGL",ViewerBrowserUtils.SupportSVGInWebGL()?"1":"0"),f.onreadystatechange=function(){if(f.readyState===XMLHttpRequest.DONE){var n=f.getResponseHeader("X-OfficeCluster");f.status===200?i.ULS.traceTag(588044117,logCategory.PptSession,logLevel.Info,"PodsSessionFactory::CreateSession succeeded; WacCluster: "+n):(r.push({DuringBoot:!0,ErrorName:"CreateSessionFailed_"+f.status,Tag:""}),i.ULS.traceTag(588044116,logCategory.PptSession,logLevel.Error,"PodsSessionFactory::CreateSession failed; HttpStatusCode: "+f.status+"; WacCluster: "+n))}},f.send(),e},n.GenerateSessionId=function(n){var f=4,i=new Uint32Array(f),r,u,t;if(window.self.crypto&&window.self.crypto.getRandomValues?window.self.crypto.getRandomValues(i):window.msCrypto&&window.msCrypto.getRandomValues&&window.msCrypto.getRandomValues(i),r="",i[0]!=0)for(u=[].slice.call(i),t=0;t<u.length;t++)r+=u[t].toString(36);else for(t=0;t<f;t++)r=Math.random().toString(36).substring(2,25);return"_._._."+r+SHA1.GenerateSHA1(n)+"-.-.-."},n}(),WebViewerBaseMessage=function(){function n(n,t){this.m_id=n;this.m_type=t}return n}(),WebViewerBaseInternalMessage=function(){function n(n){this.m_type=n}return n}(),HandshakeWebViewerInternalMessage=function(n){function t(t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut){var ft=n.call(this,0)||this;return ft.m_id=t,ft.m_fEnableKeyboardNavigation=i,ft.m_contentMetadata=r,ft.m_fileUrl=u,ft.m_fileSize=f,ft.m_fileName=e,ft.m_presentationId=o,ft.m_startingSlideId=s,ft.m_startingSlideIndex=h,ft.m_hostName=c,ft.m_entryPoint=l,ft.m_apiStartTime=a,ft.m_documentClickTime=v,ft.m_hostInitTime=y,ft.m_fEnablePodPreviewStaticImage=p,ft.m_fEnableAdvanceOnTap=w,ft.m_fileHost=b,ft.m_vetoAppSettingsStr=k,ft.m_disabledTransitionsList=d,ft.m_customTransitionResourceUrl=g,ft.m_streamUseThinEmbed=nt,ft.m_disabledChangeGates=tt,ft.m_wacRegion=it,ft.m_addInsInSupportedIrmDocsIsEnabled=rt,ft.m_areThirdPartyAddInsAllowed=ut,ft}return __extends(t,n),t}(WebViewerBaseInternalMessage),BootTimingFromApiInternalMessage=function(n){function t(t){var i=n.call(this,26)||this;return i.m_apiTimings=t,i}return __extends(t,n),t}(WebViewerBaseInternalMessage),RecordStartedSlideShowTimestampInternalMessage=function(n){function t(t){var i=n.call(this,33)||this;return i.m_startSlideShowTime=t,i}return __extends(t,n),t}(WebViewerBaseInternalMessage),PPTPreviewerBootstrapper=function(){function n(){this.m_appErrors=[]}return n.TryLoadSlice=function(n,t,i,r){var u,f,o,e;try{return u=PPTBootstrapSettings.getAppMetadata(),f=PPTBootstrapSettings.viewerSliceBootstrapper(),u&&u.Environment=="wac"&&(o=PPTBootstrapper.getWacStaticResourcesServer(n,t,i,r),f=o+u.WacCdnVersion+"_pptscripts/powerpoint.boot.vslice.js"),e=document.createElement("script"),e.src=f,document.head.insertBefore(e,document.head.firstChild),!0}catch(s){return!1}},n.prototype.InitializeWopiPending=function(t){var w=this,f,c,l,e,o,r,u,a,v,y,p,s,h;this.m_appErrors.length=0;var k=Date.now(),d=n.TryLoadSlice(t.ApplicationCustomSettings,t.ApplicationUrl,t.BootstrapperUrl,t),g=Date.now(),i=undefined;try{return f=t.SessionInformation.HostSessionId,t.ApplicationCustomSettings&&t.ApplicationCustomSettings.ForceHttp||(t.SessionInformation.HostSessionId=PPTBootstrapper.generateRandomUUID()),PPTBootstrapper.ensureInitializeParametersAreTheRightType(t),t.ApplicationCustomSettings=n.InitAppSettingsWithDefaults(t),t.WopiPrecheckInfo.BundleInfo&&t.WopiPrecheckInfo.BundleInfo.Url||(t.WopiPrecheckInfo.BundleInfo={MajorVersion:0}),t.PreviewerRolloutRing=PodsRegionInfo.getPodsRing(t),c=PPTBootstrapper.getOnDemandServer(t),i=ULS.getLogger(t.SessionInformation.HostSessionId,c+"RemoteUls.ashx"),i.ULS.traceTag(38286563,logCategory.PptSession,logLevel.Info,"Bootstrap - initializing session. Build version: "+this.GetVersion()),i.ULS.traceTag(40206739,logCategory.PptSession,logLevel.Info,"Bootstrap - initializing session. Slice load initated: "+d),i.ULS.traceTag(590140833,logCategory.PptSession,logLevel.Info,"Bootstrap - initializing session for Host Session Id:  "+f),l=(new Date).getTime(),i.ULS.traceTag(38286592,logCategory.PptSession,logLevel.Info,"Bootstrapper Init Time: "+l),t!=null&&t.ApplicationCustomSettings!=null&&i.ULS.traceTag(593295124,logCategory.PptSession,logLevel.Info,"StartingSlideIndex: "+t.ApplicationCustomSettings.StartingSlideIndex),t=PPTPreviewerBootstrapperUtils.SanitizeInitialParameters(t,i),e=TimeoutWrapper.addTimeoutWrappersToHostCallbacks(t,i,"Previewer",this.m_appErrors),this.windowVisibilityMetrics=new WindowVisibilityMetrics,o=PPTBootstrapper.getPostMessageToken(t.SessionInformation.HostSessionId),t.PostMessageToken=o,t.SnapRequestID="snapRequestID_"+PPTBootstrapper.generateRandomUUID(),r=n.ShouldUsePODS(t,i),n.LogShouldUsePodsOrCachedResult(r,t.ApplicationUrl,r.Reason,i),this.m_pptFeatureGates=PPTBootstrapperFeatureGatesHelper.getFeatureGates(t,i),t.SessionInformation.WdParams=__assign({},t.SessionInformation.WdParams,{wdBrowserShapeBuilderCompatible:this.isBrowserShapeBuilderCompatible({},i)&&ViewerBrowserUtils.IsBrowserSupportedForModernSlideShow(i,this.m_pptFeatureGates?this.m_pptFeatureGates.ModernSlideShowBlockListForOS:undefined,this.m_pptFeatureGates?this.m_pptFeatureGates.ModernSlideShowBlockListForBrowserVersion:undefined),wdIsFileTypeSupportedForModernSlideShow:this.isFileTypeSupportedForModernSlideShow(t.WopiPrecheckInfo.FileName,i),wdModernRegionBasedRolloutOverride:this.m_pptFeatureGates&&this.m_pptFeatureGates.ModernRegionBasedRolloutOverride}),t.ApplicationCustomSettings.DisabledChangeGates=PPTPreviewerBootstrapperFeatureGatesHelper.CombineDisabledChangeGates(t.ApplicationCustomSettings,this.m_pptFeatureGates),t.HostSessionId=f,u={},u.PostMessageToken=o,u.UsePODSDetails=r,u.HostSessionId=f,a=t,r.ShouldUsePODS||(u.FallbackPreBoot=!0,a=n.SanitizeInputParametersForFallbackLog(t)),PPTBootstrapper.sendInitialLog(a,"Previewer",u,i),this.m_pptFeatureGates&&this.m_pptFeatureGates.StateServiceInPreviewerFeatures&&StateServiceClientLoader.TryLoadStateServiceClient(t.ApplicationCustomSettings,t.ApplicationUrl,t.BootstrapperUrl,t,i,this.m_pptFeatureGates.StateServiceInPreviewerFeatures),r.ShouldUsePODS?(t.ApplicationCustomSettings.OnDemandServer=c,y=PPTBootstrapSettings.getAppMetadata(),y&&y.Environment=="wac"&&(t.ApplicationCustomSettings.WacStaticResourcesServer=PPTBootstrapper.getWacStaticResourcesServer(t.ApplicationCustomSettings,t.ApplicationUrl,t.BootstrapperUrl,t)),(window.location.search.indexOf("wdTestPreviewer")>=0||window.location.hash.indexOf("wdTestPreviewer")>=0)&&t.WopiPrecheckInfo.BundleInfo&&(t.WopiPrecheckInfo.BundleInfo.Url=undefined),PPTBootstrapper.getSlideShowKind(t,i)=="Modern"&&(t.ApplicationCustomSettings.DisabledChangeGates&&t.ApplicationCustomSettings.DisabledChangeGates.indexOf("DoNotSendSnapRequestFromBootstrapper")>=0?i.ULS.traceTag(578172560,logCategory.PptSession,logLevel.Info,"Snap Request from bootstrapper disabled though changeGate"):this.SendSnapDownloadUrlRequest(t,i)),p={initWopiTime:k,bootstrapperInitTime:l,sliceLoadTime:g},n.s_prefetchStartTime>0&&(p.prefetchStartTime=n.s_prefetchStartTime,n.s_prefetchStartTime=0),n.CreateViewer(t,i,p,this.m_appErrors,e),PPTBootstrapper.logBootstrapperPerformanceInfo(t.BootstrapperUrl,"PreviewerTSBoot",i),window.setTimeout(function(){i&&i.ULS.flush()},1e4),{Complete:function(){},Fail:function(r){e.failByHost(t,i,r,w.m_appErrors);n.WopiPendingFail(t.SessionInformation.HostSessionId,r,i)}}):(i.ULS.traceTag(38836228,logCategory.PptSession,logLevel.Info,"Previewer unsupported region"),s=void 0,t.ApplicationCustomSettings&&t.ApplicationCustomSettings.EnableWacFallback&&t.ApplicationUrl?(i.ULS.traceTag(38836229,logCategory.PptSession,logLevel.Info,"Previewer setting up wacFallbackController"),v=new WacFallbackController(t,!0,function(t,i){return n.GetWacPreviewURL(t,i)},null,i,this.windowVisibilityMetrics,o),s={Complete:function(n,t){v.wopiPendingApplicationComplete(n,t)},Fail:function(n){v.wopiPendingApplicationFail(n)}}):(i.ULS.traceTag(38836230,logCategory.PptSession,logLevel.Info,"Previewer returning error for unsupported region"),h={errorType:"AppInitError",errorObject:"Region not suppported",Category:0,Code:8,ErrorName:"RegionNotSupported",EventType:13,ExtraInfo:"Region not suppported"},t.FnOnInitializeFailure(h),s={Complete:function(){},Fail:function(r){e.failByHost(t,i,r,w.m_appErrors);n.WopiPendingFail(t.SessionInformation.HostSessionId,r,i)}}),s)}catch(b){i&&(i.ULS.traceTag(38286593,logCategory.PptSession,logLevel.Error,"AppInitError: "+JSON.stringify(b)),i.ULS.traceTag(590140832,logCategory.PptSession,logLevel.Error,"Host Session Id from Teams: "+t.SessionInformation.HostSessionId),i.ULS.flushOnClose());h={errorType:"AppInitError",errorObject:b,Category:0,Code:1,ErrorName:"InvalidInputParameters",EventType:13,ExtraInfo:"Exception caught"};t.FnOnInitializeFailure(h)}return undefined},n.prototype.isBrowserShapeBuilderCompatible=function(n,t){var f,i,r,u;try{if(f=document.createElement("canvas"),i=f.getContext("webgl"),i==null&&(i=f.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0}),n.WebGLExperimental=!0),i==null)return n.GLIncompatible="CanvasRenderingContext",!1;if(!i.getExtension("EXT_blend_minmax"))return n.GLIncompatible="MinMax",!1;if(!i.getExtension("ANGLE_instanced_arrays"))return n.GLIncompatible="Instancing",!1;var o=i.getParameter(i.MAX_VERTEX_ATTRIBS),l=i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),s=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS),h=i.getParameter(i.MAX_VARYING_VECTORS),c=i.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS),a=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),e=i.getParameter(i.MAX_TEXTURE_SIZE);if(e<4096)return n.GLIncompatible="TextureSize",!1;n.VERTEX_ATTRIBS=o;n.VERTEX_UNIFORM_VECTORS=l;n.VERTEX_TEXTURE_IMAGE_UNITS=s;n.VARYING_VECTORS=h;n.FRAGMENT_UNIFORM_VECTORS=c;n.TEXTURE_IMAGE_UNITS=a;n.TEXTURE_SIZE=e;try{r=i.getExtension("WEBGL_debug_renderer_info");r&&(u={},u.WebGLVendor=i.getParameter(r.UNMASKED_VENDOR_WEBGL),u.WebGLRenderer=i.getParameter(r.UNMASKED_RENDERER_WEBGL),t.ULS.traceTag(594583628,logCategory.PptSession,logLevel.Info,JSON.stringify(u)))}catch(v){}return o<16||s<4||h<8||c<64||e<4096?(n.GLIncompatible="InsufficientCapabilities",!1):!0}catch(y){return n.GLIncompatible="Exception",!1}finally{n.length>0&&t.ULS.traceTag(588105736,logCategory.PptSession,logLevel.Info,JSON.stringify(n))}},n.prototype.isFileTypeSupportedForModernSlideShow=function(n,t){var i=PPTBootstrapper.getFileExtension(n,t);return i=="pptx"||i=="ppsx"?!0:!1},n.createSnapRequestHeaders=function(n,t,i,r){var u=new Headers;return u.append("X-UserSessionId",n),u.append("callercorrelationid",i),u.append("X-WacNoAuth","1"),u.append("Scenario","Previewer"),u.append("Client",t+"-Bootstrapper"),u.append("Content-Type","application/json; charset=utf-8"),u.append("CallId",r),u},n.prototype.SendSnapDownloadUrlRequest=function(t,i){try{if(t==null||t.ApplicationCustomSettings==null||t.SessionInformation==null)return;var r=t.SessionInformation.HostSessionId||"",u=t.SessionInformation.HostName||"",f=t.SnapRequestID||"",e=t.SessionInformation.CallId||"",o=t.WopiPrecheckInfo.FileGetUrl||"",s=t.WopiPrecheckInfo.FileSize,h=t.WopiPrecheckInfo.ETag||"",c=t.WopiPrecheckInfo.DocUniqueId||"",l=t.ApplicationCustomSettings.OnDemandServer||"";n.SendSnapDownloadUrlRequestCore("OnBoot",r,u,f,e,o,h,c,l,i,s)}catch(a){i.ULS.traceTag(588107799,logCategory.PptSession,logLevel.Error,"Exception in SendSnapDownloadUrlRequest: "+a.message)}},n.SendSnapDownloadUrlRequestCore=function(t,i,r,u,f,e,o,s,h,c,l){var v=(new Date).getTime(),a;c&&c.ULS.traceTag(588107801,logCategory.PptSession,logLevel.Info,"SendSnapDownloadUrlRequestCore with callId: "+f+"; triggerOrigin: "+t+"; snapRequestId: "+u+";");try{var y=n.createSnapRequestHeaders(i,r,u,f),p=window.location.search.indexOf("wdAuthHeaderForHostDownloadEnabled")>=0,w={ID:u,DownloadUrl:e,FileLengthHint:l,ETag:o,DocID:s,MultiRangeEnabled:!1,TailRangeEnabled:!0,AuthHeaderForHostDownloadEnabled:p};fetch(h+"SnapUrlHandler.ashx",{method:"POST",headers:y,body:JSON.stringify(w)});a={};a.SendSnapDownloadUrlStart=v;a.SendSnapDownloadUrlEnd=(new Date).getTime();a.CallId=f;c&&c.ULS.traceTag(588107800,logCategory.PptSession,logLevel.Info,JSON.stringify(a,PPTBootstrapper.undefinedReplacer))}catch(b){c&&c.ULS.traceTag(577013019,logCategory.PptSession,logLevel.Error,"Exception in SendSnapDownloadUrlRequestCore: "+b.message)}},n.InitAppSettingsWithDefaults=function(n){return n.ApplicationCustomSettings||(n.ApplicationCustomSettings={}),n.ApplicationCustomSettings.AddShadowBorder=n.ApplicationCustomSettings.AddShadowBorder!=undefined?n.ApplicationCustomSettings.AddShadowBorder:!1,n.ApplicationCustomSettings.EnableAdvanceOnClick=n.ApplicationCustomSettings.EnableAdvanceOnClick!=undefined?n.ApplicationCustomSettings.EnableAdvanceOnClick:!0,n.ApplicationCustomSettings.EnableAutoAdvance=n.ApplicationCustomSettings.EnableAutoAdvance!=undefined?n.ApplicationCustomSettings.EnableAutoAdvance:PodsRegionInfo.getUiHost(n.SessionInformation.HostName)=="teams"?!1:!0,n.ApplicationCustomSettings.EnableKeyboardNavigation=n.ApplicationCustomSettings.EnableKeyboardNavigation!=undefined?n.ApplicationCustomSettings.EnableKeyboardNavigation:!0,n.ApplicationCustomSettings.EnableWacFallback=n.ApplicationCustomSettings.EnableWacFallback!=undefined?n.ApplicationCustomSettings.EnableWacFallback:!0,n.ApplicationCustomSettings.ForceHttp=n.ApplicationCustomSettings.ForceHttp!=undefined?n.ApplicationCustomSettings.ForceHttp:!1,n.ApplicationCustomSettings.PreserveDrawingBuffer=n.ApplicationCustomSettings.PreserveDrawingBuffer!=undefined?n.ApplicationCustomSettings.PreserveDrawingBuffer:!1,n.ApplicationCustomSettings.TakeFocusOnBoot=n.ApplicationCustomSettings.TakeFocusOnBoot!=undefined?n.ApplicationCustomSettings.TakeFocusOnBoot:!0,n.ApplicationCustomSettings.UseTransparentBackground=n.ApplicationCustomSettings.UseTransparentBackground!=undefined?n.ApplicationCustomSettings.UseTransparentBackground:!0,n.ApplicationCustomSettings.EnableAdvanceOnTap=n.ApplicationCustomSettings.EnableAdvanceOnTap!=undefined?n.ApplicationCustomSettings.EnableAdvanceOnTap:!1,n.ApplicationCustomSettings},n.WopiPendingFail=function(t,i,r){var u=i,e=u==null?"":u.message,f;r.ULS.traceTag(38286594,logCategory.PptSession,logLevel.Warning,"WopiPendingFail - message: "+e);f=u==null?!1:u.shutdownApp==!0;f&&n.CleanupWopiPending(t)},n.CleanupWopiPending=function(n){var i=PPTMessageListenerRegistry.getInstance(),t=i.get(n);t&&t.Dispose()},n.SanitizeInputParametersForFallbackLog=function(n){return{BootstrapperUrl:n.BootstrapperUrl,Container:n.Container,PostMessageToken:n.PostMessageToken,PreviewerRolloutRing:n.PreviewerRolloutRing,SessionInformation:{HostName:n.SessionInformation.HostName,HostSessionId:n.SessionInformation.HostSessionId,UserId:""},ApplicationUrl:n.ApplicationUrl,WopiPrecheckInfo:{FileName:""},NewFileTemplateSource:{},ApplicationCustomSettings:n.ApplicationCustomSettings,Diagnostics:n.Diagnostics,FnOnInitializeSuccess:n.FnOnInitializeSuccess,FnOnInitializeFailure:n.FnOnInitializeFailure}},n.ShouldUsePODS=function(n,t){var i=PPTBootstrapper.inferFileNewFromWopiPrecheckInfo(n.WopiPrecheckInfo,n.ApplicationUrl,n.NewFileTemplateSource,t);return window.location.search.indexOf("wdTestWac=1")>=0||window.location.search.indexOf("wdTestWac=1")>=0?createUsePODSDetails(!1,!1,"wdTestWac set to true in Host Page URL",i):n.ApplicationCustomSettings&&n.ApplicationCustomSettings.OnDemandServer?createUsePODSDetails(!0,!0,"OnDemandServer provided by Host",i):!n.ApplicationUrl&&n.SessionInformation.HostName!="MSTeams"&&n.SessionInformation.HostName!="TeamsiOS"&&n.SessionInformation.HostName!="apiTest"&&n.SessionInformation.HostName!="TeamsAndroid"?createUsePODSDetails(!1,!1,"No Application URL provided (Sharepoint)",i):n.ApplicationUrl?!n.WopiPrecheckInfo.FileGetUrl&&n.WopiPrecheckInfo.BundleInfo.Url?createUsePODSDetails(!0,!0,"No FileGetUrl was provided but a cached bundle URL was",i):window.location.search.indexOf("wdTestPreviewer=1")>=0||window.location.hash.indexOf("wdTestPreviewer=1")>=0||window.location.search.indexOf("wdTestWacPreviewer=1")>=0?createUsePODSDetails(!0,!0,"wdTestPreviewer set to true in Host Page URL",i):PPTBootstrapper.podsFlighting(n,!1,t):createUsePODSDetails(!0,!0,"No Application URL provided",i)},n.LogShouldUsePodsOrCachedResult=function(n,t,i,r){var u={};u.ShouldUsePods=n.ShouldUsePODS;u.CanUsePods=n.CanUsePODS;u.ApplicationUrl=PPTBootstrapper.extractHostname(t);u.Reason=i;r.ULS.traceTag(38286595,logCategory.PptSession,logLevel.Info,JSON.stringify(u))},n.GetWacPreviewURL=function(n,t){var r,u,f,i;return n.WopiSrc.indexOf("PowerPointFrame.aspx")>=0&&(r=n.WopiSrc.substr(n.WopiSrc.indexOf("WOPISrc=")+8),u=r.indexOf("&"),n.WopiSrc=u<0?decodeURIComponent(decodeURI(r)):decodeURIComponent(r.substring(0,u))),f=t.ApplicationUrl.indexOf("?"),i=t.ApplicationUrl.substring(0,f),i+="?PowerPointView=ReadingView&wdnc=1&wdEnableRoaming=1&wdo=1",i=PPTBootstrapper.appendCommonFrameUrlQueryParams(i,t),PPTPreviewerBootstrapperUtils.AppendCommonFallbackQueryParams(i,t,n.WopiSrc)},n.prototype.InitializePodsExisting=function(t){var o=n.TryLoadSlice(t.ApplicationCustomSettings,t.ApplicationUrl,t.BootstrapperUrl,t),i,r,u,f,e;t.WopiPrecheckInfo.BundleInfo||(t.WopiPrecheckInfo.BundleInfo={MajorVersion:0});t.ApplicationCustomSettings=n.InitAppSettingsWithDefaults(t);t.ApplicationCustomSettings.OnDemandServer||window.location.href&&(t.ApplicationCustomSettings.OnDemandServer=window.location.href.split("SlideShowFrame.html")[0]);i=undefined;i=ULS.getLogger(t.SessionInformation.HostSessionId,t.ApplicationCustomSettings.OnDemandServer+"RemoteUls.ashx");i.ULS.traceTag(40206740,logCategory.PptSession,logLevel.Info,"Bootstrap - initializing PodsExisting. Slice load initated: "+o);PPTBootstrapper.sendInitialLog(t,"Slide Show",null,i);r=PPTBootstrapSettings.getAppMetadata();r&&r.Environment=="wac"&&(t.ApplicationCustomSettings.WacStaticResourcesServer=PPTBootstrapper.getWacStaticResourcesServer(t.ApplicationCustomSettings,t.ApplicationUrl,t.BootstrapperUrl,t));u={};u.podsSessionId=t.WopiPrecheckInfo.PodSessionId;i.ULS.traceTag(38540374,logCategory.PptSession,logLevel.Info,JSON.stringify(u));f=PPTMessageListenerRegistry.getInstance().get(t.SessionInformation.HostSessionId);f&&(i.ULS.traceTag(39416217,logCategory.PptSession,logLevel.Error,"InitializePodsExisting found a session already created for this id. Disposing it"),f.DisposePreloadedApp());e=new PreviewSessionLoader(t,i,r,this.m_appErrors);e.LoadApp(t.WopiPrecheckInfo.PodSessionId,!1,{});e.LaunchFromSlide({PresentationId:t.WopiPrecheckInfo.PodSessionId,StartingSlideId:t.ApplicationCustomSettings.StartingSlideId,StartingSlideIndex:t.ApplicationCustomSettings.StartingSlideIndex,Diagnostics:t.Diagnostics,SendInitialLog:!1,StreamVideoUseThinEmbed:!1,DisabledChangeGates:t.ApplicationCustomSettings.DisabledChangeGates,AddInsInSupportedIrmDocsIsEnabled:t.ApplicationCustomSettings.AddInsInSupportedIrmDocsIsEnabled!=null?t.ApplicationCustomSettings.AddInsInSupportedIrmDocsIsEnabled:!1,AreThirdPartyAddInsAllowed:t.ApplicationCustomSettings.AreThirdPartyAddInsAllowed!=null?t.ApplicationCustomSettings.AreThirdPartyAddInsAllowed:!1});PPTBootstrapper.logBootstrapperPerformanceInfo(t.BootstrapperUrl,"InitializePodsExisting",i)},n.prototype.PreloadApp=function(t){var e=(new Date).getTime(),o=n.TryLoadSlice(t.ApplicationCustomSettings,t.ApplicationUrl,t.BootstrapperUrl,t),i,r,f,u;return t.WopiPrecheckInfo.BundleInfo||(t.WopiPrecheckInfo.BundleInfo={MajorVersion:0}),t.ApplicationCustomSettings=n.InitAppSettingsWithDefaults(t),i=undefined,i=ULS.getLogger(t.SessionInformation.HostSessionId,t.ApplicationCustomSettings.OnDemandServer+"RemoteUls.ashx"),i.ULS.traceTag(40206741,logCategory.PptSession,logLevel.Info,"Bootstrap - initializing session. Slice load initated: "+o),PPTBootstrapper.sendInitialLog(t,"Preload App",null,i),r=PPTBootstrapSettings.getAppMetadata(),r&&r.Environment=="wac"&&(t.ApplicationCustomSettings.WacStaticResourcesServer=PPTBootstrapper.getWacStaticResourcesServer(t.ApplicationCustomSettings,t.ApplicationUrl,t.BootstrapperUrl,t)),f=new PreviewSessionLoader(t,i,r,this.m_appErrors),f.LoadApp(null,!0,{}),u={},u.PreloadAppFunctionStart=e,u.PreloadAppFunctionEnd=(new Date).getTime(),i.ULS.traceTag(38286596,logCategory.PptSession,logLevel.Info,JSON.stringify(u,PPTBootstrapper.undefinedReplacer)),PPTBootstrapper.logBootstrapperPerformanceInfo(t.BootstrapperUrl,"PreloadApp",i),f},n.prototype.GetVersion=function(){return BuildVersionConfig.BUILD_NUMBER},n.GetMinContentVersion=function(){return 1},n.Prefetch=function(t){var r,u,f,i;n.s_prefetchStartTime=(new Date).getTime();r=["pptscripts/reader.dione.js"];n.PrefetchRequiredOnly(t,r);u=t!=null&&t.IsModernSlideShowInTeamsEnabled!=null&&t.IsModernSlideShowInTeamsEnabled;u&&t.FileGetUrl!=null&&t.WacUrl!=null&&(f="snapRequestID_"+PPTBootstrapper.generateRandomUUID(),i=PodsRegionInfo.tryGetPodsRegion(t.WacUrl,null,!1),i&&n.SendSnapDownloadUrlRequestCore("Prefetch","",t.HostName,f,t.CallId,t.FileGetUrl,t.ETag,t.DocId,i.PodsURL,null,t.FileSize))},n.PrefetchRequiredOnly=function(t,i){var e=t!=null&&t.IsLegacyAspxInTeamsEnabled!=null&&t.IsLegacyAspxInTeamsEnabled,o=t!=null&&t.IsModernSlideShowInTeamsEnabled!=null&&t.IsModernSlideShowInTeamsEnabled,r=[],u,f;r=e?o?["pptscripts/slideshowapp.js","pptscripts/slideshowui.js",]:["pptscripts/microsoftajax.js","pptscripts/bootview.js","pptscripts/WebViewerPreboot.js","pptscripts/ppt.slideshowplayer.api.js","pptscripts/ppt.inkcanvasmanager.js","pptscripts/transitions.js","pptscripts/ppttelemetry.js"]:["powerpointframe.html"];u=PPTBootstrapSettings.getAppMetadata();t&&u&&u.Environment!="wac"&&r.push("AppMetadata.js");f=r.concat(i);n.PrefetchSpecifiedResources(t,f)},n.PrefetchSpecifiedResources=function(t,i){var r=PPTBootstrapSettings.getAppMetadata(),f,u;if(r&&(r.Environment=="int"||r.Environment=="edog"||r.Environment=="prod"))f=PPTBootstrapSettings.getCDNManifestMapping(),i.forEach(function(t){t=="powerpointframe.html"?n.CreatePrefetchLink("https://contentstorage.osi.office.net/pages/"+f["pptpages/powerpointframe.html"]+"#powerpointframe.html"):t=="powerpoint.boot.js"?n.CreatePrefetchLink("https://contentstorage.osi.office.net/boot/powerpoint.boot.js"):n.CreatePrefetchLink("https://contentstorage.osi.office.net/scripts/"+f[t]+"#"+t.split("//").pop())});else{if(u=null,r&&r.Environment=="wac")u=t&&t.IsModernSlideShowInTeamsEnabled?PPTBootstrapper.getWacStaticResourcesServer(null,null,t?t.BootstrapperUrl:null,null)+r.WacCdnVersion+"_":PPTBootstrapper.getWacStaticResourcesServer(null,null,t?t.BootstrapperUrl:null,null)+r.WacCdnVersion+"_slideshowresources/";else if(t&&t.AppBundleParameters&&t.AppBundleParameters.appBundleCustomUrl)u=t.AppBundleParameters.appBundleCustomUrl;else throw Error("Error: Prefetch using custom hosting requires prefetchParameters be provided");i.forEach(function(t){try{ViewerBrowserUtils.SupportPreloadLink()?t==="powerpointframe.html"?n.CreatePrefetchLink(u+t):n.CreatePreloadLink(u+t,"script"):n.CreatePrefetchLink(u+t)}catch(i){}})}},n.CreatePreloadLink=function(n,t){var i=document.createElement("link");i.rel="preload";i.href=n;t!==""&&i.setAttribute("as",t);document.getElementsByTagName("head")[0].appendChild(i)},n.CreatePrefetchLink=function(n){var t=document.createElement("link");t.rel="prefetch";t.href=n;document.getElementsByTagName("head")[0].appendChild(t)},n.CreateViewer=function(n,t,i,r,u){var e,o,v,f,d,p,h;i.createViewerTime=Date.now();var c=PPTBootstrapSettings.getAppMetadata(),l=c&&c.AppVersionMajor!=n.WopiPrecheckInfo.BundleInfo.MajorVersion,a=ViewerBrowserUtils.SupportSVGInWebGL();if((l||!a)&&(t.ULS.traceTag(38540375,logCategory.PptSession,logLevel.Info,"AppVersionMajor and ContentVersionMajor version mismatch: "+l+", or browser does not support SVG in WebGL: "+!a),n.WopiPrecheckInfo.BundleInfo.Url=undefined,!n.WopiPrecheckInfo.FileGetUrl)){e={EventType:13,Code:9,ErrorName:"AppAndContentVersionMismatchWithNoFileGetUrl",Category:0,ExtraInfo:"",SessionId:n.SessionInformation.HostSessionId,errorType:"AppInitError",errorObject:"AppVersionMajor and ContentVersionMajor version mismatch: "+l+", or browser does not support SVG in WebGL: "+!a};n.FnOnInitializeFailure(e);return}if(!n.WopiPrecheckInfo.BundleInfo.Url&&!n.WopiPrecheckInfo.FileGetUrl){e={EventType:13,Code:10,ErrorName:"MissingFileGetUrlAndBundleUrl",Category:0,ExtraInfo:"",SessionId:n.SessionInformation.HostSessionId,errorType:"AppInitError",errorObject:"Neither wopiPrecheckInfo.FileGetUrl or wopiPrecheckInfo.BundleInfo.Url provided"};n.FnOnInitializeFailure(e);return}if(!n.Container){e={EventType:13,Code:11,ErrorName:"NoAppContainer",Category:0,ExtraInfo:"",SessionId:n.SessionInformation.HostSessionId,errorType:"AppInitError",errorObject:"Container"};n.FnOnInitializeFailure(e);return}if(o="",n.SessionInformation&&n.SessionInformation.WdParams)for(v in n.SessionInformation.WdParams)o=o+"&"+v+"="+n.SessionInformation.WdParams[v];var w=BrowserUtils.devicePixelRatio(),b=n.ApplicationCustomSettings.AddShadowBorder?10:0,k=n.Container.getBoundingClientRect(),g=Math.round(w*Math.max(Math.ceil(k.width),300)-2*b),nt=Math.round(w*Math.max(Math.ceil(k.height),201)-2*b),s=!0,y=PPTBootstrapper.getSlideShowKind(n,t);y=="Modern"&&(s=!1);y=="Legacy"&&(s=!1,t.ULS.traceTag(579654849,logCategory.PptSession,logLevel.Warning,"Create Pods Session in Aspx, don't create in bootstrapper"));f=n.SessionInformation.HostSessionId;s?(d={FileName:n.WopiPrecheckInfo.FileName,FileUrl:n.WopiPrecheckInfo.FileGetUrl,FileSize:n.WopiPrecheckInfo.FileSize,OnDemandServer:n.ApplicationCustomSettings.OnDemandServer,AvailableWidth:g,AvailableHeight:nt,UserSessionId:n.SessionInformation.HostSessionId,FRenderSlideShow:!0,wrsBundleUrl:n.WopiPrecheckInfo.BundleInfo.Url,WdOverrides:UrlUtils.getParameterValue(window.location.search,"wdoverrides"),DocId:n.WopiPrecheckInfo.DocUniqueId,ETag:n.WopiPrecheckInfo.ETag,UserId:n.SessionInformation.UserId,Scenario:n.SessionInformation.HostName,WdParams:o,supportsDecryptedContentDownload:!0},f=PodsSessionFactory.CreateSession(d,t,r),p={},p.podsSessionId=f,t.ULS.traceTag(38540376,logCategory.PptSession,logLevel.Info,JSON.stringify(p))):f="";t.ULS.traceTag(579654819,logCategory.PptSession,logLevel.Warning,"shouldCreatePodsSession: "+s+". slideShowKind: "+y+". PresentationId: "+f);n.WopiPrecheckInfo.BundleInfo&&(n.WopiPrecheckInfo.BundleInfo.Url=undefined,t.ULS.traceTag(38540377,logCategory.PptSession,logLevel.Info,"Cleared bundle info url"));h=new PreviewSessionLoader(n,t,c,r,u);h.LoadApp(f,!1,i);h.LaunchFromSlide({PresentationId:f,StartingSlideId:n.ApplicationCustomSettings.StartingSlideId,StartingSlideIndex:n.ApplicationCustomSettings.StartingSlideIndex,Diagnostics:n.Diagnostics,SendInitialLog:!1,StreamVideoUseThinEmbed:!1,DisabledChangeGates:n.ApplicationCustomSettings.DisabledChangeGates,AddInsInSupportedIrmDocsIsEnabled:n.ApplicationCustomSettings.AddInsInSupportedIrmDocsIsEnabled!=null?n.ApplicationCustomSettings.AddInsInSupportedIrmDocsIsEnabled:!1,AreThirdPartyAddInsAllowed:n.ApplicationCustomSettings.AreThirdPartyAddInsAllowed!=null?n.ApplicationCustomSettings.AreThirdPartyAddInsAllowed:!1});i.bootstrapperInitTime&&h.RecordBootStrapperInitTime(i.bootstrapperInitTime)},n.s_prefetchStartTime=0,n}(),PPTPreviewerBootstrapperUtils=function(){function n(){}return n.SanitizeInitialParameters=function(n,t){if(n.SessionInformation&&n.SessionInformation.DocumentClickTime)try{var i=n.SessionInformation.DocumentClickTime.getTime()}catch(r){t.ULS.traceTag(590123598,logCategory.PptSession,logLevel.Warning,"DocumentClickTime was not of type Date");n.SessionInformation.DocumentClickTime=undefined}try{n.SessionInformation.HostName=="TeamsAndroid"&&(!n.SessionInformation.ContentId&&n.ContentID&&(n.SessionInformation.ContentId=n.ContentID),!n.SessionInformation.UserId&&n.UserId&&(n.SessionInformation.UserId=n.UserId?n.UserId:""),!n.SessionInformation.TenantId&&n.TenantId&&(n.SessionInformation.TenantId=n.TenantId),!n.SessionInformation.EndpointId&&n.EndpointID&&(n.SessionInformation.EndpointId=n.EndpointID),!n.SessionInformation.IsPresenter&&n.IsPresenter&&(n.SessionInformation.IsPresenter=n.IsPresenter))}catch(r){t.ULS.traceTag(587327070,logCategory.PptSession,logLevel.Warning,"Exception trying to parse Android session params")}return n},n.AppendCommonFallbackQueryParams=function(n,t,i){return t.SessionInformation.HostSessionId&&(n=UrlUtils.addOrReplaceParameterValue(n,"hid",t.SessionInformation.HostSessionId)),i&&(n=UrlUtils.addOrReplaceParameterValue(n,"WOPISrc",UrlUtils.urlKeyValueEncode(i))),n},n.IsTeamsPreviewerSession=function(n,t){return!t&&!!n&&!!n.SessionInformation&&!!n.SessionInformation.HostName&&n.SessionInformation.HostName.indexOf("Teams")>=0},n}(),PreviewSessionLoader=function(){function n(t,i,r,u,f){if(this.m_startingSlideId=-1,this.m_startingSlideIndex=-1,this.m_vetoAppSettingsStr="",this.m_disabledTransitionsList="",this.m_customTransitionResourceUrl="",this.m_streamUseThinEmbed=!1,this.m_disabledChangeGates="",this.m_iframe=null,this.m_bootTimingDict={},this.m_appBootTimingDict={},this.m_contentMetadata=null,this.m_appInitDiagnostics={},this.m_iframeReadyForPostMessage=!1,this.m_fShouldUseLegacySlideShowAspx=!1,this.m_slideshowKind="",this.m_iframeLoadTimeout=undefined,this.m_retryPreviewerTimeout=undefined,this.m_bootCompleted=!1,this.c_appErrorThrottleCount=5,this.c_iframeLoaded="iframeLoaded",this.c_contentMetadataLoadedOrDoesNotExist="contentMetadataLoaded",this.c_activated="activated",this.c_minHeight=100,this.c_minIframeHeight=100,this.m_callbackIframeLoadFailed={errorType:"AppInitError",errorObject:"Failed to load iframe",Category:0,Code:101,ErrorName:"FailedToLoadIframe",EventType:13,ExtraInfo:"Iframe load Error"},!t)throw Error("initParams is null");if(!t.SessionInformation.HostSessionId)throw Error("sessionId is null");this.m_apiId=t.SessionInformation.HostSessionId;this.m_appMetaData=r;this.m_apiStartTime=Date.now();this.m_logger=i;this.m_appErrors=u;f&&f.setAppInitDiagnostics(this.m_appInitDiagnostics);t.ApplicationCustomSettings&&!t.ApplicationCustomSettings.OnDemandServer&&(t.ApplicationCustomSettings.OnDemandServer=PPTBootstrapper.getOnDemandServer(null));this.m_initParams=t;this.m_fShouldUseLegacySlideShowAspx=PPTBootstrapper.shouldUseLegacySlideShowAspx(this.m_initParams);this.m_slideshowKind=PPTBootstrapper.getSlideShowKind(this.m_initParams,i);this.m_anchor=t.Container;t.ApplicationCustomSettings?(this.m_fVariableWidth=!n.FIsUintValid(t.ApplicationCustomSettings.Width),this.m_fVariableHeight=!n.FIsUintValid(t.ApplicationCustomSettings.Height),this.m_startingSlideId=t.ApplicationCustomSettings.StartingSlideId||-1,this.m_startingSlideIndex=t.ApplicationCustomSettings.StartingSlideIndex||-1):(this.m_fVariableWidth=!0,this.m_fVariableHeight=!0);t.Diagnostics&&t.Diagnostics.userClickTime?this.m_bootTimingDict.DocumentClickTime=t.Diagnostics.userClickTime:t.SessionInformation.DocumentClickTime&&(this.m_bootTimingDict.DocumentClickTime=t.SessionInformation.DocumentClickTime.getTime());this.m_slideShowLoader=new SlideShowLoader(t,i,r);PPTMessageListenerRegistry.getInstance().get(this.m_apiId)&&i.ULS.traceTag(39203528,logCategory.PptSession,logLevel.Error,"PreviewSessionLoader is about to overwrite value in PPTMessageListenerRegistry");PPTMessageListenerRegistry.getInstance().add(this.m_apiId,this,!0,"PreviewSessionLoader")}return n.FIsUintValid=function(n){return!(n==null||n<0||isNaN(n))},n.CreateBaseIframe=function(n){var t=document.createElement("iframe");return t.id="pptframe-"+n,t.frameBorder="0",t.style.top=HTMLHelper.toPx(0),t.style.bottom=HTMLHelper.toPx(0),t.style.left=HTMLHelper.toPx(0),t.style.right=HTMLHelper.toPx(0),t.style.width=HTMLHelper.floatToPercent(1),t.style.height=HTMLHelper.floatToPercent(1),t.setAttribute("allowfullscreen",(!0).toString()),t.setAttribute("allowTransparency",(!0).toString()),t.setAttribute("allow","autoplay;"),t},n.prototype.registerOnLoadEvent=function(){var n=this;this.removeIframeOnLoadEvent();this.m_onLoad=function(){return n.OnIframeLoaded()};this.m_iframe.addEventListener("load",this.m_onLoad,!1)},n.prototype.registerOnUnloadEvent=function(){var n=this;this.m_iframe.addEventListener("unload",function(){n.m_logger.ULS.traceTag(588044115,logCategory.PptSession,logLevel.Warning,"Unloading previewer iframe");n.m_appErrors.length>0&&n.m_logger.ULS.traceTag(588044114,logCategory.PptSession,logLevel.Warning,JSON.stringify(n.m_appErrors));n.m_logger.ULS.flushOnClose()})},n.prototype.registerOnLoadErrorEvent=function(){var n=this;this.m_onLoadError=function(){return n.OnIframeLoadError()};this.m_iframe.addEventListener("error",this.m_onLoadError,!1)},n.prototype.removeIframeOnLoadEvent=function(){this.m_onLoad&&this.m_iframe.removeEventListener("load",this.m_onLoad)},n.prototype.OnIframeLoaded=function(){var n=this;this.m_logger.ULS.traceTag(39416209,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::OnIframeLoaded");this.m_bootTimingDict.iFrameOnloadEventInApi=Date.now();this.m_iframeReadyForPostMessage||(this.m_iframeLoadTimeout=window.setTimeout(function(){return n.IframeLoadTimeout()},15e3))},n.prototype.OnIframeLoadError=function(){this.m_logger.ULS.traceTag(590424142,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::OnIframeLoadError : iframe Id: "+this.m_iframe.id);this.m_initParams.FnOnInitializeFailure&&this.m_initParams.FnOnInitializeFailure(this.m_callbackIframeLoadFailed);this.m_onLoadError&&this.m_iframe.removeEventListener("error",this.m_onLoadError)},n.prototype.IframeLoadTimeout=function(){if(this.m_iframeReadyForPostMessage){this.m_logger.ULS.traceTag(39416210,logCategory.PptSession,logLevel.Warning,"IFrameLoadTimeout called even though iframe is ready for postmessage");return}if(!this.m_apiId){this.m_logger.ULS.traceTag(39416211,logCategory.PptSession,logLevel.Warning,"IFrameLoadTimeout called after m_apiId is null");return}var n={EventType:13,Code:100,ErrorName:"TimeoutWaitingForIframeToLoad",Category:0,ExtraInfo:"Timeout waiting for iframe to load",SessionId:this.m_apiId,errorType:"13",errorObject:null};PPTBootstrapperLogger.recordBootstrapperTimeoutFailure(this.m_initParams,100,"TimeoutWaitingForIframeToLoad","Timeout waiting for iframe to load",this.m_logger,Date.now(),this.m_appErrors);this.FailToBoot(n)},n.prototype.Activate=function(){if(!this.m_apiId){this.m_logger.ULS.traceTag(38540363,logCategory.PptSession,logLevel.Warning,"PreviewSessionLoader::Activate is missing apiId or presentationId");return}this.m_logger.ULS.traceTag(38540364,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::Activate");(this.m_iframe==null||this.m_iframe.parentElement==null)&&this.m_logger.ULS.traceTag(39203531,logCategory.PptSession,logLevel.Error,"PreviewSessionLoader::Activate - iframe is null or detached from parent");this.m_bootTimingDict.ActivateInApi=Date.now();var n=this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.EnableKeyboardNavigation!=undefined?this.m_initParams.ApplicationCustomSettings.EnableKeyboardNavigation:!0,t=this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.EnablePodPreviewStaticImage!=undefined?this.m_initParams.ApplicationCustomSettings.EnablePodPreviewStaticImage:!1,i=this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.EnableAdvanceOnTap!=undefined?this.m_initParams.ApplicationCustomSettings.EnableAdvanceOnTap:!1,r=this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.AddInsInSupportedIrmDocsIsEnabled!=undefined?this.m_initParams.ApplicationCustomSettings.AddInsInSupportedIrmDocsIsEnabled:!1,u=this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.AreThirdPartyAddInsAllowed!=undefined?this.m_initParams.ApplicationCustomSettings.AreThirdPartyAddInsAllowed:!1;if(this.PostMessageDownward(new HandshakeWebViewerInternalMessage(this.m_apiId,n,this.m_contentMetadata,this.m_initParams.WopiPrecheckInfo.FileGetUrl,this.m_initParams.WopiPrecheckInfo.FileSize,this.m_initParams.WopiPrecheckInfo.FileName,this.m_presentationId,this.m_startingSlideId,this.m_startingSlideIndex,this.m_initParams.SessionInformation.HostName,this.m_initParams.Diagnostics?this.m_initParams.Diagnostics.entryPoint:"",this.m_apiStartTime,this.m_initParams.Diagnostics?this.m_initParams.Diagnostics.userClickTime?this.m_initParams.Diagnostics.userClickTime:0:0,this.m_initParams.SessionInformation.HostInitTime?this.m_initParams.SessionInformation.HostInitTime:0,t,i,PodsRegionInfo.getFileHost(this.m_initParams),this.m_vetoAppSettingsStr,this.m_disabledTransitionsList,this.m_customTransitionResourceUrl,this.m_streamUseThinEmbed,this.m_disabledChangeGates,PodsRegionInfo.getWACRegion(this.m_initParams.ApplicationUrl),r,u)),!this.m_finishedBootingConditional){this.m_logger.ULS.traceTag(51448026,logCategory.PptSession,logLevel.Warning,"PreviewSessionLoader::OnMesssage - Conditional Action uninitialized");throw Error("m_finishedBootingConditional");}this.m_finishedBootingConditional.SetCondition(this.c_activated)},n.prototype.PostMessageDownward=function(n){var t=JSON.stringify(n),i=this.m_slideshowKind=="Modern"||this.m_fShouldUseLegacySlideShowAspx;this.m_iframe&&(this.m_iframe.src.length!=0||i)&&this.m_iframe.contentWindow?this.m_iframe.contentWindow.postMessage(t,this.m_iframe.src==""?"*":this.m_iframe.src):this.m_logger.ULS.traceTag(39203532,logCategory.PptSession,logLevel.Error,"PreviewSessionLoader::PostMessageDownward - iframe is invalid")},n.prototype.FailToBoot=function(n){this.m_logger.ULS.traceTag(38540365,logCategory.PptSession,logLevel.Error,"PreviewSessionLoader::FailToBoot: "+JSON.stringify(n));this.Dispose();this.m_initParams.FnOnInitializeFailure(n,{appBootTimingDict:JSON.stringify(this.m_appBootTimingDict)})},n.prototype.FinishBoot=function(n,t){if(!this.m_apiId||!this.m_anchor||!this.m_iframe){this.m_logger.ULS.traceTag(38540366,logCategory.PptSession,logLevel.Error,"FinishBoot is missing parameters");return}this.m_logger.ULS.traceTag(38540367,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::FinishBoot");var u=this.m_appMetaData?this.m_appMetaData.AppVersionMajor+"."+this.m_appMetaData.AppVersionMinor:"Not Ready",f=this.m_initParams.WopiPrecheckInfo.BundleInfo!=undefined&&this.m_initParams.WopiPrecheckInfo.BundleInfo.Url!=null,e=function(n){var t=PPTMessageListenerRegistry.getInstance();t&&t.remove(n,!0,"FinishBoot::DisposeCallBack")},i=n.GetPreviewAPIV1(this.m_anchor,this.m_iframe,this.m_apiId,f,u,this.m_slideshowKind,this.m_initParams,t.perceivedLoadTime,e,this.m_logger),r=PPTMessageListenerRegistry.getInstance();r.remove(this.m_apiId,!0,"FinishBoot::TransferRegistration");r.add(this.m_apiId,i,!0,"FinishBoot::TransferRegistration");this.DisposeForTransferToPreviewAPI();this.m_logger.ULS.traceTag(38540368,logCategory.PptSession,logLevel.Info,"FinishBoot - returning FnOnInitializeSuccess");this.m_initParams.FnOnInitializeSuccess(i,t)},n.prototype.onSliceLoaded=function(){this.m_apiId&&this.m_bootCompleted&&n.s_previewAPIFactory?this.FinishBoot(n.s_previewAPIFactory,this.m_appInitDiagnostics):this.m_apiId&&this.m_logger.ULS.traceTag(38540369,logCategory.PptSession,logLevel.Info,"onSliceLoaded: App is not ready yet - "+this.m_apiId.toString())},n.prototype.log=function(n,t){this.m_logger.ULS.traceTag(39978265,logCategory.PptSession,logLevel.Info,n);t!=null&&this.m_logger.ULS.traceTag(591946190,logCategory.PptSession,logLevel.Info,t)},n.prototype.onMessage=function(t,i){var r,e,o,u,s,h,f;if(this.m_iframe&&this.m_iframe.contentWindow==i){if(t=t,!t||t.m_type==undefined){this.m_logger.ULS.traceTag(39978266,logCategory.PptSession,logLevel.Error,"PreviewSessionLoader::onMessage - received message with the wrong syntax");return}switch(t.m_type){case 0:this.m_bootCompleted=!0;this.m_logger.ULS.traceTag(38540370,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::onMessage - received Handshake from iframe");r=t;e=r.m_percievedBootTime?new Date(r.m_percievedBootTime):undefined;this.m_appInitDiagnostics.perceivedLoadTime=e;this.m_contentMetadata||(o={HttpStatus:this.m_contentMetadataHttpStatusCode},this.m_appInitDiagnostics.errorObject={errorType:"CannotLoadBundleItem",errorObject:o});this.m_iframe!=null&&r.m_data!=null&&r.m_data.title&&(this.m_iframe.title=r.m_data.title,this.m_iframe.setAttribute("aria-label",r.m_data.title));n.s_previewAPIFactory?this.FinishBoot(n.s_previewAPIFactory,this.m_appInitDiagnostics):this.m_logger.ULS.traceTag(38540371,logCategory.PptSession,logLevel.Warning,"PreviewSessionLoader::onMessage - Handshake received but PreviewAPIFactory is not available");break;case 10:u=t;!isNaN(u.m_code)&&u.m_code>=0&&(s=0,h={EventType:13,Code:u.m_code,ErrorName:u.m_errorName,Category:s,ExtraInfo:u.m_extraInfo,SessionId:u.m_sessionId,errorType:"13",errorObject:null},this.FailToBoot(h));break;case 28:if(this.m_bootTimingDict.AppReadyForPostMessage=Date.now(),this.m_logger.ULS.traceTag(39416212,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::onMessage - AppReadyForPostMessage"),this.m_iframeReadyForPostMessage=!0,this.m_iframeLoadTimeout&&(window.clearTimeout(this.m_iframeLoadTimeout),this.m_iframeLoadTimeout=undefined),this.m_retryPreviewerTimeout&&(window.clearTimeout(this.m_retryPreviewerTimeout),this.m_retryPreviewerTimeout=undefined),!this.m_readyToActivateConditional){this.m_logger.ULS.traceTag(51448027,logCategory.PptSession,logLevel.Warning,"PreviewSessionLoader::onMessage - Conditional Action uninitialized");throw Error("m_readyToActivateConditional");}this.m_readyToActivateConditional.SetCondition(this.c_iframeLoaded);break;case 40:f=t.m_logs;f&&this.m_logger.ULS.traceTag(590885717,logCategory.PptSession,logLevel.Info,f);break;case 41:if(this.m_appErrors.length>=this.c_appErrorThrottleCount)break;t.ErrorName?this.m_appErrors.push({DuringBoot:!this.m_bootCompleted,ErrorName:t.ErrorName,Tag:t.Tag}):this.m_logger.ULS.traceTag(588044113,logCategory.PptSession,logLevel.Warning,"PreviewSessionLoader::onMessage::PostAppErrorUpwardsForTelemetry message data is missing required field");break;case 42:if(this.m_bootCompleted)break;t.m_appBootTimingDict&&(Object.assign?(Object.assign(this.m_appBootTimingDict,t.m_appBootTimingDict),this.m_appInitDiagnostics.appBootTimingDict=JSON.stringify(this.m_appBootTimingDict)):this.m_logger.ULS.traceTag(577282078,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::onMessage::AppBootPerfDict Object.assign is not supported"))}}},n.prototype.GenerateSlideShowParams=function(t,i){var r={},o,f,s,h,e,u;if(this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.ExtraUrlParams)for(o=this.m_initParams.ApplicationCustomSettings.ExtraUrlParams.split("&"),f=0;f<o.length;f++)s=o[f].split("="),r[s[0]]=s[1];return this.m_fShouldUseLegacySlideShowAspx?(h=this.m_initParams.ApplicationCustomSettings.WacStaticResourcesServer+this.m_appMetaData.WacCdnVersion,r.staticCdn=encodeURIComponent(h)):this.m_appMetaData.Environment=="wac"&&(r.wacCdnVersion=this.m_appMetaData.WacCdnVersion),t&&(r.pid=encodeURIComponent(t)),r.PowerPointView="ChromelessView",n.FIsUintValid(this.m_startingSlideId)&&this.m_startingSlideId!=0?r.wdSlideId=UrlUtils.urlKeyValueEncode(this.m_startingSlideId.toString()):n.FIsUintValid(this.m_startingSlideIndex)&&(r.wdSlideIndex=UrlUtils.urlKeyValueEncode(this.m_startingSlideIndex.toString())),this.m_initParams.SessionInformation.DataLocale&&(r.rs=this.m_initParams.SessionInformation.DataLocale),this.m_initParams.SessionInformation.UiLocale&&(r.ui=this.m_initParams.SessionInformation.UiLocale),this.m_initParams.SessionInformation.HostSessionId&&(r.hsi=this.m_initParams.SessionInformation.HostSessionId),r.utb=UrlUtils.urlKeyValueEncode((this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.UseTransparentBackground!=undefined?this.m_initParams.ApplicationCustomSettings.UseTransparentBackground:!0).toString()),r.wdEaa=UrlUtils.urlKeyValueEncode((this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.EnableAutoAdvance!=undefined?this.m_initParams.ApplicationCustomSettings.EnableAutoAdvance?1:0:0).toString()),r.eac=UrlUtils.urlKeyValueEncode((this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.EnableAdvanceOnClick!=undefined?this.m_initParams.ApplicationCustomSettings.EnableAdvanceOnClick:!0).toString()),r.vm=UrlUtils.urlKeyValueEncode((this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.ViewerMode?this.m_initParams.ApplicationCustomSettings.ViewerMode:0).toString()),r.co=UrlUtils.urlKeyValueEncode(this.m_initParams.WopiPrecheckInfo.BundleInfo.CrossOrigin?this.m_initParams.WopiPrecheckInfo.BundleInfo.CrossOrigin:"anonymous"),r.lcid=UrlUtils.urlKeyValueEncode((this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.LCID?this.m_initParams.ApplicationCustomSettings.LCID:"1033").toString()),r.hostname=UrlUtils.urlKeyValueEncode(n.GetHostName(this.m_initParams)),r.ua=UrlUtils.urlKeyValueEncode((!0).toString()),r.asb=UrlUtils.urlKeyValueEncode((this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.AddShadowBorder!=undefined?this.m_initParams.ApplicationCustomSettings.AddShadowBorder:!1).toString()),r.apiStartTime=UrlUtils.urlKeyValueEncode(this.m_apiStartTime.toString()),r.preloadApp=UrlUtils.urlKeyValueEncode(i.toString()),this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.TakeFocusOnBoot&&(r.takeFocusOnBoot=UrlUtils.urlKeyValueEncode(UrlUtils.urlKeyValueEncode(this.m_initParams.ApplicationCustomSettings.TakeFocusOnBoot.toString()))),r.isCombineRequest=UrlUtils.urlKeyValueEncode(UrlUtils.urlKeyValueEncode((!0).toString())),this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.NoCacheToken&&(r.noCacheToken=UrlUtils.urlKeyValueEncode(UrlUtils.urlKeyValueEncode(this.m_initParams.ApplicationCustomSettings.NoCacheToken))),this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.EndSlideShowText&&(r.endSlideShowText=UrlUtils.urlKeyValueEncode(this.m_initParams.ApplicationCustomSettings.EndSlideShowText)),this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.HostSupportsSessionRefreshEnabled&&(r.hostSupportsSessionRefreshEnabled=UrlUtils.urlKeyValueEncode(this.m_initParams.ApplicationCustomSettings.HostSupportsSessionRefreshEnabled.toString())),this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.InkingEnabled&&(r.inkingEnabled=UrlUtils.urlKeyValueEncode(this.m_initParams.ApplicationCustomSettings.InkingEnabled.toString())),this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.IsNewSlideShowToolbarEnabled&&(r.isNewSlideShowToolbarEnabled=UrlUtils.urlKeyValueEncode(this.m_initParams.ApplicationCustomSettings.IsNewSlideShowToolbarEnabled.toString())),this.m_appMetaData&&this.m_initParams.ApplicationCustomSettings&&!this.m_initParams.ApplicationCustomSettings.Url&&(r.aVMa=UrlUtils.urlKeyValueEncode(this.m_appMetaData.AppVersionMajor.toString()),r.aVMi=UrlUtils.urlKeyValueEncode(this.m_appMetaData.AppVersionMinor.toString()),r.cVMa=UrlUtils.urlKeyValueEncode(this.m_appMetaData.ContentVersionMajor.toString()),r.cVMi=UrlUtils.urlKeyValueEncode(this.m_appMetaData.ContentVersionMinor.toString()),r.env=UrlUtils.urlKeyValueEncode(this.m_appMetaData.Environment.toString()),r.cdnMA=UrlUtils.urlKeyValueEncode("1"),this.m_appMetaData.Environment!="wac"&&(e=PPTBootstrapSettings.getCDNManifestMapping(),r.cdnRD=UrlUtils.urlKeyValueEncode(e["pptscripts/reader.dione.js"].toString()),r.cdnRC=UrlUtils.urlKeyValueEncode(e["pptscripts/reader.calypso.js"].toString()),r.cdnB=UrlUtils.urlKeyValueEncode(e["pptscripts/babylon.js"].toString()))),this.m_initParams.WopiPrecheckInfo.BundleInfo.Url&&(r.dce=encodeURIComponent(this.m_initParams.WopiPrecheckInfo.BundleInfo.Url)),this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.OnDemandServer&&(r.odvs=this.m_initParams.ApplicationCustomSettings.OnDemandServer),r.odve="podView.svc/jsonAnonymous",this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.PreserveDrawingBuffer&&(r.wgl_pdb=this.m_initParams.ApplicationCustomSettings.PreserveDrawingBuffer.toString()),(window.location.search.indexOf("wdDev=1")>=0||window.location.hash.indexOf("wdDev=1")>=0)&&(r.wdDev="1"),this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.WacCluster&&(r.wacCluster=this.m_initParams.ApplicationCustomSettings.WacCluster),this.isNeedToAddSBOverride()?(u=UrlUtils.getParameterValue(window.location.search,"wdoverrides"),u?u.indexOf("useshapebuilderviewing")<0&&(u=u+",useshapebuilderviewing:true,rendergifslideshow:true,videothrutransparentcanvas:true"):u="useshapebuilderviewing:true,rendergifslideshow:true,videothrutransparentcanvas:true",r.wdoverrides=u):window.location.search.indexOf("wdoverrides=")>=0&&(r.wdoverrides=UrlUtils.getParameterValue(window.location.search,"wdoverrides")),this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.LiveBroadcastEnabled&&(r.LiveBroadcastEnabled=this.m_initParams.ApplicationCustomSettings.LiveBroadcastEnabled.toString()),this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.IsVideoThruTransparentCanvas&&(r.isVideoThruTransparentCanvas=UrlUtils.urlKeyValueEncode(this.m_initParams.ApplicationCustomSettings.IsVideoThruTransparentCanvas.toString())),this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.IsFlipgridVideoEnabled&&(r.isFlipgridVideoEnabled=UrlUtils.urlKeyValueEncode(this.m_initParams.ApplicationCustomSettings.IsFlipgridVideoEnabled.toString())),this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.IsTEDVideoEnabled&&(r.isTEDVideoEnabled=UrlUtils.urlKeyValueEncode(this.m_initParams.ApplicationCustomSettings.IsTEDVideoEnabled.toString())),this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.AreThirdPartyAddInsAllowed&&(r.AreThirdPartyAddInsAllowed=this.m_initParams.ApplicationCustomSettings.AreThirdPartyAddInsAllowed.toString()),this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.AddInsInSupportedIrmDocsIsEnabled&&(r.AddInsInSupportedIrmDocsIsEnabled=this.m_initParams.ApplicationCustomSettings.AddInsInSupportedIrmDocsIsEnabled.toString()),this.m_initParams.SessionInformation&&this.m_initParams.SessionInformation.UserId&&(r.user_id=encodeURIComponent(this.m_initParams.SessionInformation.UserId)),this.m_initParams.SessionInformation&&this.m_initParams.SessionInformation.TenantId&&(r.tid=encodeURIComponent(this.m_initParams.SessionInformation.TenantId)),this.m_initParams.WopiPrecheckInfo&&this.m_initParams.WopiPrecheckInfo.DocUniqueId&&this.m_initParams.WopiPrecheckInfo.DocUniqueId!=""&&(r.docId=encodeURIComponent(this.m_initParams.WopiPrecheckInfo.DocUniqueId),this.m_logger.ULS.traceTag(579187410,logCategory.PptSession,logLevel.Info,"PreviewerSessionLoader::GenerateSlideShowParams docId present in intiailize")),this.m_initParams.WopiPrecheckInfo&&this.m_initParams.WopiPrecheckInfo.FileSize&&this.m_logger.ULS.traceTag(579187409,logCategory.PptSession,logLevel.Info,"PreviewerSessionLoader::GenerateSlideShowParams FileSize: "+this.m_initParams.WopiPrecheckInfo.FileSize),this.m_initParams.ApplicationUrl&&(r.ring=this.m_initParams.PreviewerRolloutRing),r.fh=encodeURIComponent(PodsRegionInfo.getFileHost(this.m_initParams)),this.m_initParams.SessionInformation&&this.m_initParams.SessionInformation.HostName&&(r.uih=encodeURIComponent(PodsRegionInfo.getUiHost(this.m_initParams.SessionInformation.HostName))),this.m_initParams.SessionInformation&&this.m_initParams.SessionInformation.UiHostRing&&(r.uihRing=encodeURIComponent(this.m_initParams.SessionInformation.UiHostRing)),this.m_initParams.SessionInformation&&this.m_initParams.SessionInformation.CallId&&(r.callId=encodeURIComponent(this.m_initParams.SessionInformation.CallId)),this.m_initParams.SessionInformation&&this.m_initParams.SessionInformation.ContentId&&(r.contentId=encodeURIComponent(this.m_initParams.SessionInformation.ContentId)),this.m_initParams.SessionInformation&&this.m_initParams.SessionInformation.IsPresenter&&(r.isPresenter=this.m_initParams.SessionInformation.IsPresenter),r},n.prototype.LoadIframe=function(t,i){if(i===void 0&&(i=undefined),this.m_anchor==null||this.m_iframe==null){this.m_logger.ULS.traceTag(39416213,logCategory.PptSession,logLevel.Error,"PreviewerSessionLoader::LoadIframe is missing parameters");return}this.m_iframe.parentNode||this.m_anchor.appendChild(this.m_iframe);var u=PPTBootstrapSettings.getCDNManifestMapping(),r;r=this.m_initParams&&this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.Url?ViewerUrlUtils.HTMLEncode(this.m_initParams.ApplicationCustomSettings.Url)+"powerpointframe.html":this.m_appMetaData.Environment=="wac"?this.m_initParams.ApplicationCustomSettings.WacStaticResourcesServer+this.m_appMetaData.WacCdnVersion+"_slideshowresources/powerpointframe.html":ViewerUrlUtils.HTMLEncode("https://contentstorage.osi.office.net/pages/"+u["pptpages/powerpointframe.html"].toString()+"#powerpointframe.html");(this.m_initParams.WopiPrecheckInfo.BundleInfo.Url&&this.m_initParams.WopiPrecheckInfo.BundleInfo.Url.substr(0,5)=="http:"||this.m_initParams.ApplicationCustomSettings.Url&&this.m_initParams.ApplicationCustomSettings.Url.substr(0,4)!="http"&&window.location.protocol=="http:"||this.m_initParams.ApplicationCustomSettings.OnDemandServer&&this.m_initParams.ApplicationCustomSettings.OnDemandServer.substr(0,5)=="http:"||this.m_initParams.ApplicationCustomSettings.ForceHttp)&&r.substr(0,5)=="https"&&(r=n.RelativeUrlToAbsolute(r),r="http"+r.substr(5));t&&Object.keys(t).forEach(function(n){r=UrlUtils.addOrReplaceParameterValue(r,n,t[n])});r=r.replace("?","#");this.m_iframe&&(this.m_logger.ULS.traceTag(590424141,logCategory.PptSession,logLevel.Info,"Iframe src: "+r),i&&i(r),this.m_iframe.src=r)},n.prototype.isNeedToAddSBOverride=function(){if(!PPTPreviewerBootstrapperUtils.IsTeamsPreviewerSession(this.m_initParams,!1)||this.m_initParams&&this.m_initParams.SessionInformation&&this.m_initParams.SessionInformation.HostName&&this.m_initParams.SessionInformation.HostName.toLowerCase().indexOf("ios")>=0)return!1;var n=this.m_initParams.ApplicationUrl;return n?this.m_initParams.PreviewerRolloutRing!="6":!1},n.prototype.LoadApp=function(t,i,r){var e=this,f,u;r.previewSessionLoadAppTime=Date.now();this.m_logger.ULS.traceTag(38540372,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::LoadApp");r.prefetchStartTime&&(this.m_bootTimingDict.PrefetchStart=r.prefetchStartTime);this.m_initParams!=null&&this.m_initParams.SessionInformation!=null&&this.m_initParams.SessionInformation.WdParams!=null&&this.m_initParams.SessionInformation.WdParams.wdLegacyAspxInTeams!=null&&(this.m_bootTimingDict.wdLegacyAspxInTeams=this.m_initParams.SessionInformation.WdParams.wdLegacyAspxInTeams?1:0);this.m_initParams!=null&&this.m_initParams.SessionInformation!=null&&this.m_initParams.SessionInformation.WdParams!=null&&this.m_initParams.SessionInformation.WdParams.wdModernSlideShowInTeams!=null&&(this.m_bootTimingDict.wdModernSlideShowInTeams=this.m_initParams.SessionInformation.WdParams.wdModernSlideShowInTeams?1:0);this.m_initParams!=null&&this.m_initParams.SessionInformation!=null&&this.m_initParams.SessionInformation.HostExperience!=null&&(this.m_bootTimingDict.HostExperience=this.m_initParams.SessionInformation.HostExperience);this.m_initParams!=null&&this.m_initParams.SessionInformation!=null&&this.m_initParams.SessionInformation.UiHostRing!=null&&(this.m_bootTimingDict.UiHostRing=this.m_initParams.SessionInformation.UiHostRing);this.m_initParams!=null&&this.m_initParams.SessionInformation!=null&&this.m_initParams.SessionInformation.IsPresenter!=null&&(this.m_bootTimingDict.IsPresenter=this.m_initParams.SessionInformation.IsPresenter);this.m_initParams!=null&&this.m_initParams.SessionInformation!=null&&this.m_initParams.SessionInformation.Position!=null&&(this.m_bootTimingDict.PreviewerPosition=this.m_initParams.SessionInformation.Position);this.m_bootTimingDict.LoadApp=Date.now();this.m_readyToActivateConditional=new ConditionalAction(function(){return e.Activate()},[this.c_iframeLoaded,this.c_contentMetadataLoadedOrDoesNotExist]);this.m_iframe&&this.m_iframe.id&&this.m_logger.ULS.traceTag(590424140,logCategory.PptSession,logLevel.Info,"iframe about to be replaced with new iframe: Old iframe Id: "+this.m_iframe.id+"  , New iframe Id: "+this.m_initParams.SessionInformation.HostSessionId);this.m_iframe=n.CreateBaseIframe(this.m_initParams.SessionInformation.HostSessionId);this.m_logger.ULS.traceTag(39203533,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::LoadApp creating new iframe - "+this.m_iframe.id.toString());f=this.m_initParams&&this.m_initParams.ApplicationCustomSettings&&this.m_fShouldUseLegacySlideShowAspx&&this.m_appMetaData&&this.m_appMetaData.Environment=="wac"&&this.m_initParams.ApplicationCustomSettings.WacStaticResourcesServer!=null;u=this.GenerateSlideShowParams(t,i);this.m_slideshowKind=="Modern"?this.m_slideShowLoader.LoadSlideShow(this.m_iframe,u,this.m_slideshowKind,r):f?this.m_slideShowLoader.LoadSlideShow(this.m_iframe,u,"Legacy",r):(this.registerOnLoadErrorEvent(),this.LoadIframe(u));this.registerOnLoadEvent();this.registerOnUnloadEvent();this.m_bootTimingDict.iframeURLset=Date.now()},n.prototype.LaunchFromSlide=function(n){var r=this,t,i;if(!this.m_iframe){this.m_logger.ULS.traceTag(39416214,logCategory.PptSession,logLevel.Error,"PreviewSessionLoader::LaunchFromSlide iframe is null");return}if(this.m_logger.ULS.traceTag(39416215,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::LaunchFromSlide"),this.m_initParams.ApplicationCustomSettings&&n.WacCluster&&(this.m_initParams.ApplicationCustomSettings.WacCluster=n.WacCluster),this.m_initParams.Diagnostics=n.Diagnostics,this.m_presentationId=n.PresentationId,this.m_apiStartTime=Date.now(),this.m_bootTimingDict.ApiStartTime=this.m_apiStartTime,this.m_streamUseThinEmbed=n.StreamVideoUseThinEmbed,n.SendInitialLog&&PPTBootstrapper.sendInitialLog(this.m_initParams,"Slide Show",null,this.m_logger),t=this.m_presentationId,this.m_startingSlideId=n.StartingSlideId||-1,this.m_startingSlideIndex=n.StartingSlideIndex||-1,this.m_vetoAppSettingsStr=n.VetoAppSettingsStr||"",this.m_disabledTransitionsList=n.DisabledTransitionsList||"",this.m_customTransitionResourceUrl=n.CustomTransitionResourceUrl||"",this.m_disabledChangeGates=n.DisabledChangeGates||"",this.m_initParams.ApplicationCustomSettings!=null&&n.AddInsInSupportedIrmDocsIsEnabled!=null&&(this.m_initParams.ApplicationCustomSettings.AddInsInSupportedIrmDocsIsEnabled=n.AddInsInSupportedIrmDocsIsEnabled),this.m_initParams.ApplicationCustomSettings!=null&&n.AreThirdPartyAddInsAllowed!=null&&(this.m_initParams.ApplicationCustomSettings.AreThirdPartyAddInsAllowed=n.AreThirdPartyAddInsAllowed),i=HTMLHelper.floatToPercent(1),this.m_anchor.style.width=this.m_fVariableWidth?i:HTMLHelper.toPx(this.m_initParams.ApplicationCustomSettings.Width),this.m_anchor.style.height=this.m_fVariableHeight?i:HTMLHelper.toPx(this.m_initParams.ApplicationCustomSettings.Height),this.m_fVariableHeight&&(this.m_anchor.style.minHeight=HTMLHelper.toPx(this.c_minHeight)),this.m_anchor.style.left=HTMLHelper.toPx(0),this.m_anchor.style.right=HTMLHelper.toPx(0),this.m_anchor.style.bottom=HTMLHelper.toPx(0),this.m_anchor.style.top=HTMLHelper.toPx(0),this.m_fVariableHeight?this.m_iframe.style.minHeight=HTMLHelper.toPx(this.c_minIframeHeight):this.m_iframe.style.height=HTMLHelper.toPx(Math.max(this.m_initParams.ApplicationCustomSettings.Height,0)),(this.m_fShouldUseLegacySlideShowAspx||this.m_slideshowKind=="Modern")&&this.m_slideShowLoader.LaunchSlideShow(),this.m_finishedBootingConditional=new ConditionalAction(function(){return r.SendBootTelemetry()},[this.c_activated]),this.m_initParams.WopiPrecheckInfo.BundleInfo.Url)this.GetPreviewImage(t),this.GetContentMetadata();else{if(this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.EnablePodPreviewStaticImage&&this.m_startingSlideIndex>=1&&this.GetPreviewImageFromPods(t,this.m_startingSlideIndex),!this.m_readyToActivateConditional){this.m_logger.ULS.traceTag(51448028,logCategory.PptSession,logLevel.Warning,"PreviewSessionLoader::OnMesssage - Conditional Action uninitialized");throw Error("m_readyToActivateConditional");}this.m_readyToActivateConditional.SetCondition(this.c_contentMetadataLoadedOrDoesNotExist)}this.sessionCanRetryPreviewerCreation()&&(this.m_retryPreviewerTimeout=window.setTimeout(function(){return r.retryPreviewer()},13e3))},n.prototype.sessionCanRetryPreviewerCreation=function(){if(this.m_initParams.SessionInformation&&this.m_initParams.SessionInformation.WdParams&&this.m_initParams.SessionInformation.WdParams.retryPptIFrameLoad!=undefined)return!!this.m_initParams.SessionInformation.WdParams.retryPptIFrameLoad;var n=this.m_initParams.SessionInformation.UiHostRing;return n&&(PodsRegionInfo.TeamsRingsInEdog.indexOf(n.toLowerCase())>=0||n.toLowerCase()=="ring2")?!0:!1},n.prototype.retryPreviewer=function(){try{this.retryPreviewerIFrameCreation()}catch(n){this.m_logger.ULS.traceTag(589088848,logCategory.PptSession,logLevel.Warning,"PreviewerSessionLoader::RetryPreviewer - retry failed. Exception: "+n)}},n.prototype.retryPreviewerIFrameCreation=function(){var i=this,r=function(n){var t=new XMLHttpRequest;t.addEventListener("load",function(n){i.m_logger.ULS.traceTag(588317710,logCategory.PptSession,logLevel.Warning,"Call to load iframe Complted. Status:  "+n.target.status+" , Status Text: "+n.target.statusText)});t.addEventListener("error",function(n){i.m_logger.ULS.traceTag(588317709,logCategory.PptSession,logLevel.Warning,"Retried fetching iframe src but request failed with with: "+n.target.status+" , Status Text: "+n.target.statusText)});t.addEventListener("abort",function(){i.m_logger.ULS.traceTag(588317708,logCategory.PptSession,logLevel.Warning,"Call to load iframe Aborted.")});t.open("GET",n);t.timeout=1e4;t.send()},u,t;this.m_iframeReadyForPostMessage!==!0?(this.m_logger.ULS.traceTag(589088847,logCategory.PptSession,logLevel.Warning,"PreviewerSessionLoader::retryPreviewerIFrameCreation - retrying iframe creation"),this.m_bootTimingDict.IframeRetryStart=Date.now(),this.m_iframe==null?this.m_logger.ULS.traceTag(589088846,logCategory.PptSession,logLevel.Warning,"PreviewerSessionLoader::retryPreviewerIFrameCreation - iframe not created"):this.m_iframe.parentNode.removeChild(this.m_iframe),this.m_iframe=n.CreateBaseIframe(this.m_initParams.SessionInformation.HostSessionId),u=this.m_initParams&&this.m_initParams.ApplicationCustomSettings&&this.m_fShouldUseLegacySlideShowAspx&&this.m_appMetaData&&this.m_appMetaData.Environment=="wac"&&this.m_initParams.ApplicationCustomSettings.WacStaticResourcesServer!=null,t=this.GenerateSlideShowParams(this.m_presentationId,!1),this.m_slideshowKind=="Modern"?this.m_slideShowLoader.LoadSlideShow(this.m_iframe,t,this.m_slideshowKind,{},r):u?this.m_slideShowLoader.LoadSlideShow(this.m_iframe,t,"Legacy",{},r):(this.registerOnLoadErrorEvent(),this.LoadIframe(t,r)),this.registerOnLoadEvent(),this.registerOnUnloadEvent(),(this.m_fShouldUseLegacySlideShowAspx||this.m_slideshowKind=="Modern")&&this.m_slideShowLoader.LaunchSlideShow()):this.m_logger.ULS.traceTag(589088845,logCategory.PptSession,logLevel.Warning,"PreviewerSessionLoader::retryPreviewerIFrameCreation - retry timeout hit but iframe is ready for postmessage.")},n.prototype.SendBootTelemetry=function(){this.m_logger.ULS.traceTag(38540373,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::SendBootTelemetry");var n=new BootTimingFromApiInternalMessage(this.m_bootTimingDict);this.PostMessageDownward(n)},n.prototype.RecordStartedSlideShowTimestamp=function(n){this.m_logger.ULS.traceTag(39683465,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::RecordStartedSlideShowTimestamp Time that SlideShow started in ms: "+n);var t=new RecordStartedSlideShowTimestampInternalMessage(n);this.PostMessageDownward(t)},n.prototype.GetDataCdnEndpoint=function(){var t,n,i,r;return this.m_initParams.ApplicationCustomSettings&&this.m_initParams.WopiPrecheckInfo.BundleInfo.Url.substr(0,1)=="/"?(n=document.createElement("a"),n.href=this.m_initParams.ApplicationCustomSettings.Url,i=n.protocol,r=n.host,t=i+"//"+r+this.m_initParams.WopiPrecheckInfo.BundleInfo.Url):t=this.m_initParams.WopiPrecheckInfo.BundleInfo.Url,t},n.prototype.GetPreviewImage=function(n){var i,t;this.m_logger.ULS.traceTag(39203536,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::GetPreviewImage");i=this.m_initParams.WopiPrecheckInfo.BundleInfo.Url.indexOf("{1}")==-1?this.m_initParams.WopiPrecheckInfo.BundleInfo.Url.replace(new RegExp("\\{0\\}","gim"),"f.jpg"):this.m_initParams.WopiPrecheckInfo.BundleInfo.Url.replace(new RegExp("\\{0\\}","gim"),n).replace(new RegExp("\\{1\\}","gim"),"0").replace(new RegExp("\\{2\\}","gim"),"fullSizePreview.jpg");t=document.createElement("img");t.style.visibility="hidden";t.style.position="absolute";t.src=i},n.prototype.GetPreviewImageFromPods=function(n,t){var u,i,f,r;this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.OnDemandServer&&(this.m_logger.ULS.traceTag(39203537,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::GetPreviewImageFromPods"),u=void 0,u=this.m_initParams.ApplicationCustomSettings.OnDemandServer,i="fullSizePreview.png",t>1&&(i=t-1+"_"+i),f=void 0,f=u+"imagehandler.ashx?PV=6&PF=4&Rid="+i+"&Pid="+n+"&X-SupportSVGInWebGL="+(ViewerBrowserUtils.SupportSVGInWebGL()?"1":"0"),r=document.createElement("img"),r.style.visibility="hidden",r.style.position="absolute",r.src=f)},n.prototype.GetContentMetadata=function(){var i=this,t,n;this.m_logger.ULS.traceTag(39203538,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::GetContentMetadata");this.m_bootTimingDict.BeginLoadContentMetadata=Date.now();t=this.GetDataCdnEndpoint();n=new XhrRequest;n.Url=t.replace(new RegExp("\\{0\\}","gim"),"c.js");n.OnCompletedCallback=function(n){return i.OnCompletedMetadata(n)};n.State="c.js";n.Timeout=1e4;XhrHelper.GetJson(n)},n.prototype.OnCompletedMetadata=function(n){if(this.m_bootTimingDict.FinishedLoadContentMetadata=Date.now(),n.FSuccess){if(this.m_contentMetadata=n.Data||null,!this.m_readyToActivateConditional){this.m_logger.ULS.traceTag(51448029,logCategory.PptSession,logLevel.Warning,"PreviewSessionLoader::OnMesssage - Conditional Action uninitialized");throw Error("m_readyToActivateConditional");}this.m_readyToActivateConditional.SetCondition(this.c_contentMetadataLoadedOrDoesNotExist);var t={};t.ContentLength=n.ContentLength;t.ResourceStringLength=n.ResourceStringLength;t.RetriesUsed=n.RetriesUsed;t.ServerCorrelation=n.serverCorrelation;this.m_logger.ULS.traceTag(38286561,logCategory.PptSession,logLevel.Info,JSON.stringify(t))}else{if(this.m_logger.ULS.traceTag(38286562,logCategory.PptSession,logLevel.Info,"ErrorDesription: Failed to load content metadata in api layer, HttpStatusCode: "+n.HttpStatusCode+", ID: "+n.State),this.m_contentMetadata=null,this.m_contentMetadataHttpStatusCode=n.HttpStatusCode.toString(),!this.m_readyToActivateConditional){this.m_logger.ULS.traceTag(51448030,logCategory.PptSession,logLevel.Warning,"PreviewSessionLoader::OnMesssage - Conditional Action uninitialized");throw Error("m_readyToActivateConditional");}this.m_readyToActivateConditional.SetCondition(this.c_contentMetadataLoadedOrDoesNotExist)}},n.GetHostName=function(n){return n.SessionInformation.HostName?n.SessionInformation.HostName:window.location.hostname},n.RelativeUrlToAbsolute=function(t){var i=document.createElement("div"),r;return i.innerHTML='<a href="'+n.EscapeHtml(t)+'">x<\/a>',r=i.firstChild,r.href},n.EscapeHtml=function(n){return n.split("&").join("&amp;").split("<").join("&lt;").split('"').join("&quot;")},n.prototype.Dispose=function(){this.m_logger.ULS.traceTag(39203539,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::Dispose - removeAnchor: "+(this.m_anchor!=null).toString()+", removeAPI: "+(this.m_apiId!=null).toString());this.m_anchor&&this.m_anchor.parentNode&&this.m_anchor.parentNode.removeChild(this.m_anchor);this.m_apiId&&PPTMessageListenerRegistry.getInstance().remove(this.m_apiId,!0,"Dispose from PreviewSessionLoader");this.DisposeForTransferToPreviewAPI()},n.prototype.DisposeForTransferToPreviewAPI=function(){this.m_anchor=null;this.m_iframe=null;this.m_apiId=null},n.prototype.DisposePreloadedApp=function(){this.m_logger.ULS.traceTag(39416216,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::DisposePreloadedApp");this.m_iframe&&this.m_iframe.parentNode&&this.m_iframe.parentNode.removeChild(this.m_iframe);this.m_apiId&&PPTMessageListenerRegistry.getInstance().remove(this.m_apiId,!0,"Dispose PreloadApp");this.DisposeForTransferToPreviewAPI()},n.prototype.RecordBootStrapperInitTime=function(n){this.m_bootTimingDict.BootstrapperInitTime=n},n}(),SHA1=function(){function n(){}return n.RotateLeft=function(n,t){return n<<t|n>>32-t},n.ConvertHex=function(n){for(var i=[],r,t=7;t>=0;t--)r=n>>t*4&15,i.push(r.toString(16));return i.join("")},n.Utf8Encode=function(n){var i,r,t;for(n=n.replace("\r\n","\n"),i="",r=0;r<n.length;r++)t=n.charCodeAt(r),t<128?i+=String.fromCharCode(t):t>127&&t<2048?(i+=String.fromCharCode(t>>6|192),i+=String.fromCharCode(t&63|128)):(i+=String.fromCharCode(t>>12|224),i+=String.fromCharCode(t>>6&63|128),i+=String.fromCharCode(t&63|128));return i},n.GenerateSHA1=function(t){var i,k,a,v=1732584193,y=4023233417,p=2562383102,w=271733878,b=3285377520,e,r,u,f,h,o=0,c=new Array(80),s,l,d;for(t=n.Utf8Encode(t),s=t.length,l=[],i=0;i<s-3;i+=4)k=t.charCodeAt(i)<<24|t.charCodeAt(i+1)<<16|t.charCodeAt(i+2)<<8|t.charCodeAt(i+3),l.push(k);switch(s%4){case 0:o=2147483648;break;case 1:o=t.charCodeAt(s-1)<<24|8388608;break;case 2:o=t.charCodeAt(s-2)<<24|t.charCodeAt(s-1)<<16|32768;break;case 3:o=t.charCodeAt(s-3)<<24|t.charCodeAt(s-2)<<16|t.charCodeAt(s-1)<<8|128}for(l.push(o);l.length%16!=14;)l.push(0);for(l.push(s>>29),l.push(s<<3&4294967295),a=0;a<l.length;a+=16){for(i=0;i<16;i++)c[i]=l[a+i];for(i=16;i<=79;i++)c[i]=n.RotateLeft(c[i-3]^c[i-8]^c[i-14]^c[i-16],1);for(e=v,r=y,u=p,f=w,h=b,i=0;i<=19;i++)o=n.RotateLeft(e,5)+(r&u|~r&f)+h+c[i]+1518500249&4294967295,h=f,f=u,u=n.RotateLeft(r,30),r=e,e=o;for(i=20;i<=39;i++)o=n.RotateLeft(e,5)+(r^u^f)+h+c[i]+1859775393&4294967295,h=f,f=u,u=n.RotateLeft(r,30),r=e,e=o;for(i=40;i<=59;i++)o=n.RotateLeft(e,5)+(r&u|r&f|u&f)+h+c[i]+2400959708&4294967295,h=f,f=u,u=n.RotateLeft(r,30),r=e,e=o;for(i=60;i<=79;i++)o=n.RotateLeft(e,5)+(r^u^f)+h+c[i]+3395469782&4294967295,h=f,f=u,u=n.RotateLeft(r,30),r=e,e=o;v=v+e&4294967295;y=y+r&4294967295;p=p+u&4294967295;w=w+f&4294967295;b=b+h&4294967295}return d=n.ConvertHex(v)+n.ConvertHex(y)+n.ConvertHex(p)+n.ConvertHex(w)+n.ConvertHex(b),d.toLowerCase()},n}(),SlideShowLoader=function(){function n(n,t,i){this.m_iframe=null;this.m_frameForm=null;this.m_appMetadata=i;this.m_logger=t;this.m_initParams=n;this.m_anchor=n.Container;this.m_pptFeatureGates=PPTBootstrapperFeatureGatesHelper.getFeatureGates(this.m_initParams,this.m_logger)}return n.prototype.LoadSlideShow=function(t,i,r,u,f){var v=this,y,h,c,e,o,p,w,b,s,k,l;if(f===void 0&&(f=undefined),y=Date.now(),this.m_iframe=t,this.m_anchor==null||this.m_iframe==null){this.m_logger.ULS.traceTag(592732160,logCategory.PptSession,logLevel.Error,"PreviewerSessionLoader::LoadModernSlideShowFrame is missing parameters");return}if(h=r=="Legacy"?this.m_initParams.ApplicationCustomSettings.OnDemandServer+"legacySlideshow.aspx":this.m_initParams.ApplicationCustomSettings.OnDemandServer+"slideshow.aspx",c="slideshowframe-"+this.m_iframe.id.toString(),this.m_iframe.name=c,this.m_frameForm=document.createElement("form"),this.m_frameForm.name="frameform-"+this.m_iframe.id.toString(),this.m_frameForm.id="frameform-"+this.m_iframe.id.toString(),this.m_frameForm.target=c,this.m_frameForm.action=h,this.m_frameForm.method="post",this.m_iframe.parentNode||this.m_anchor.appendChild(this.m_iframe),e={},this.m_initParams.WopiPrecheckInfo.FileGetUrl&&(e.fileurl=this.m_initParams.WopiPrecheckInfo.FileGetUrl),this.m_initParams.WopiPrecheckInfo.FileName&&(e.fileName=UrlUtils.urlKeyValueEncode(this.m_initParams.WopiPrecheckInfo.FileName)),o=this.GetPodsUrl(this.m_initParams),o!=null&&o!==""&&(e.podsurl=o),!this.m_initParams.SessionInformation.HostSessionId)throw"SessionInformation.HostSessionId is not provided";if(e.hostsessionid=this.m_initParams.SessionInformation.HostSessionId,e["X-UserSessionId"]=this.m_initParams.SessionInformation.HostSessionId,e.ApiId=this.m_initParams.SessionInformation.HostSessionId,this.m_initParams.ApplicationCustomSettings.StartingSlideIndex!=null&&(e.startingslideindex=this.m_initParams.ApplicationCustomSettings.StartingSlideIndex.toString()),this.m_initParams.ApplicationCustomSettings.StartingTimelineMappings!=null&&(e.startingtimelinemappings=JSON.stringify(this.m_initParams.ApplicationCustomSettings.StartingTimelineMappings)),this.m_initParams.SessionInformation.HostName!=null&&(e.hostname=this.m_initParams.SessionInformation.HostName),this.m_initParams.SessionInformation.UiHostIsHighContrast!=null&&(e.isHighContrast=this.m_initParams.SessionInformation.UiHostIsHighContrast),this.m_initParams.SessionInformation.UiHostHighContrastColorSettings!=null&&(e.highContrastColorSettings=this.m_initParams.SessionInformation.UiHostHighContrastColorSettings),this.m_initParams.SessionInformation.HostExperience!=null&&(e.hostExperience=this.m_initParams.SessionInformation.HostExperience),this.m_initParams.SessionInformation.IsRtl!=null&&(e.isRtl=this.m_initParams.SessionInformation.IsRtl),e.SupportsDecryptedContentDownload=!0,this.m_initParams.SessionInformation.DocumentClickTime!=null)try{e.startFromTime=this.m_initParams.SessionInformation.DocumentClickTime.getTime()}catch(nt){this.m_logger.ULS.traceTag(590221380,logCategory.PptSession,logLevel.Error,"PreviewerSessionLoader::LoadSlideShow exception thrown: "+nt)}this.m_pptFeatureGates!=null&&(p=this.m_pptFeatureGates.EnableSnapUrlForPresenterInLegacy||!1,e.enableSnapUrlForPresenterInLegacy=p,w=this.m_pptFeatureGates.PresenterViewForLegacyEnabled||!1,e.presenterViewForLegacyEnabled=w,b=this.m_pptFeatureGates.PresenterViewDarkTrafficEnabled||!1,e.presenterViewDarkTrafficEnabled=b);this.m_initParams.SessionInformation&&this.m_initParams.SessionInformation.WdParams&&(this.m_initParams.SessionInformation.WdParams.wdModernSlideShowInTeams&&(e.wdModernSlideShowInTeams=this.m_initParams.SessionInformation.WdParams.wdModernSlideShowInTeams),this.m_initParams.SessionInformation.WdParams.wdPresenterViewInTeams&&(e.wdPresenterViewInTeams=this.m_initParams.SessionInformation.WdParams.wdPresenterViewInTeams),s=window.location.search.indexOf("disableTeamsPptSharingNavControlsForPresenter")>=0,s?e.enableSSToolbarNavControlsForPresenter=s:this.m_initParams.SessionInformation.WdParams.disableTeamsPptSharingNavControlsForPresenter&&(e.enableSSToolbarNavControlsForPresenter=this.m_initParams.SessionInformation.WdParams.disableTeamsPptSharingNavControlsForPresenter),k=window.location.search.indexOf("disableTeamsPptSharingNavControlsForAttendee")>=0,s?e.enableSSToolbarNavControlsForAttendee=k:this.m_initParams.SessionInformation.WdParams.disableTeamsPptSharingNavControlsForAttendee&&(e.enableSSToolbarNavControlsForAttendee=this.m_initParams.SessionInformation.WdParams.disableTeamsPptSharingNavControlsForAttendee),l=window.location.search.indexOf("disableTeamsPptSharingPrivateViewingControlForPresenter")>=0,l?e.enableSSToolbarTogglePrivateViewingControl=l:this.m_initParams.SessionInformation.WdParams.disableTeamsPptSharingPrivateViewingControlForPresenter&&(e.enableSSToolbarTogglePrivateViewingControl=this.m_initParams.SessionInformation.WdParams.disableTeamsPptSharingPrivateViewingControlForPresenter),this.m_initParams.SessionInformation.WdParams.wdBrowserShapeBuilderCompatible&&(e.wdBrowserShapeBuilderCompatible=this.m_initParams.SessionInformation.WdParams.wdBrowserShapeBuilderCompatible),this.m_initParams.SessionInformation.WdParams.wdIsFileTypeSupportedForModernSlideShow&&(e.wdIsFileTypeSupportedForModernSlideShow=this.m_initParams.SessionInformation.WdParams.wdIsFileTypeSupportedForModernSlideShow),this.m_initParams.SessionInformation.WdParams.wdset&&(e.wdset=this.m_initParams.SessionInformation.WdParams.wdset));u!=null&&(u.initWopiTime!=null&&(e.initWopiTime=u.initWopiTime.toFixed(),e.startFromTime||(e.startFromTime=u.initWopiTime.toFixed(),this.m_logger.ULS.traceTag(587830343,logCategory.PptSession,logLevel.Error,"PreviewerSessionLoader::LoadSlideShow startFromTime was not present, so will use initWopiTime instead"))),u.bootstrapperInitTime!=null&&(e.bootstrapperInitTime=u.bootstrapperInitTime.toFixed()),u.sliceLoadTime!=null&&(e.sliceLoadTime=u.sliceLoadTime.toFixed()),u.createViewerTime!=null&&(e.createViewerTime=u.createViewerTime.toFixed()),u.previewSessionLoadAppTime!=null&&(e.previewSessionLoadAppTime=u.previewSessionLoadAppTime.toFixed()));e.loadSlideShowTime=y.toFixed();e.wdForcePresenterViewInTeams=window.location.search.indexOf("wdForcePresenterViewInTeams")>=0;e.wdEnablePresenterViewInkInTeams=window.location.search.indexOf("wdEnablePresenterViewInkInTeams")>=0;this.m_initParams.WopiPrecheckInfo.FileSize&&(e.fileSize=this.m_initParams.WopiPrecheckInfo.FileSize,e.fileLengthHint=this.m_initParams.WopiPrecheckInfo.FileSize);this.m_initParams.WopiPrecheckInfo.DocUniqueId&&(e.DocID=this.m_initParams.WopiPrecheckInfo.DocUniqueId);this.m_initParams.WopiPrecheckInfo.ETag&&(e.ETag=this.m_initParams.WopiPrecheckInfo.ETag);this.m_initParams.SnapRequestID&&(e.snapRequestID=this.m_initParams.SnapRequestID);e.authHeaderForHostDownloadEnabled=window.location.search.indexOf("wdAuthHeaderForHostDownloadEnabled")>=0;var a=BrowserUtils.devicePixelRatio(),d=this.m_initParams.ApplicationCustomSettings.AddShadowBorder?10:0,g=this.m_initParams.Container.getBoundingClientRect();e.availableWidth=Math.round(a*Math.max(Math.ceil(g.width),300)-2*d);e.availableHeight=Math.round(a*Math.max(Math.ceil(g.height),201)-2*d);e.dpr=a;e.SupportSVGInWebGL=ViewerBrowserUtils.SupportSVGInWebGL();i&&Object.keys(i).forEach(function(n){e[n.toLowerCase()]=i[n]});Object.keys(e).forEach(function(t){v.m_frameForm!=null&&v.m_frameForm.appendChild(n.CreateHiddenInputElement(t,e[t]))});f&&f(h);this.m_anchor.appendChild(this.m_frameForm)},n.prototype.LaunchSlideShow=function(){this.m_frameForm!=null&&this.m_frameForm.submit()},n.CreateHiddenInputElement=function(n,t){var i=document.createElement("input");return i.type="hidden",i.name=n,i.value=t,i},n.prototype.GetPodsUrl=function(n){var t=UrlUtils.getQueryStringParam("wdPodsUrl");return t&&!this.validateUrlHostMatchesWindowHost(t)&&(t=""),t||(t=PPTBootstrapper.getOnDemandServer(n,!0)),t.substr(t.length-1)!="/"&&(t+="/"),t},n.prototype.validateUrlHostMatchesWindowHost=function(n){var t=document.createElement("a"),i,r;return t.href=n,i=t.port||80,r=window.location.port||80,t.hostname==window.location.hostname&&i==r},n}(),StateServiceLoggerWrapper=function(){function n(n){this.logger=n}return n.prototype.sendTraceTag=function(n,t,i){this.logger.ULS.traceTag(n,logCategory.PptSession,t,i)},n}(),StateServiceClientLoader=function(){function n(){}return n.TryLoadStateServiceClient=function(n,t,i,r,u,f){try{var o=PPTBootstrapSettings.getAppMetadata(),s=PPTBootstrapper.getWacStaticResourcesServer(n,t,i,r),h=s+o.WacCdnVersion+"_pptscripts/stateservicepreviewerclient.js",e=document.createElement("script");return e.onload=function(){var t=new StateServicePreviewerClient.StateServiceClient,i=window.location.search.indexOf("wdTestPreviewer=1")>=0||window.location.hash.indexOf("wdTestPreviewer=1")>=0||window.location.search.indexOf("wdTestWacPreviewer=1")>=0,n;i&&(n=new URLSearchParams(window.location.search),n.has("wdIsPresenter")&&(r.SessionInformation.IsPresenter=n.get("wdIsPresenter")==="1"),n.has("wdCallId")&&(r.SessionInformation.CallId=n.get("wdCallId")||"testdevcall"));r.SessionInformation.CallId||u.ULS.traceTag(573154444,logCategory.PptSession,logLevel.Error,"StateServiceClientLoader: Not initializing StateServiceClient since CallId is null.");t&&t.init({batchedRequestsEnabled:!1,maxRoundtripRaw:300,pingTimeoutInMs:15e3,pongTimeoutInMs:15e3,retryIntervalsInMs:[1e3,2e3,4e3],verbose:!1,websocketAliveTimeAfterLoseFocusInMS:3e4,maxSessionRetries:5,autoRoutingEnabled:!0},i,new StateServiceLoggerWrapper(u),r.SessionInformation.HostSessionId,r.SessionInformation.IsPresenter||!1,r.SessionInformation.CallId,f||[])},e.src=h,document.head.insertBefore(e,document.head.firstChild),!0}catch(c){return u.ULS.traceTag(573154445,logCategory.PptSession,logLevel.Error,"StateServiceClientLoader: Caught exception "+c+"."),!1}},n}(),PPTPreviewerBootstrapperFeatureGatesHelper=function(){function n(){}return n.CombineDisabledChangeGates=function(n,t){var i="";return n&&n.DisabledChangeGates&&(i+=n.DisabledChangeGates+";"),t&&t.PPTDisabledChangeGates&&(i+=t.PPTDisabledChangeGates),i},n}(),ViewerBrowserUtils=function(){function n(){}return n.SupportPreloadLink=function(){return this.GetChromeVersion()>=50},n.IsBrowserSupportedForModernSlideShow=function(t,i,r){var e,o,f,s,h,u,c;try{if(e=window.navigator.userAgent.toLowerCase(),e==null)return t.ULS.traceTag(572903879,logCategory.PptSession,logLevel.Error,"IsBrowserSupportedForModernSlideShow: userAgent is null, defaulting to false"),!1;if(e.indexOf("trident/")>=0||e.indexOf("msie/")>=0)return t.ULS.traceTag(572903880,logCategory.PptSession,logLevel.Info,"IsBrowserSupportedForModernSlideShow IE"),!1;if(o=!1,f=n.getBrowserInfo(),r){s=r.split(";");for(h in s)if(s[h].split(":")[0].toLowerCase()==f.name.toLowerCase()&&parseInt(f.version,10)<parseInt(s[h].split(":")[1],10)){o=!0;break}}else t.ULS.traceTag(572903881,logCategory.PptSession,logLevel.Info,"pptFeatureGates.modernSlideShowBlockListForBrowserVersion undefined or null");return u="Unknown OS",navigator.userAgent.indexOf("Win")!=-1&&(u="Windows"),navigator.userAgent.indexOf("Mac")!=-1&&(u="Macintosh"),navigator.userAgent.indexOf("Linux")!=-1&&(u="Linux"),navigator.userAgent.indexOf("Android")!=-1&&(u="Android"),navigator.userAgent.indexOf("like Mac")!=-1&&(u="iOS"),c=i?i.indexOf(u)>=0:!1,t.ULS.traceTag(572875788,logCategory.PptSession,logLevel.Info,"IsBrowserSupportedForModernSlideShow Name "+f.name+", Version "+f.version+", OSName "+u+", BlockedBrowser "+o+", BlockedOS "+c),!c&&!o}catch(l){return t.ULS.traceTag(572903884,logCategory.PptSession,logLevel.Error,"Unexpected exception in ModernSlideShowEnabledHelper: "+l),!1}},n.getBrowserInfo=function(){var i=navigator.userAgent,t,n=i.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(n[1])?(t=/\brv[ :]+(\d+)/g.exec(i)||[],{name:"IE",version:t[1]||""}):n[1]==="Chrome"&&(t=i.match(/\b(OPR|Edge)\/(\d+)/),t!=null)?{name:t[1].replace("OPR","Opera"),version:t[2]}:(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],(t=i.match(/version\/(\d+)/i))!=null&&n.splice(1,1,t[1]),{name:n[0],version:n[1]})},n.GetChromeVersion=function(){var n=window.navigator.userAgent.toLowerCase(),t;if(n.indexOf("chrome/")>=0&&(t=n.indexOf("chrome/"),t>=0)){var i=t+7,r=n.indexOf(".",i),u=n.substring(i,r);return+u}return 0},n.SupportSVGInWebGL=function(){var r=!1,n,t,i;if(!this.iOS9OrOlderDetected()&&!BrowserUtils.isSafari())try{n=document.createElement("canvas");(n.getContext("webgl")||document.createElement("canvas").getContext("experimental-webgl"))&&(t=document.createElement("canvas").getContext("2d"),t&&(i=document.createElement("img"),i.src="data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg'%3E%3C/svg%3E",t.drawImage(i,0,0,10,10),n.toDataURL("image/png"),r=!0))}catch(u){}return r},n.iOS9OrOlderDetected=function(){var n=window.navigator.userAgent.toLowerCase(),r,t,i;return(n.indexOf("iphone")!=-1||n.indexOf("ipad")!=-1||n.indexOf("ipod")!=-1)&&(r=new RegExp("os (\\d+)_"),t=r.exec(n),t&&t.length>=2)?(i=parseInt(t[1]),!isNaN(i)&&i<=9):!1},n}(),ViewerUrlUtils=function(){function n(){}return n.HTMLEncode=function(n){return UrlUtils.encodeString(n,this.htmlEncodeReplacements)},n.htmlEncodeReplacements=[{FindExpression:new RegExp("&","g"),ReplaceValue:"&#"+"&".charCodeAt(0)+";"},{FindExpression:new RegExp("<","g"),ReplaceValue:"&#"+"<".charCodeAt(0)+";"},{FindExpression:new RegExp(">","g"),ReplaceValue:"&#"+">".charCodeAt(0)+";"},{FindExpression:new RegExp("'","g"),ReplaceValue:"&#"+"'".charCodeAt(0)+";"},{FindExpression:new RegExp("\\\\","g"),ReplaceValue:"&#"+"\\\\".charCodeAt(0)+";"},{FindExpression:new RegExp('"',"g"),ReplaceValue:"&#"+'"'.charCodeAt(0)+";"},],n}(),XhrRequest=function(){function n(){this.OnCompletedCallback=function(){};this.NumRetries=5;this.Timeout=0;this.Finished=!1;this.Aborted=!1}return n.prototype.Abort=function(){this.Finished||(this.Finished=!0,this.Aborted=!0,this.CurrentRequest&&this.CurrentRequest.abort())},n.prototype.Finish=function(n){this.Finished=!0;this.OnCompletedCallback(n)},n}(),XhrResponse=function(){function n(n,t,i,r,u,f,e,o,s){this.Data=n;this.FSuccess=t;this.HttpStatusCode=i;this.RetriesUsed=r;this.State=u;this.ContentLength=f;this.ResourceStringLength=e;this.Aborted=o;this.serverCorrelation=s}return n}(),XhrHelper=function(){function n(){}return n.GetBinary=function(n){this.GetWithRetries(n,0)},n.GetJson=function(n){this.GetWithRetries(n,0)},n.GetWithRetries=function(n,t){var r=this,i;if(!n.Url)throw Error("Url");if(n.ResponseType&&n.ResponseType!="arraybuffer"&&n.ResponseType!="blob")throw Error("ResponseType:"+n.ResponseType);i=new XMLHttpRequest;i.open("GET",n.Url,!0);i.timeout=n.Timeout;n.ResponseType&&(i.responseType=n.ResponseType);i.onreadystatechange=function(){i.readyState==4&&r.OnComplete(i,n,t)};i.send();n.CurrentRequest=i},n.OnComplete=function(n,t,i){var f=n.status,e=t.State,o=i,s=t.Aborted,r=!1,u,h;if(n.status!=200){!t.Aborted&&t.NumRetries>i&&n.status>=400&&n.status<500?this.GetWithRetries(t,i+1):t.Finish(new XhrResponse(undefined,r,f,o,e,undefined,undefined,s,undefined));return}t.ResponseType=="arraybuffer"||t.ResponseType=="blob"?u=n.response:(u=this.Deserialize(n.responseText),h=n.responseText.length);var c=n.getResponseHeader("Content-Length")?parseInt(n.getResponseHeader("Content-Length")):0,l=n.getResponseHeader("X-CorrelationId"),a=c?c:0;r=!0;t.Finish(new XhrResponse(u,r,f,o,e,a,h,s,l))},n.Deserialize=function(n){if(n.substr(n.length-2,2)==");"){var t=n.indexOf("(")+1,i=n.length-2;n=n.substring(t,i)}return JSON.parse(n)},n}();Microsoft.Office.PowerPoint.Bootstrap=new PPTPreviewerBootstrapper;Microsoft.Office.PowerPoint.Bootstrap.Prefetch=PPTPreviewerBootstrapper.Prefetch;Microsoft.Office.PowerPoint.Bootstrap.GetMinContentVersion=PPTPreviewerBootstrapper.GetMinContentVersion;Microsoft.Office.PowerPoint.Bootstrap.SetPreviewAPIFactory=function(n){PreviewSessionLoader.s_previewAPIFactory=n;PPTMessageListenerRegistry.getInstance().setSliceLoaded()};PPTBootstrapSettings=function(){function n(){}return n.getAppMetadata=function(){return{AppVersionMajor:1,AppVersionMinor:BuildVersionConfig.BUILD_NUMBER_MINOR,ContentVersionMajor:1,ContentVersionMinor:BuildVersionConfig.BUILD_NUMBER_MINOR,WacCdnVersion:BuildVersionConfig.BUILD_CDN_NUMBER,Environment:"wac"}},n.getCDNManifestMapping=function(){var n={};return n["pptscripts/reader.dione.js"]="pptscripts/a768ff62b2cb79a9.js",n["pptscripts/reader.calypso.js"]="pptscripts/d42d546f6d389d4e.js",n["pptscripts/babylon.js"]="pptscripts/d942fcaf3b4268b7.js",n["pptpages/powerpointframe.html"]="pptpages/d44dbb3d9ebaa74e.html",n["pptscripts/powerpoint.boot.vslice.js"]="pptscripts/c2298092f20ee6e4.js",n},n.viewerSliceBootstrapper=function(){return"https://contentstorage.osi.office.net/scripts/pptscripts/c2298092f20ee6e4.js"},n}();